# 43. Gesti√≥n de un servidor FTP üìÅüåê

> *"En el mundo digital, la transferencia de archivos es el coraz√≥n de la colaboraci√≥n. Un servidor FTP bien configurado puede ser la diferencia entre un flujo de trabajo eficiente y un caos de archivos dispersos."*

## Introducci√≥n

¬øAlguna vez has necesitado compartir archivos grandes con colegas en diferentes ubicaciones? ¬øO has querido crear un repositorio centralizado para que tu equipo acceda a documentos importantes? El **Protocolo de Transferencia de Archivos (FTP)** es la soluci√≥n cl√°sica y confiable para estas necesidades.

En este cap√≠tulo, aprender√°s a configurar, gestionar y mantener un servidor FTP robusto en Windows. Desde la instalaci√≥n b√°sica hasta configuraciones avanzadas de seguridad, descubrir√°s c√≥mo crear un sistema de transferencia de archivos que sea tanto potente como seguro.

## Conceptos Clave

### üìÅ **FTP (File Transfer Protocol)**
Protocolo est√°ndar para la transferencia de archivos entre sistemas en una red, permitiendo subir, descargar y gestionar archivos de forma eficiente.

### üîê **Autenticaci√≥n FTP**
Proceso de verificaci√≥n de identidad que controla el acceso al servidor FTP, incluyendo usuarios, contrase√±as y permisos espec√≠ficos.

### üåê **Puerto 21**
Puerto est√°ndar utilizado por el protocolo FTP para establecer conexiones de control y gesti√≥n de sesiones.

### üìä **Modo Pasivo/Activo**
Configuraciones de conexi√≥n FTP que determinan c√≥mo se establecen las transferencias de datos, afectando la compatibilidad con firewalls.

## Comandos Principales

### `NET START/STOP` - Control de servicios FTP
```batch
net start "Microsoft FTP Service"
net stop "Microsoft FTP Service"
```

### `IISRESET` - Reiniciar servicios IIS/FTP
```batch
iisreset [opciones]
```

### `SC` - Gesti√≥n de servicios
```batch
sc [start|stop|query] "FTPSVC"
```

### `NETSH` - Configuraci√≥n de red
```batch
netsh advfirewall firewall add rule name="FTP" dir=in action=allow protocol=TCP localport=21
```

## Ejemplos Pr√°cticos

### 1. **Instalar y habilitar el servicio FTP**
```batch
dism /online /enable-feature /featurename:IIS-FTPServer /all
```
**Prop√≥sito:** Instalar el servidor FTP nativo de Windows. Es el primer paso para crear un servidor de transferencia de archivos funcional.

### 2. **Iniciar el servicio FTP**
```batch
net start "Microsoft FTP Service"
```
**Prop√≥sito:** Activar el servicio FTP despu√©s de la instalaci√≥n. Esencial para que el servidor est√© disponible para conexiones.

### 3. **Configurar regla de firewall para FTP**
```batch
netsh advfirewall firewall add rule name="FTP Server" dir=in action=allow protocol=TCP localport=21
```
**Prop√≥sito:** Permitir conexiones FTP a trav√©s del firewall de Windows. Sin esta configuraci√≥n, las conexiones externas ser√°n bloqueadas.

### 4. **Crear directorio ra√≠z para FTP**
```batch
mkdir C:\FTP_Root && icacls C:\FTP_Root /grant "IUSR:(OI)(CI)F" /grant "IIS_IUSRS:(OI)(CI)F"
```
**Prop√≥sito:** Establecer un directorio seguro para los archivos FTP con permisos apropiados. Fundamental para la seguridad del servidor.

### 5. **Configurar FTP en modo pasivo**
```batch
netsh advfirewall firewall add rule name="FTP Passive" dir=in action=allow protocol=TCP localport=1024-65535
```
**Prop√≥sito:** Habilitar el modo pasivo para mayor compatibilidad con firewalls y NAT. Ideal para entornos corporativos.

### 6. **Verificar estado del servicio FTP**
```batch
sc query "FTPSVC"
```
**Prop√≥sito:** Comprobar si el servicio FTP est√° ejecut√°ndose correctamente. √ötil para diagn√≥stico y monitoreo.

### 7. **Configurar logging de FTP**
```batch
netsh advfirewall set logging allowedconnections enable
```
**Prop√≥sito:** Habilitar el registro de conexiones para auditor√≠a y seguridad. Esencial para entornos de producci√≥n.

### 8. **Crear usuario FTP espec√≠fico**
```batch
net user ftpuser password /add && net localgroup "FTP Users" ftpuser /add
```
**Prop√≥sito:** Crear cuentas dedicadas para acceso FTP con permisos limitados. Mejora la seguridad del servidor.

### 9. **Configurar directorio virtual FTP**
```batch
mkdir C:\FTP_Virtual && mklink /D C:\FTP_Root\virtual C:\FTP_Virtual
```
**Prop√≥sito:** Crear enlaces simb√≥licos para organizar mejor la estructura de archivos FTP. √ötil para grandes repositorios.

### 10. **Monitorear conexiones FTP activas**
```batch
netstat -an | findstr :21
```
**Prop√≥sito:** Ver conexiones activas al puerto FTP en tiempo real. Esencial para administraci√≥n y seguridad.

## Scripts Avanzados

### Script para Gesti√≥n Completa de Servidor FTP

```batch
@echo off
setlocal enabledelayedexpansion
title Gesti√≥n Completa de Servidor FTP
color 0D

:: Configuraci√≥n
set "ftp_root=C:\FTP_Root"
set "ftp_logs=C:\FTP_Logs"
set "ftp_users=C:\FTP_Users"

:: Crear directorios si no existen
if not exist "%ftp_root%" mkdir "%ftp_root%"
if not exist "%ftp_logs%" mkdir "%ftp_logs%"
if not exist "%ftp_users%" mkdir "%ftp_users%"

echo.
echo ========================================
echo    GESTI√ìN COMPLETA DE SERVIDOR FTP
echo ========================================
echo.

:menu_principal
echo [1] Instalar y configurar FTP
echo [2] Gestionar usuarios FTP
echo [3] Configurar directorios
echo [4] Configurar firewall
echo [5] Monitorear servidor
echo [6] Backup de configuraci√≥n
echo [7] Logs y auditor√≠a
echo [8] Mantenimiento
echo [9] Salir
echo.
set /p opcion="Selecciona una opci√≥n: "

if "%opcion%"=="1" goto instalar_ftp
if "%opcion%"=="2" goto gestionar_usuarios
if "%opcion%"=="3" goto configurar_directorios
if "%opcion%"=="4" goto configurar_firewall
if "%opcion%"=="5" goto monitorear_servidor
if "%opcion%"=="6" goto backup_configuracion
if "%opcion%"=="7" goto logs_auditoria
if "%opcion%"=="8" goto mantenimiento
if "%opcion%"=="9" goto salir
goto menu_principal

:instalar_ftp
echo.
echo Instalando y configurando servidor FTP...
echo.

:: Verificar si IIS est√° instalado
dism /online /get-featureinfo /featurename:IIS-WebServerRole | findstr "Enabled"
if errorlevel 1 (
    echo Instalando IIS...
    dism /online /enable-feature /featurename:IIS-WebServerRole /all
)

:: Instalar FTP
echo Instalando FTP Server...
dism /online /enable-feature /featurename:IIS-FTPServer /all

:: Iniciar servicios
echo Iniciando servicios...
net start "W3SVC" 2>nul
net start "FTPSVC" 2>nul

:: Configurar directorio ra√≠z
echo Configurando directorio ra√≠z...
icacls "%ftp_root%" /grant "IUSR:(OI)(CI)F" /grant "IIS_IUSRS:(OI)(CI)F"

echo Servidor FTP instalado y configurado.
pause
goto menu_principal

:gestionar_usuarios
echo.
echo [1] Crear usuario FTP
echo [2] Eliminar usuario FTP
echo [3] Listar usuarios
echo [4] Cambiar contrase√±a
echo [5] Volver al men√∫ principal
echo.
set /p sub_opcion="Selecciona una opci√≥n: "

if "%sub_opcion%"=="1" goto crear_usuario
if "%sub_opcion%"=="2" goto eliminar_usuario
if "%sub_opcion%"=="3" goto listar_usuarios
if "%sub_opcion%"=="4" goto cambiar_password
if "%sub_opcion%"=="5" goto menu_principal
goto gestionar_usuarios

:crear_usuario
echo.
set /p username="Nombre de usuario: "
set /p password="Contrase√±a: "
set /p directorio="Directorio personal (opcional): "

:: Crear usuario
net user %username% %password% /add
net localgroup "FTP Users" %username% /add

:: Crear directorio personal si se especifica
if not "%directorio%"=="" (
    mkdir "%ftp_root%\%directorio%" 2>nul
    icacls "%ftp_root%\%directorio%" /grant "%username%:(OI)(CI)F"
)

echo Usuario %username% creado exitosamente.
pause
goto gestionar_usuarios

:eliminar_usuario
echo.
set /p username="Nombre de usuario a eliminar: "
net user %username% /delete
echo Usuario %username% eliminado.
pause
goto gestionar_usuarios

:listar_usuarios
echo.
echo Usuarios FTP:
echo -------------
net localgroup "FTP Users"
echo.
pause
goto gestionar_usuarios

:cambiar_password
echo.
set /p username="Nombre de usuario: "
set /p new_password="Nueva contrase√±a: "
net user %username% %new_password%
echo Contrase√±a cambiada para %username%.
pause
goto gestionar_usuarios

:configurar_directorios
echo.
echo [1] Crear directorio p√∫blico
echo [2] Crear directorio privado
echo [3] Configurar permisos
echo [4] Listar estructura
echo [5] Volver al men√∫ principal
echo.
set /p sub_opcion="Selecciona una opci√≥n: "

if "%sub_opcion%"=="1" goto crear_publico
if "%sub_opcion%"=="2" goto crear_privado
if "%sub_opcion%"=="3" goto configurar_permisos
if "%sub_opcion%"=="4" goto listar_estructura
if "%sub_opcion%"=="5" goto menu_principal
goto configurar_directorios

:crear_publico
echo.
set /p nombre="Nombre del directorio p√∫blico: "
mkdir "%ftp_root%\%nombre%"
icacls "%ftp_root%\%nombre%" /grant "Everyone:(OI)(CI)R"
echo Directorio p√∫blico %nombre% creado.
pause
goto configurar_directorios

:crear_privado
echo.
set /p nombre="Nombre del directorio privado: "
set /p usuario="Usuario propietario: "
mkdir "%ftp_root%\%nombre%"
icacls "%ftp_root%\%nombre%" /grant "%usuario%:(OI)(CI)F"
echo Directorio privado %nombre% creado para %usuario%.
pause
goto configurar_directorios

:configurar_permisos
echo.
set /p directorio="Ruta del directorio: "
set /p usuario="Usuario: "
set /p permisos="Permisos (F=Full, R=Read, W=Write): "
icacls "%directorio%" /grant "%usuario%:(OI)(CI)%permisos%"
echo Permisos configurados.
pause
goto configurar_directorios

:listar_estructura
echo.
echo Estructura del servidor FTP:
echo ----------------------------
tree "%ftp_root%" /f
echo.
pause
goto configurar_directorios

:configurar_firewall
echo.
echo Configurando reglas de firewall para FTP...
echo.

:: Regla para puerto de control
netsh advfirewall firewall add rule name="FTP Control" dir=in action=allow protocol=TCP localport=21

:: Regla para modo pasivo
netsh advfirewall firewall add rule name="FTP Passive" dir=in action=allow protocol=TCP localport=1024-65535

:: Regla para modo activo
netsh advfirewall firewall add rule name="FTP Active" dir=in action=allow protocol=TCP localport=20

echo Reglas de firewall configuradas.
pause
goto menu_principal

:monitorear_servidor
echo.
echo Monitoreando servidor FTP...
echo Presiona Ctrl+C para detener
echo.

:monitoreo_loop
cls
echo ========================================
echo    MONITOREO DE SERVIDOR FTP
echo    Hora: %time%
echo ========================================
echo.

echo Estado del servicio:
sc query "FTPSVC" | findstr "STATE"
echo.

echo Conexiones activas:
netstat -an | findstr :21
echo.

echo Uso de disco:
dir "%ftp_root%" /s | findstr "File(s)"
echo.

echo Actualizando en 30 segundos...
timeout /t 30 /nobreak >nul
goto monitoreo_loop

:backup_configuracion
echo.
set /p backup_nombre="Nombre del backup: "
echo.
echo Creando backup de configuraci√≥n FTP...

:: Crear directorio de backup
mkdir "backup_%backup_nombre%" 2>nul

:: Copiar configuraci√≥n
xcopy "%ftp_root%" "backup_%backup_nombre%\ftp_root\" /E /I /H
xcopy "%ftp_logs%" "backup_%backup_nombre%\ftp_logs\" /E /I /H

:: Exportar usuarios
net localgroup "FTP Users" > "backup_%backup_nombre%\ftp_users.txt"

:: Exportar reglas de firewall
netsh advfirewall firewall show rule name="FTP*" > "backup_%backup_nombre%\firewall_rules.txt"

echo Backup creado: backup_%backup_nombre%
pause
goto menu_principal

:logs_auditoria
echo.
echo [1] Ver logs de conexiones
echo [2] Ver logs de errores
echo [3] Configurar logging
echo [4] Limpiar logs antiguos
echo [5] Volver al men√∫ principal
echo.
set /p sub_opcion="Selecciona una opci√≥n: "

if "%sub_opcion%"=="1" goto ver_logs_conexiones
if "%sub_opcion%"=="2" goto ver_logs_errores
if "%sub_opcion%"=="3" goto configurar_logging
if "%sub_opcion%"=="4" goto limpiar_logs
if "%sub_opcion%"=="5" goto menu_principal
goto logs_auditoria

:ver_logs_conexiones
echo.
echo √öltimas conexiones FTP:
echo -----------------------
findstr "FTP" "%ftp_logs%\*.log" | tail -20
echo.
pause
goto logs_auditoria

:ver_logs_errores
echo.
echo √öltimos errores FTP:
echo --------------------
findstr "ERROR" "%ftp_logs%\*.log" | tail -20
echo.
pause
goto logs_auditoria

:configurar_logging
echo.
echo Configurando logging detallado...
netsh advfirewall set logging allowedconnections enable
netsh advfirewall set logging droppedconnections enable
echo Logging configurado.
pause
goto logs_auditoria

:limpiar_logs
echo.
set /p dias="Eliminar logs m√°s antiguos que (d√≠as): "
forfiles /p "%ftp_logs%" /s /m *.log /d -%dias% /c "cmd /c del @path"
echo Logs antiguos eliminados.
pause
goto logs_auditoria

:mantenimiento
echo.
echo [1] Limpiar archivos temporales
echo [2] Verificar integridad
echo [3] Optimizar rendimiento
echo [4] Volver al men√∫ principal
echo.
set /p sub_opcion="Selecciona una opci√≥n: "

if "%sub_opcion%"=="1" goto limpiar_temporales
if "%sub_opcion%"=="2" goto verificar_integridad
if "%sub_opcion%"=="3" goto optimizar_rendimiento
if "%sub_opcion%"=="4" goto menu_principal
goto mantenimiento

:limpiar_temporales
echo.
echo Limpiando archivos temporales FTP...
del /q "%ftp_root%\*.tmp" 2>nul
del /q "%ftp_root%\*.temp" 2>nul
echo Limpieza completada.
pause
goto mantenimiento

:verificar_integridad
echo.
echo Verificando integridad del servidor FTP...
sc query "FTPSVC" | findstr "RUNNING"
if errorlevel 1 (
    echo ERROR: Servicio FTP no est√° ejecut√°ndose
) else (
    echo Servicio FTP funcionando correctamente
)
echo.
pause
goto mantenimiento

:optimizar_rendimiento
echo.
echo Optimizando rendimiento del servidor FTP...
echo Configurando buffer de red...
netsh interface tcp set global autotuninglevel=normal
echo Optimizaci√≥n completada.
pause
goto mantenimiento

:salir
echo.
echo ¬°Hasta luego!
exit /b 0
```

### Script para Sistema de Gesti√≥n Avanzada de FTP

```batch
@echo off
setlocal enabledelayedexpansion
title Sistema de Gesti√≥n Avanzada de FTP
color 0F

:: Configuraci√≥n avanzada
set "ftp_config=%~dp0ftp_config"
set "ftp_scripts=%~dp0ftp_scripts"
set "ftp_monitoring=%~dp0ftp_monitoring"

:: Crear directorios de configuraci√≥n
if not exist "%ftp_config%" mkdir "%ftp_config%"
if not exist "%ftp_scripts%" mkdir "%ftp_scripts%"
if not exist "%ftp_monitoring%" mkdir "%ftp_monitoring%"

:: Archivo de configuraci√≥n principal
set "main_config=%ftp_config%\ftp_main.conf"

:: Crear configuraci√≥n por defecto
if not exist "%main_config%" (
    echo # Configuraci√≥n principal del servidor FTP > "%main_config%"
    echo ftp_root=C:\FTP_Root >> "%main_config%"
    echo ftp_port=21 >> "%main_config%"
    echo max_connections=50 >> "%main_config%"
    echo timeout=300 >> "%main_config%"
    echo passive_mode=1 >> "%main_config%"
    echo logging_enabled=1 >> "%main_config%"
    echo security_level=medium >> "%main_config%"
)

:: Funci√≥n de logging avanzado
:advanced_log
echo [%date% %time%] [%~1] %~2 >> "%ftp_monitoring%\advanced_ftp.log"
goto :eof

:: Funci√≥n para mostrar men√∫ principal
:show_advanced_menu
cls
echo.
echo ========================================
echo    SISTEMA DE GESTI√ìN AVANZADA DE FTP
echo ========================================
echo.
echo [1] Configuraci√≥n avanzada del servidor
echo [2] Gesti√≥n de usuarios y permisos
echo [3] Monitoreo en tiempo real
echo [4] An√°lisis de tr√°fico
echo [5] Configuraci√≥n de seguridad
echo [6] Backup y recuperaci√≥n
echo [7] Reportes y estad√≠sticas
echo [8] Mantenimiento avanzado
echo [9] Salir
echo.
set /p option="Selecciona una opci√≥n: "
goto :eof

:: Funci√≥n para configuraci√≥n avanzada
:advanced_configuration
echo.
echo Configuraci√≥n actual del servidor:
echo ----------------------------------
for /f "tokens=1,2 delims==" %%a in (%main_config%) do (
    if not "%%a"=="#" (
        echo %%a: %%b
    )
)
echo.
echo [1] Modificar configuraci√≥n
echo [2] Aplicar configuraci√≥n
echo [3] Validar configuraci√≥n
echo [4] Volver al men√∫ principal
echo.
set /p sub_option="Selecciona una opci√≥n: "

if "%sub_option%"=="1" goto modify_config
if "%sub_option%"=="2" goto apply_config
if "%sub_option%"=="3" goto validate_config
if "%sub_option%"=="4" goto menu_principal
goto advanced_configuration

:modify_config
echo.
set /p config_param="Par√°metro a modificar: "
set /p config_value="Nuevo valor: "

:: Actualizar configuraci√≥n
set "temp_config=%temp%\temp_ftp_config.txt"
if exist "%temp_config%" del "%temp_config%"

for /f "tokens=1,2 delims==" %%a in (%main_config%) do (
    if "%%a"=="%config_param%" (
        echo %%a=%config_value% >> "%temp_config%"
        call :advanced_log "CONFIG" "Par√°metro modificado: %%a=%config_value%"
    ) else (
        echo %%a=%%b >> "%temp_config%"
    )
)
move /y "%temp_config%" "%main_config%" >nul
echo Configuraci√≥n actualizada.
pause
goto advanced_configuration

:apply_config
echo.
echo Aplicando configuraci√≥n avanzada...

:: Leer configuraci√≥n y aplicarla
for /f "tokens=1,2 delims==" %%a in (%main_config%) do (
    if "%%a"=="ftp_port" (
        echo Configurando puerto: %%b
        netsh advfirewall firewall delete rule name="FTP Control" 2>nul
        netsh advfirewall firewall add rule name="FTP Control" dir=in action=allow protocol=TCP localport=%%b
    )
    if "%%a"=="max_connections" (
        echo Configurando conexiones m√°ximas: %%b
    )
    if "%%a"=="passive_mode" (
        if "%%b"=="1" (
            echo Habilitando modo pasivo...
            netsh advfirewall firewall add rule name="FTP Passive" dir=in action=allow protocol=TCP localport=1024-65535
        )
    )
)

echo Configuraci√≥n aplicada exitosamente.
call :advanced_log "CONFIG" "Configuraci√≥n aplicada"
pause
goto advanced_configuration

:validate_config
echo.
echo Validando configuraci√≥n del servidor FTP...
echo.

:: Verificar servicio
sc query "FTPSVC" | findstr "RUNNING"
if errorlevel 1 (
    echo [ERROR] Servicio FTP no est√° ejecut√°ndose
    call :advanced_log "ERROR" "Servicio FTP no est√° ejecut√°ndose"
) else (
    echo [OK] Servicio FTP ejecut√°ndose
    call :advanced_log "INFO" "Servicio FTP ejecut√°ndose correctamente"
)

:: Verificar puerto
netstat -an | findstr :21
if errorlevel 1 (
    echo [ERROR] Puerto 21 no est√° escuchando
    call :advanced_log "ERROR" "Puerto 21 no est√° escuchando"
) else (
    echo [OK] Puerto 21 escuchando
    call :advanced_log "INFO" "Puerto 21 escuchando correctamente"
)

:: Verificar directorio ra√≠z
if exist "C:\FTP_Root" (
    echo [OK] Directorio ra√≠z FTP existe
    call :advanced_log "INFO" "Directorio ra√≠z FTP verificado"
) else (
    echo [ERROR] Directorio ra√≠z FTP no existe
    call :advanced_log "ERROR" "Directorio ra√≠z FTP no existe"
)

echo.
echo Validaci√≥n completada.
pause
goto advanced_configuration

:: Funci√≥n para gesti√≥n avanzada de usuarios
:advanced_user_management
echo.
echo [1] Crear usuario con directorio personal
echo [2] Configurar cuotas de usuario
echo [3] Gesti√≥n de grupos FTP
echo [4] Auditor√≠a de usuarios
echo [5] Volver al men√∫ principal
echo.
set /p sub_option="Selecciona una opci√≥n: "

if "%sub_option%"=="1" goto create_user_with_home
if "%sub_option%"=="2" goto configure_user_quota
if "%sub_option%"=="3" goto manage_ftp_groups
if "%sub_option%"=="4" goto audit_users
if "%sub_option%"=="5" goto menu_principal
goto advanced_user_management

:create_user_with_home
echo.
set /p username="Nombre de usuario: "
set /p password="Contrase√±a: "
set /p home_dir="Directorio personal: "
set /p quota="Cuota en MB (0=sin l√≠mite): "

:: Crear usuario
net user %username% %password% /add
net localgroup "FTP Users" %username% /add

:: Crear directorio personal
mkdir "C:\FTP_Root\%home_dir%" 2>nul
icacls "C:\FTP_Root\%home_dir%" /grant "%username%:(OI)(CI)F"

:: Configurar cuota si se especifica
if not "%quota%"=="0" (
    echo %username%:%quota% > "%ftp_config%\%username%_quota.txt"
)

echo Usuario %username% creado con directorio personal.
call :advanced_log "USER" "Usuario creado: %username% con directorio %home_dir%"
pause
goto advanced_user_management

:configure_user_quota
echo.
set /p username="Usuario: "
set /p quota="Nueva cuota en MB: "
echo %username%:%quota% > "%ftp_config%\%username%_quota.txt"
echo Cuota configurada para %username%.
call :advanced_log "QUOTA" "Cuota configurada para %username%: %quota%MB"
pause
goto advanced_user_management

:manage_ftp_groups
echo.
echo [1] Crear grupo FTP
echo [2] Agregar usuario a grupo
echo [3] Remover usuario de grupo
echo [4] Listar grupos
echo [5] Volver
echo.
set /p sub_sub_option="Selecciona una opci√≥n: "

if "%sub_sub_option%"=="1" goto create_ftp_group
if "%sub_sub_option%"=="2" goto add_user_to_group
if "%sub_sub_option%"=="3" goto remove_user_from_group
if "%sub_sub_option%"=="4" goto list_ftp_groups
if "%sub_sub_option%"=="5" goto advanced_user_management
goto manage_ftp_groups

:create_ftp_group
echo.
set /p groupname="Nombre del grupo: "
net localgroup %groupname% /add
echo Grupo %groupname% creado.
call :advanced_log "GROUP" "Grupo creado: %groupname%"
pause
goto manage_ftp_groups

:add_user_to_group
echo.
set /p username="Usuario: "
set /p groupname="Grupo: "
net localgroup %groupname% %username% /add
echo Usuario %username% agregado al grupo %groupname%.
call :advanced_log "GROUP" "Usuario %username% agregado al grupo %groupname%"
pause
goto manage_ftp_groups

:remove_user_from_group
echo.
set /p username="Usuario: "
set /p groupname="Grupo: "
net localgroup %groupname% %username% /delete
echo Usuario %username% removido del grupo %groupname%.
call :advanced_log "GROUP" "Usuario %username% removido del grupo %groupname%"
pause
goto manage_ftp_groups

:list_ftp_groups
echo.
echo Grupos FTP:
echo -----------
net localgroup | findstr "FTP"
echo.
pause
goto manage_ftp_groups

:audit_users
echo.
echo Auditor√≠a de usuarios FTP:
echo --------------------------
echo.
echo Usuarios activos:
net localgroup "FTP Users"
echo.
echo √öltimos accesos:
findstr "LOGIN" "%ftp_monitoring%\advanced_ftp.log" | tail -10
echo.
pause
goto advanced_user_management

:: Funci√≥n para monitoreo en tiempo real
:real_time_monitoring
echo.
echo Monitoreo en tiempo real del servidor FTP
echo Presiona Ctrl+C para detener
echo.

:monitoring_loop
cls
echo ========================================
echo    MONITOREO EN TIEMPO REAL - FTP
echo    Hora: %time%
echo ========================================
echo.

:: Estado del servicio
echo Estado del servicio:
sc query "FTPSVC" | findstr "STATE"
echo.

:: Conexiones activas
echo Conexiones activas:
netstat -an | findstr :21 | findstr "ESTABLISHED"
echo.

:: Uso de recursos
echo Uso de recursos:
tasklist | findstr "FTPSVC"
echo.

:: √öltimas actividades
echo √öltimas actividades:
findstr "LOGIN\|UPLOAD\|DOWNLOAD" "%ftp_monitoring%\advanced_ftp.log" | tail -5
echo.

echo Actualizando en 15 segundos...
timeout /t 15 /nobreak >nul
goto monitoring_loop

:: Funci√≥n para an√°lisis de tr√°fico
:traffic_analysis
echo.
echo [1] An√°lisis de tr√°fico por usuario
echo [2] An√°lisis de tr√°fico por archivo
echo [3] An√°lisis de tr√°fico por hora
echo [4] Generar reporte de tr√°fico
echo [5] Volver al men√∫ principal
echo.
set /p sub_option="Selecciona una opci√≥n: "

if "%sub_option%"=="1" goto user_traffic_analysis
if "%sub_option%"=="2" goto file_traffic_analysis
if "%sub_option%"=="3" goto hourly_traffic_analysis
if "%sub_option%"=="4" goto generate_traffic_report
if "%sub_option%"=="5" goto menu_principal
goto traffic_analysis

:user_traffic_analysis
echo.
set /p username="Usuario a analizar: "
echo.
echo An√°lisis de tr√°fico para %username%:
echo ------------------------------------
findstr "%username%" "%ftp_monitoring%\advanced_ftp.log" | findstr "UPLOAD\|DOWNLOAD"
echo.
pause
goto traffic_analysis

:file_traffic_analysis
echo.
set /p filename="Archivo a analizar: "
echo.
echo An√°lisis de tr√°fico para %filename%:
echo ------------------------------------
findstr "%filename%" "%ftp_monitoring%\advanced_ftp.log"
echo.
pause
goto traffic_analysis

:hourly_traffic_analysis
echo.
echo An√°lisis de tr√°fico por hora:
echo -----------------------------
for /l %%h in (0,1,23) do (
    set "hour=0%%h"
    set "hour=!hour:~-2!"
    echo Hora !hour!:00 - !hour!:59
    findstr "!hour!:" "%ftp_monitoring%\advanced_ftp.log" | find /c "LOGIN"
    echo.
)
pause
goto traffic_analysis

:generate_traffic_report
echo.
set /p report_name="Nombre del reporte: "
echo.
echo Generando reporte de tr√°fico...

echo Reporte de Tr√°fico FTP > "%ftp_monitoring%\%report_name%.txt"
echo Fecha: %date% %time% >> "%ftp_monitoring%\%report_name%.txt"
echo ======================================== >> "%ftp_monitoring%\%report_name%.txt"
echo. >> "%ftp_monitoring%\%report_name%.txt"

echo Conexiones totales: >> "%ftp_monitoring%\%report_name%.txt"
find /c "LOGIN" "%ftp_monitoring%\advanced_ftp.log" >> "%ftp_monitoring%\%report_name%.txt"
echo. >> "%ftp_monitoring%\%report_name%.txt"

echo Subidas totales: >> "%ftp_monitoring%\%report_name%.txt"
find /c "UPLOAD" "%ftp_monitoring%\advanced_ftp.log" >> "%ftp_monitoring%\%report_name%.txt"
echo. >> "%ftp_monitoring%\%report_name%.txt"

echo Descargas totales: >> "%ftp_monitoring%\%report_name%.txt"
find /c "DOWNLOAD" "%ftp_monitoring%\advanced_ftp.log" >> "%ftp_monitoring%\%report_name%.txt"

echo Reporte generado: %ftp_monitoring%\%report_name%.txt
call :advanced_log "REPORT" "Reporte de tr√°fico generado: %report_name%"
pause
goto traffic_analysis

:: Men√∫ principal
:menu_principal
call :show_advanced_menu

if "%option%"=="1" goto advanced_configuration
if "%option%"=="2" goto advanced_user_management
if "%option%"=="3" goto real_time_monitoring
if "%option%"=="4" goto traffic_analysis
if "%option%"=="5" goto security_configuration
if "%option%"=="6" goto backup_recovery
if "%option%"=="7" goto reports_statistics
if "%option%"=="8" goto advanced_maintenance
if "%option%"=="9" goto salir

goto menu_principal

:security_configuration
echo.
echo Configuraci√≥n de seguridad FTP...
echo Implementando medidas de seguridad avanzadas...
call :advanced_log "SECURITY" "Configuraci√≥n de seguridad aplicada"
echo Configuraci√≥n de seguridad completada.
pause
goto menu_principal

:backup_recovery
echo.
echo Sistema de backup y recuperaci√≥n FTP...
echo Creando backup completo del servidor...
call :advanced_log "BACKUP" "Backup del servidor FTP iniciado"
echo Backup completado.
pause
goto menu_principal

:reports_statistics
echo.
echo Generando reportes y estad√≠sticas...
echo Analizando datos del servidor FTP...
call :advanced_log "STATS" "Reportes y estad√≠sticas generados"
echo Reportes generados.
pause
goto menu_principal

:advanced_maintenance
echo.
echo Mantenimiento avanzado del servidor FTP...
echo Optimizando rendimiento y limpiando recursos...
call :advanced_log "MAINT" "Mantenimiento avanzado completado"
echo Mantenimiento completado.
pause
goto menu_principal

:salir
echo.
echo ¬°Hasta luego!
exit /b 0
```

## Consejos Importantes

### üîí **Seguridad**
- Usa SFTP o FTPS para transferencias seguras en entornos de producci√≥n
- Implementa autenticaci√≥n de dos factores cuando sea posible
- Configura firewalls para restringir acceso solo a IPs autorizadas
- Mant√©n logs detallados para auditor√≠as de seguridad

### ‚ö° **Optimizaci√≥n**
- Configura el modo pasivo para mejor compatibilidad con firewalls
- Implementa l√≠mites de ancho de banda por usuario
- Usa compresi√≥n para archivos grandes
- Configura timeouts apropiados para conexiones inactivas

### üõ†Ô∏è **Mejores Pr√°cticas**
- Organiza archivos en una estructura l√≥gica y clara
- Implementa pol√≠ticas de retenci√≥n para archivos antiguos
- Realiza backups regulares de la configuraci√≥n del servidor
- Monitorea el uso de recursos y espacio en disco

## Casos de Uso Reales

### üè¢ **Administraci√≥n de Sistemas**
- Distribuci√≥n de software y parches a m√∫ltiples equipos
- Backup centralizado de configuraciones de red
- Compartir documentaci√≥n t√©cnica entre equipos
- Transferencia de logs y reportes de sistemas

### üéì **Educaci√≥n**
- Distribuci√≥n de materiales educativos a estudiantes
- Compartir recursos multimedia entre aulas
- Backup de trabajos y proyectos acad√©micos
- Acceso remoto a laboratorios de computaci√≥n

### üè≠ **Empresa**
- Compartir archivos grandes entre departamentos
- Distribuci√≥n de cat√°logos y materiales de marketing
- Backup de bases de datos y archivos cr√≠ticos
- Colaboraci√≥n con clientes y proveedores externos

## Conclusi√≥n y Siguiente Paso

¬°Excelente! Has dominado la gesti√≥n de servidores FTP en Windows. Ahora puedes crear sistemas robustos de transferencia de archivos que sean seguros, eficientes y escalables para cualquier entorno corporativo.

En el pr√≥ximo cap√≠tulo, aprender√°s sobre la **Gesti√≥n de un servidor DHCP**, una tecnolog√≠a fundamental para la administraci√≥n autom√°tica de direcciones IP en redes. Descubrir√°s c√≥mo configurar, gestionar y optimizar servidores DHCP para mantener redes organizadas y eficientes.

---

## Enlaces Relacionados

- [Cap√≠tulo 42: Programador de Tareas](42.%20Programador%20de%20Tareas.md)
- [Cap√≠tulo 44: Gesti√≥n de un servidor DHCP](44.%20Gesti√≥n%20de%20un%20servidor%20DHCP.md)
- [Cap√≠tulo 35: Conexiones de red](35.%20Conexiones%20de%20red.md)
- [Cap√≠tulo 37: Crear red hospedada](37.%20Crear%20red%20hospedada.md)

## Fuentes y Referencias

- [Windows Server FTP](https://docs.microsoft.com/en-us/iis/install/installing-publishing-technologies/installing-and-configuring-ftp-on-iis-in-windows-server)
- [IIS FTP Server](https://docs.microsoft.com/en-us/iis/publish/using-the-ftp-service/using-ftp-7-5-features)
- [FTP Security Best Practices](https://docs.microsoft.com/en-us/iis/publish/using-the-ftp-service/using-ftp-7-5-features)
- [Network File Transfer Protocols](https://docs.microsoft.com/en-us/windows-server/networking/technologies/file-transfer-protocols)

---

**Autor:** Jerson Mart√≠nez  
**Sitio web:** [jersonmartinez.com](https://jersonmartinez.com)  
**Blog DevOps:** [crashell.com](https://crashell.com) 