# üîÑ Recuperar informaci√≥n

> *"En el mundo de la administraci√≥n de sistemas, la recuperaci√≥n de datos no es una opci√≥n, es una necesidad. ¬øEst√°s preparado para ser el h√©roe que salva informaci√≥n cr√≠tica cuando todo parece perdido?"* üöÄ

## üìã Introducci√≥n

La recuperaci√≥n de informaci√≥n es una de las habilidades m√°s cr√≠ticas y valoradas en la administraci√≥n de sistemas Windows. Desde archivos eliminados accidentalmente hasta sistemas completos comprometidos, la capacidad de recuperar datos puede significar la diferencia entre una crisis menor y una cat√°strofe empresarial.

En este cap√≠tulo, aprender√°s t√©cnicas avanzadas de recuperaci√≥n de datos utilizando herramientas nativas de Windows, desde la recuperaci√≥n de archivos individuales hasta la restauraci√≥n completa de sistemas. Dominar√°s m√©todos para recuperar informaci√≥n de discos da√±ados, particiones corruptas y sistemas comprometidos.

## üîç Conceptos Clave

### **Recuperaci√≥n de Datos**
Proceso de restaurar informaci√≥n perdida, corrupta o inaccesible desde medios de almacenamiento da√±ados o comprometidos.

### **Sector de Arranque**
Regi√≥n del disco que contiene informaci√≥n cr√≠tica para el inicio del sistema operativo y la estructura del sistema de archivos.

### **Tabla de Archivos Maestra (MFT)**
Estructura de datos que contiene informaci√≥n sobre todos los archivos y directorios en un volumen NTFS.

### **Punto de Restauraci√≥n**
Instant√°nea del sistema que permite revertir cambios y restaurar el estado anterior del sistema.

## üõ†Ô∏è Comandos Principales

### **CHKDSK**
Verifica y repara errores en el sistema de archivos y sectores defectuosos.

```batch
CHKDSK [unidad:] [/F] [/R] [/X] [/I] [/C]
```

### **SFC**
Verifica la integridad de archivos del sistema y repara archivos corruptos.

```batch
SFC /SCANNOW [/VERIFYONLY] [/SCANFILE=archivo]
```

### **DISM**
Servicio de administraci√≥n y mantenimiento de im√°genes de implementaci√≥n.

```batch
DISM /Online /Cleanup-Image [/RestoreHealth] [/ScanHealth]
```

### **WBADMIN**
Herramienta de l√≠nea de comandos para backup y recuperaci√≥n de Windows.

```batch
WBADMIN START BACKUP /BACKUPTARGET:unidad: /INCLUDE:ruta
```

## üí° Ejemplos Pr√°cticos

### Tabla de referencia de scripts pr√°cticos

Los siguientes ejemplos han sido extra√≠dos y organizados como scripts independientes en el directorio [`scripts/55-recuperar-informacion`](scripts/55-recuperar-informacion). Puedes ejecutarlos directamente en tu entorno Windows o en la m√°quina virtual Vagrant.

| Ejemplo | Script | Descripci√≥n | Advertencia |
|---------|--------|-------------|-------------|
| 1 | [`recuperar-archivos-eliminados.ps1`](scripts/55-recuperar-informacion/recuperar-archivos-eliminados.ps1) | Recupera archivos eliminados con PowerShell | ‚ö†Ô∏è Ejecuta en PowerShell como administrador |
| 2 | [`recuperar-sector-arranque.bat`](scripts/55-recuperar-informacion/recuperar-sector-arranque.bat) | Repara el sector de arranque da√±ado | ‚ö†Ô∏è Solo en modo recuperaci√≥n |
| 3 | [`recuperar-mft-corrupta.bat`](scripts/55-recuperar-informacion/recuperar-mft-corrupta.bat) | Repara la MFT corrupta y verifica el sistema | ‚ö†Ô∏è Puede requerir reinicio |
| 4 | [`recuperar-particion-perdida.bat`](scripts/55-recuperar-informacion/recuperar-particion-perdida.bat) | Recupera particiones eliminadas o inaccesibles | ‚ö†Ô∏è Verifica el disco antes de ejecutar |
| 5 | [`recuperar-datos-disco-danado.bat`](scripts/55-recuperar-informacion/recuperar-datos-disco-danado.bat) | Extrae datos de discos da√±ados | ‚ö†Ô∏è Riesgo de p√©rdida de datos |
| 6 | [`restaurar-sistema-punto-restauracion.bat`](scripts/55-recuperar-informacion/restaurar-sistema-punto-restauracion.bat) | Restaura el sistema desde un punto de restauraci√≥n | ‚ö†Ô∏è Reinicia el sistema |
| 7 | [`recuperar-contrasena-sistema.bat`](scripts/55-recuperar-informacion/recuperar-contrasena-sistema.bat) | Recupera o resetea contrase√±as de usuarios | ‚ö†Ô∏è Uso responsable, privilegios de administrador |
| 8 | [`recuperar-configuracion-red.bat`](scripts/55-recuperar-informacion/recuperar-configuracion-red.bat) | Restaura la configuraci√≥n de red | ‚ö†Ô∏è Puede afectar conectividad temporalmente |
| 9 | [`recuperar-archivos-backup.bat`](scripts/55-recuperar-informacion/recuperar-archivos-backup.bat) | Restaura archivos desde backups | ‚ö†Ô∏è Verifica rutas antes de ejecutar |
| 10 | [`recuperacion-completa-sistema.bat`](scripts/55-recuperar-informacion/recuperacion-completa-sistema.bat) | Recuperaci√≥n completa del sistema | ‚ö†Ô∏è Solo en modo recuperaci√≥n, backup previo recomendado |

#### Ejecuci√≥n de scripts

1. Descarga o copia el script correspondiente desde el directorio [`scripts/55-recuperar-informacion`](scripts/55-recuperar-informacion/).
2. Ejecuta el script desde la consola con privilegios de administrador:
   - Para Batch: `./nombre-del-script.bat`
   - Para PowerShell: `powershell -ExecutionPolicy Bypass -File ./nombre-del-script.ps1`
3. Consulta la descripci√≥n y advertencias antes de ejecutar cada script.

> Ejemplos directos de comandos y fragmentos se mantienen en la secci√≥n de comandos principales. Los scripts completos est√°n referenciados en la tabla anterior.

### **Ejemplo 2: Recuperar sector de arranque**
**Prop√≥sito**: Reparar el sector de arranque da√±ado para restaurar la capacidad de inicio del sistema.

**Script:** [`scripts/55-recuperar-informacion/recuperar-sector-arranque.bat`](scripts/55-recuperar-informacion/recuperar-sector-arranque.bat)

Este script verifica el entorno de recuperaci√≥n y repara el sector de arranque utilizando los comandos bootrec para restaurar la capacidad de inicio del sistema.

### **Ejemplo 3: Recuperar MFT corrupta**
**Prop√≥sito**: Reparar la Tabla de Archivos Maestra (MFT) corrupta para restaurar acceso a archivos.

**Script:** [`scripts/55-recuperar-informacion/recuperar-mft-corrupta.bat`](scripts/55-recuperar-informacion/recuperar-mft-corrupta.bat)

Este script repara la MFT corrupta verificando la integridad del sistema de archivos, reparando archivos del sistema y verificando la imagen del sistema.

### **Ejemplo 4: Recuperar partici√≥n perdida**
**Prop√≥sito**: Recuperar una partici√≥n que ha sido eliminada accidentalmente o se ha vuelto inaccesible.

```batch
@echo off
echo ========================================
echo  RECUPERAR PARTICION PERDIDA
echo ========================================
echo.

REM Listar discos disponibles
echo Discos disponibles:
diskpart /s <(echo list disk)

echo.
set /p disco="Numero de disco a analizar: "

REM Crear script para recuperar partici√≥n
echo select disk %disco% > recover_partition.txt
echo list partition >> recover_partition.txt
echo list volume >> recover_partition.txt

REM Buscar particiones eliminadas
echo.
echo Buscando particiones eliminadas...
echo select disk %disco% >> recover_partition.txt
echo list partition >> recover_partition.txt

REM Intentar recuperar partici√≥n
echo.
echo Intentando recuperar partici√≥n...
echo select disk %disco% >> recover_partition.txt
echo recover >> recover_partition.txt

echo exit >> recover_partition.txt

diskpart /s recover_partition.txt
del recover_partition.txt

echo Partici√≥n recuperada si fue encontrada
echo Verifique con: diskpart /s <(echo list volume)
pause
```

### **Ejemplo 5: Recuperar datos de disco da√±ado**
**Prop√≥sito**: Extraer datos de un disco f√≠sicamente da√±ado utilizando t√©cnicas de bajo nivel.

```batch
@echo off
echo ========================================
echo  RECUPERAR DATOS DE DISCO DA√ëADO
echo ========================================
echo.

set /p disco="Numero de disco da√±ado: "
set /p destino="Unidad de destino para datos: "

REM Crear directorio de recuperaci√≥n
mkdir "%destino%:\Recuperacion_Disco_%disco%" 2>nul

REM Script para recuperaci√≥n de bajo nivel
echo select disk %disco% > disk_recovery.txt
echo list partition >> disk_recovery.txt
echo list volume >> disk_recovery.txt

REM Intentar montar vol√∫menes
echo.
echo Intentando montar vol√∫menes...
echo select disk %disco% >> disk_recovery.txt
echo list volume >> disk_recovery.txt

REM Para cada volumen encontrado, intentar asignar letra
echo select volume 0 >> disk_recovery.txt
echo assign letter=T >> disk_recovery.txt

echo exit >> disk_recovery.txt

diskpart /s disk_recovery.txt
del disk_recovery.txt

REM Copiar datos si el volumen se mont√≥
if exist T:\ (
    echo Copiando datos del volumen T:...
    xcopy T:\ "%destino%:\Recuperacion_Disco_%disco%\" /E /H /C /I /Y
    
    REM Desmontar volumen temporal
    echo select volume T > unmount_temp.txt
    echo remove letter=T >> unmount_temp.txt
    echo exit >> unmount_temp.txt
    diskpart /s unmount_temp.txt
    del unmount_temp.txt
    
    echo Datos copiados a %destino%:\Recuperacion_Disco_%disco%\
) else (
    echo No se pudo montar el volumen para recuperaci√≥n
)

pause
```

### **Ejemplo 6: Restaurar sistema desde punto de restauraci√≥n**
**Prop√≥sito**: Restaurar el sistema a un estado anterior funcional utilizando puntos de restauraci√≥n.

```batch
@echo off
echo ========================================
echo  RESTAURAR SISTEMA
echo ========================================
echo.

REM Listar puntos de restauraci√≥n disponibles
echo Puntos de restauraci√≥n disponibles:
wmic.exe /Namespace:\\root\default Path SystemRestore Call GetRestorePoints

echo.
set /p punto="ID del punto de restauraci√≥n: "

REM Crear script de restauraci√≥n
echo @echo off > restore_system.bat
echo echo Restaurando sistema al punto %punto%... >> restore_system.bat
echo rstrui.exe /restorepoint:%punto% >> restore_system.bat
echo pause >> restore_system.bat

echo Script de restauraci√≥n creado: restore_system.bat
echo Ejecute el script como administrador para restaurar
echo.
echo ADVERTENCIA: Esto reiniciar√° el sistema
pause
```

### **Ejemplo 7: Recuperar contrase√±as del sistema**
**Prop√≥sito**: Recuperar o resetear contrase√±as de usuarios del sistema cuando se han perdido.

```batch
@echo off
echo ========================================
echo  RECUPERAR CONTRASE√ëAS DEL SISTEMA
echo ========================================
echo.

REM Listar usuarios del sistema
echo Usuarios del sistema:
net user

echo.
set /p usuario="Usuario a recuperar: "

REM Crear script para resetear contrase√±a
echo @echo off > reset_password.bat
echo echo Reseteando contrase√±a para %usuario%... >> reset_password.bat
echo net user %usuario% * >> reset_password.bat
echo echo Contrase√±a reseteada >> reset_password.bat
echo pause >> reset_password.bat

echo Script creado: reset_password.bat
echo Ejecute como administrador para resetear contrase√±a
echo.

REM Alternativa: habilitar cuenta de administrador
echo Habilitando cuenta de administrador...
net user administrator /active:yes
net user administrator *

echo Cuenta de administrador habilitada
echo Contrase√±a: (vac√≠a)
pause
```

### **Ejemplo 8: Recuperar configuraci√≥n de red**
**Prop√≥sito**: Restaurar la configuraci√≥n de red cuando se ha perdido conectividad.

```batch
@echo off
echo ========================================
echo  RECUPERAR CONFIGURACION DE RED
echo ========================================
echo.

REM Resetear configuraci√≥n de red
echo Reseteando configuraci√≥n de red...

REM Liberar y renovar IP
ipconfig /release
ipconfig /renew

REM Flush DNS
ipconfig /flushdns

REM Resetear Winsock
netsh winsock reset

REM Resetear configuraci√≥n de TCP/IP
netsh int ip reset

REM Reiniciar servicios de red
net stop dnscache
net start dnscache

net stop "DHCP Client"
net start "DHCP Client"

REM Verificar conectividad
echo.
echo Verificando conectividad...
ping 8.8.8.8 -n 4

echo Configuraci√≥n de red reseteada
pause
```

### **Ejemplo 9: Recuperar archivos de backup**
**Prop√≥sito**: Restaurar archivos desde copias de seguridad autom√°ticas o manuales.

```batch
@echo off
echo ========================================
echo  RECUPERAR ARCHIVOS DE BACKUP
echo ========================================
echo.

set /p backup_path="Ruta del backup: "
set /p destino="Ruta de destino: "

REM Verificar si existe el backup
if not exist "%backup_path%" (
    echo ERROR: No se encontr√≥ el backup en %backup_path%
    pause
    exit /b 1
)

REM Crear directorio de destino
mkdir "%destino%" 2>nul

REM Restaurar archivos
echo Restaurando archivos...
if exist "%backup_path%\*.zip" (
    REM Backup comprimido
    for %%f in ("%backup_path%\*.zip") do (
        echo Extrayendo %%f...
        powershell -command "Expand-Archive -Path '%%f' -DestinationPath '%destino%' -Force"
    )
) else (
    REM Backup directo
    xcopy "%backup_path%" "%destino%" /E /H /C /I /Y
)

REM Verificar restauraci√≥n
echo.
echo Verificando restauraci√≥n...
dir "%destino%"

echo Archivos restaurados en %destino%
pause
```

### **Ejemplo 10: Recuperar sistema completo**
**Prop√≥sito**: Script completo para recuperaci√≥n de sistema en caso de fallo cr√≠tico.

```batch
@echo off
echo ========================================
echo  RECUPERACION COMPLETA DEL SISTEMA
echo ========================================
echo.

REM Verificar modo de recuperaci√≥n
echo Verificando entorno de recuperaci√≥n...
if not exist "C:\Windows\System32\winload.exe" (
    echo ERROR: Ejecute desde modo recuperaci√≥n
    pause
    exit /b 1
)

echo Iniciando recuperaci√≥n completa del sistema...
echo.

REM Paso 1: Reparar sector de arranque
echo [1/6] Reparando sector de arranque...
bootrec /fixmbr
bootrec /fixboot
bootrec /rebuildbcd

REM Paso 2: Verificar integridad del disco
echo [2/6] Verificando integridad del disco...
chkdsk C: /f /r /x

REM Paso 3: Reparar archivos del sistema
echo [3/6] Reparando archivos del sistema...
sfc /scannow

REM Paso 4: Reparar imagen del sistema
echo [4/6] Reparando imagen del sistema...
DISM /Online /Cleanup-Image /RestoreHealth

REM Paso 5: Verificar servicios cr√≠ticos
echo [5/6] Verificando servicios cr√≠ticos...
sc query "Windows Update" | find "RUNNING" >nul
if errorlevel 1 (
    echo Reiniciando servicio Windows Update...
    net stop wuauserv
    net start wuauserv
)

REM Paso 6: Verificar conectividad de red
echo [6/6] Verificando conectividad de red...
ipconfig /renew
ipconfig /flushdns

echo.
echo ========================================
echo    RECUPERACION COMPLETADA
echo ========================================
echo.
echo Sistema recuperado exitosamente
echo Reinicie el sistema para aplicar cambios
pause
```

## üîß Scripts Avanzados

### **Script para Sistema de Recuperaci√≥n Autom√°tica**

```batch
@echo off
setlocal enabledelayedexpansion
title SISTEMA DE RECUPERACION AUTOMATICA

echo ========================================
echo  SISTEMA DE RECUPERACION AUTOMATICA
echo ========================================
echo.

:menu_principal
cls
echo ========================================
echo    SISTEMA DE RECUPERACION
echo ========================================
echo.
echo 1. Recuperar archivos eliminados
echo 2. Reparar sector de arranque
echo 3. Recuperar MFT corrupta
echo 4. Recuperar partici√≥n perdida
echo 5. Recuperar datos de disco da√±ado
echo 6. Restaurar sistema
echo 7. Recuperar contrase√±as
echo 8. Recuperar configuraci√≥n de red
echo 9. Recuperar archivos de backup
echo 10. Recuperaci√≥n completa del sistema
echo 11. Crear punto de restauraci√≥n
echo 12. Verificar integridad del sistema
echo 13. Salir
echo.
set /p opcion="Seleccione una opcion: "

if "%opcion%"=="1" goto recuperar_archivos
if "%opcion%"=="2" goto reparar_arranque
if "%opcion%"=="3" goto recuperar_mft
if "%opcion%"=="4" goto recuperar_particion
if "%opcion%"=="5" goto recuperar_disco
if "%opcion%"=="6" goto restaurar_sistema
if "%opcion%"=="7" goto recuperar_password
if "%opcion%"=="8" goto recuperar_red
if "%opcion%"=="9" goto recuperar_backup
if "%opcion%"=="10" goto recuperacion_completa
if "%opcion%"=="11" goto crear_restore_point
if "%opcion%"=="12" goto verificar_integridad
if "%opcion%"=="13" goto salir
goto menu_principal

:recuperar_archivos
cls
echo ========================================
echo    RECUPERAR ARCHIVOS ELIMINADOS
echo ========================================
echo.
set /p unidad="Unidad a escanear: "
set /p patron="Patr√≥n de archivos (ej: *.docx): "
set /p destino="Directorio de destino: "

mkdir "%destino%" 2>nul

REM Usar PowerShell para recuperaci√≥n avanzada
powershell -command "& { $files = Get-ChildItem -Path '%unidad%:\' -Recurse -Force | Where-Object { $_.Name -like '%patron%' -and $_.Attributes -match 'Hidden' }; foreach($f in $files) { Copy-Item $f.FullName -Destination '%destino%' -Force; Write-Host 'Recuperado:' $f.Name } }"

echo Recuperaci√≥n de archivos completada
pause
goto menu_principal

:reparar_arranque
cls
echo ========================================
echo    REPARAR SECTOR DE ARRANQUE
echo ========================================
echo.
echo Reparando sector de arranque...
bootrec /fixmbr
bootrec /fixboot
bootrec /rebuildbcd
echo Sector de arranque reparado
pause
goto menu_principal

:recuperar_mft
cls
echo ========================================
echo    RECUPERAR MFT CORRUPTA
echo ========================================
echo.
echo Reparando MFT...
chkdsk C: /f /r /x
sfc /scannow
DISM /Online /Cleanup-Image /RestoreHealth
echo MFT reparada
pause
goto menu_principal

:recuperar_particion
cls
echo ========================================
echo    RECUPERAR PARTICION PERDIDA
echo ========================================
echo.
set /p disco="N√∫mero de disco: "

echo select disk %disco% > temp_recover.txt
echo list partition >> temp_recover.txt
echo recover >> temp_recover.txt
echo exit >> temp_recover.txt

diskpart /s temp_recover.txt
del temp_recover.txt

echo Partici√≥n recuperada
pause
goto menu_principal

:recuperar_disco
cls
echo ========================================
echo    RECUPERAR DATOS DE DISCO DA√ëADO
echo ========================================
echo.
set /p disco="Disco da√±ado: "
set /p destino="Unidad de destino: "

mkdir "%destino%:\Recuperacion_Disco_%disco%" 2>nul

echo select disk %disco% > temp_disk.txt
echo list volume >> temp_disk.txt
echo select volume 0 >> temp_disk.txt
echo assign letter=T >> temp_disk.txt
echo exit >> temp_disk.txt

diskpart /s temp_disk.txt
del temp_disk.txt

if exist T:\ (
    xcopy T:\ "%destino%:\Recuperacion_Disco_%disco%\" /E /H /C /I /Y
    
    echo select volume T > temp_unmount.txt
    echo remove letter=T >> temp_unmount.txt
    echo exit >> temp_unmount.txt
    diskpart /s temp_unmount.txt
    del temp_unmount.txt
    
    echo Datos recuperados
) else (
    echo No se pudo acceder al disco
)

pause
goto menu_principal

:restaurar_sistema
cls
echo ========================================
echo    RESTAURAR SISTEMA
echo ========================================
echo.
echo Puntos de restauraci√≥n disponibles:
wmic.exe /Namespace:\\root\default Path SystemRestore Call GetRestorePoints

echo.
set /p punto="ID del punto de restauraci√≥n: "
echo rstrui.exe /restorepoint:%punto% > restore.bat
echo Script de restauraci√≥n creado: restore.bat
pause
goto menu_principal

:recuperar_password
cls
echo ========================================
echo    RECUPERAR CONTRASE√ëAS
echo ========================================
echo.
echo Usuarios del sistema:
net user

echo.
set /p usuario="Usuario a recuperar: "
echo net user %usuario% * > reset_pass.bat
echo Script creado: reset_pass.bat
echo.
echo Habilitando cuenta de administrador...
net user administrator /active:yes
net user administrator *
echo Administrador habilitado
pause
goto menu_principal

:recuperar_red
cls
echo ========================================
echo    RECUPERAR CONFIGURACION DE RED
echo ========================================
echo.
echo Reseteando red...
ipconfig /release
ipconfig /renew
ipconfig /flushdns
netsh winsock reset
netsh int ip reset
net stop dnscache
net start dnscache
echo Red reseteada
pause
goto menu_principal

:recuperar_backup
cls
echo ========================================
echo    RECUPERAR ARCHIVOS DE BACKUP
echo ========================================
echo.
set /p backup="Ruta del backup: "
set /p destino="Destino: "

mkdir "%destino%" 2>nul

if exist "%backup%\*.zip" (
    for %%f in ("%backup%\*.zip") do (
        powershell -command "Expand-Archive -Path '%%f' -DestinationPath '%destino%' -Force"
    )
) else (
    xcopy "%backup%" "%destino%" /E /H /C /I /Y
)

echo Backup restaurado
pause
goto menu_principal

:recuperacion_completa
cls
echo ========================================
echo    RECUPERACION COMPLETA
echo ========================================
echo.
echo Iniciando recuperaci√≥n completa...
bootrec /fixmbr
bootrec /fixboot
bootrec /rebuildbcd
chkdsk C: /f /r /x
sfc /scannow
DISM /Online /Cleanup-Image /RestoreHealth
ipconfig /renew
ipconfig /flushdns
echo Recuperaci√≥n completa finalizada
pause
goto menu_principal

:crear_restore_point
cls
echo ========================================
echo    CREAR PUNTO DE RESTAURACION
echo ========================================
echo.
echo Creando punto de restauraci√≥n...
wmic.exe /Namespace:\\root\default Path SystemRestore Call CreateRestorePoint "Recuperacion Manual", 100, 7
echo Punto de restauraci√≥n creado
pause
goto menu_principal

:verificar_integridad
cls
echo ========================================
echo    VERIFICAR INTEGRIDAD
echo ========================================
echo.
echo Verificando integridad del sistema...
chkdsk C: /f
sfc /scannow
DISM /Online /Cleanup-Image /ScanHealth
echo Verificaci√≥n completada
pause
goto menu_principal

:salir
echo Gracias por usar el sistema de recuperaci√≥n
exit /b 0
```

### **Script para Sistema de Recuperaci√≥n Avanzada con Logging**

```batch
@echo off
setlocal enabledelayedexpansion
title SISTEMA DE RECUPERACION AVANZADA

echo ========================================
echo  SISTEMA DE RECUPERACION AVANZADA
echo ========================================
echo.

REM Configurar logging
set "log_file=recovery_log_%date:~-4,4%%date:~-10,2%%date:~-7,2%_%time:~0,2%%time:~3,2%%time:~6,2%.txt"
set "log_file=%log_file: =0%"

echo ======================================== > %log_file%
echo RECOVERY LOG - %date% %time% >> %log_file%
echo ======================================== >> %log_file%

REM Funci√≥n para logging
:log
echo [%time%] %~1 >> %log_file%
echo %~1
goto :eof

REM Detectar problemas del sistema
call :log "Detectando problemas del sistema..."

REM Verificar espacio en disco
for %%d in (C D E F) do (
    if exist %%d:\ (
        for /f "tokens=3" %%s in ('dir %%d:\ ^| find "bytes free"') do (
            set "free_space=%%s"
            set "free_space=!free_space:,=!"
            set /a free_gb=!free_space!/1073741824
            
            if !free_gb! lss 5 (
                call :log "ADVERTENCIA: %%d: tiene solo !free_gb! GB libres"
            )
        )
    )
)

REM Verificar servicios cr√≠ticos
call :log "Verificando servicios cr√≠ticos..."
for %%s in (wuauserv dnscache dhcp) do (
    sc query "%%s" | find "RUNNING" >nul
    if errorlevel 1 (
        call :log "ERROR: Servicio %%s no est√° ejecut√°ndose"
    ) else (
        call :log "OK: Servicio %%s ejecut√°ndose"
    )
)

REM Verificar conectividad de red
call :log "Verificando conectividad de red..."
ping 8.8.8.8 -n 1 >nul
if errorlevel 1 (
    call :log "ERROR: Sin conectividad de red"
    call :log "Intentando reparar red..."
    ipconfig /release >nul 2>&1
    ipconfig /renew >nul 2>&1
    ipconfig /flushdns >nul 2>&1
) else (
    call :log "OK: Conectividad de red funcional"
)

REM Verificar integridad del sistema
call :log "Verificando integridad del sistema..."
sfc /scannow >nul 2>&1
if errorlevel 1 (
    call :log "ERROR: Archivos del sistema corruptos"
    call :log "Iniciando reparaci√≥n autom√°tica..."
    DISM /Online /Cleanup-Image /RestoreHealth >nul 2>&1
) else (
    call :log "OK: Integridad del sistema verificada"
)

REM Crear punto de restauraci√≥n autom√°tico
call :log "Creando punto de restauraci√≥n autom√°tico..."
wmic.exe /Namespace:\\root\default Path SystemRestore Call CreateRestorePoint "Recuperacion Automatica", 100, 7 >nul 2>&1

REM Generar reporte final
call :log "Generando reporte final..."
echo. >> %log_file%
echo ======================================== >> %log_file%
echo RESUMEN DE RECUPERACION >> %log_file%
echo ======================================== >> %log_file%

echo Estado del sistema: >> %log_file%
systeminfo | findstr /C:"OS Name" /C:"OS Version" /C:"Total Physical Memory" >> %log_file%

echo. >> %log_file%
echo Espacio en disco: >> %log_file%
for %%d in (C D E F) do (
    if exist %%d:\ (
        dir %%d:\ | find "bytes free" >> %log_file%
    )
)

echo. >> %log_file%
echo Servicios cr√≠ticos: >> %log_file%
for %%s in (wuauserv dnscache dhcp) do (
    sc query "%%s" | find "STATE" >> %log_file%
)

call :log "Recuperaci√≥n autom√°tica completada"
call :log "Log guardado en: %log_file%"

echo.
echo ========================================
echo    RECUPERACION AUTOMATICA COMPLETADA
echo ========================================
echo.
echo Log detallado: %log_file%
echo.
pause
```

## üí° Consejos Importantes

### **Prevenci√≥n**
- **Backup regular**: Mant√©n copias de seguridad actualizadas
- **Puntos de restauraci√≥n**: Crea puntos antes de cambios importantes
- **Monitoreo**: Supervisa el estado del sistema regularmente

### **Seguridad**
- **Verificaci√≥n**: Siempre verifica la integridad despu√©s de recuperaciones
- **Pruebas**: Prueba procedimientos de recuperaci√≥n en entornos seguros
- **Documentaci√≥n**: Mant√©n registro detallado de todas las recuperaciones

### **Mejores Pr√°cticas**
- **Planificaci√≥n**: Ten un plan de recuperaci√≥n documentado
- **Herramientas**: Mant√©n herramientas de recuperaci√≥n actualizadas
- **Entrenamiento**: Capacita al personal en procedimientos de recuperaci√≥n

## üåç Casos de Uso Reales

### **Administraci√≥n de Sistemas**
- **Recuperaci√≥n de servidores**: Restauraci√≥n r√°pida de servicios cr√≠ticos
- **Recuperaci√≥n de datos**: Salvaguarda de informaci√≥n empresarial
- **Recuperaci√≥n de desastres**: Planes de contingencia para emergencias

### **Educativo**
- **Laboratorios**: Recuperaci√≥n de configuraciones de pr√°ctica
- **Investigaci√≥n**: Protecci√≥n de datos experimentales
- **Desarrollo**: Recuperaci√≥n de entornos de desarrollo

### **Empresarial**
- **Compliance**: Cumplimiento de pol√≠ticas de recuperaci√≥n
- **Continuidad**: Mantenimiento de operaciones cr√≠ticas
- **Auditor√≠a**: Trazabilidad de procesos de recuperaci√≥n

## üéØ Conclusi√≥n y Pr√≥ximos Pasos

¬°Felicitaciones! Has completado un viaje extraordinario a trav√©s de la administraci√≥n avanzada de Windows desde la consola. Desde los comandos b√°sicos hasta las t√©cnicas m√°s sofisticadas de recuperaci√≥n de datos, has desarrollado un conjunto completo de habilidades que te convertir√°n en un administrador de sistemas excepcional.

A lo largo de estos 55 cap√≠tulos, has aprendido a:
- **Gestionar archivos y directorios** con precisi√≥n y eficiencia
- **Automatizar tareas** con scripts avanzados y PowerShell
- **Administrar usuarios y permisos** de forma segura
- **Configurar servicios de red** como FTP, DHCP y DNS
- **Gestionar almacenamiento** con particiones, vol√∫menes y recuperaci√≥n
- **Optimizar sistemas** para m√°ximo rendimiento
- **Recuperar datos** en situaciones cr√≠ticas

Estas habilidades te abrir√°n puertas en el mundo profesional, desde administraci√≥n de sistemas hasta DevOps, ciberseguridad y consultor√≠a t√©cnica. El conocimiento que has adquirido es fundamental para cualquier carrera en tecnolog√≠a.

**¬øQu√© sigue?** Te recomiendo:
1. **Practicar** todos los comandos y scripts en entornos seguros
2. **Certificarte** en Microsoft Windows Server o Azure
3. **Especializarte** en √°reas como ciberseguridad, cloud computing o DevOps
4. **Contribuir** a la comunidad t√©cnica compartiendo tu conocimiento

¬°El futuro de la administraci√≥n de sistemas te espera! üöÄ

---

## üìö Enlaces Relacionados

- [Cap√≠tulo 54: Desmontar, Extender vol√∫menes de disco](54.%20Desmontar%2C%20Extender%20vol√∫menes%20de%20disco.md)
- [Cap√≠tulo 52: Formatear discos](52.%20Formatear%20discos.md)
- [Cap√≠tulo 50: Optimizar y desfragmentar disco](50.%20Optimizar%20y%20desfragmentar%20disco.md)

## üë®‚Äçüíª Autor

**Jerson Mart√≠nez** - [jersonmartinez.com](https://jersonmartinez.com) | [crashell.com](https://crashell.com)

---

## üìñ Fuentes

1. Microsoft Docs - Data Recovery and Backup
2. Microsoft Docs - System Restore and Recovery
3. Windows PowerShell Documentation - Recovery Cmdlets
4. Microsoft Learn - Disaster Recovery
5. Windows Command Line Reference
6. Data Recovery Best Practices
7. System Recovery Procedures
8. Windows Server Backup and Recovery 
