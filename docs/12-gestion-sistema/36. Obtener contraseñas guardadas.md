# 36. Obtener contraseÃ±as guardadas

> *"Las contraseÃ±as son las llaves digitales de nuestro mundo. Â¿SabÃ­as que Windows almacena muchas contraseÃ±as de forma segura y puedes recuperarlas desde la lÃ­nea de comandos cuando sea necesario?"* ğŸ”‘

## IntroducciÃ³n

En el mundo digital actual, las contraseÃ±as son fundamentales para acceder a servicios, aplicaciones y recursos del sistema. Windows almacena estas credenciales de manera segura en diferentes ubicaciones, y como administrador de sistemas, necesitas saber cÃ³mo recuperarlas cuando sea necesario.

Â¿Te imaginas un servidor crÃ­tico donde el administrador anterior no dejÃ³ documentaciÃ³n de las contraseÃ±as? Â¿O una aplicaciÃ³n empresarial que requiere credenciales especÃ­ficas que se perdieron? Estas son situaciones reales donde la capacidad de recuperar contraseÃ±as guardadas puede ser crucial para mantener la operatividad del sistema.

En este capÃ­tulo, aprenderÃ¡s tÃ©cnicas profesionales para recuperar y gestionar contraseÃ±as almacenadas en Windows, desde credenciales del sistema hasta contraseÃ±as de aplicaciones.

## Conceptos Clave

### ğŸ”‘ **Credenciales Guardadas**
InformaciÃ³n de autenticaciÃ³n almacenada de forma segura en el sistema Windows.

### ğŸ›¡ï¸ **Administrador de Credenciales**
Sistema integrado de Windows para gestionar contraseÃ±as y credenciales.

### ğŸ” **Cifrado de ContraseÃ±as**
Proceso de protecciÃ³n de contraseÃ±as mediante algoritmos de encriptaciÃ³n.

### ğŸ“‹ **PolÃ­tica de Seguridad**
Conjunto de reglas que definen cÃ³mo se manejan las credenciales en el sistema.

## Comandos y herramientas principales

### `CMDKEY`
Comando principal para gestionar credenciales almacenadas en Windows de manera segura.

**Sintaxis bÃ¡sica:**
```batch
cmdkey [opciones]
```

**ParÃ¡metros principales:**
- `/list` - Listar todas las credenciales almacenadas en el sistema
- `/add:target` - Agregar nueva credencial para un objetivo especÃ­fico
- `/delete:target` - Eliminar credencial especÃ­fica por nombre de objetivo
- `/generic:target` - Especificar credencial genÃ©rica para un objetivo
- `/user:username` - Especificar nombre de usuario para la credencial
- `/pass:password` - Especificar contraseÃ±a para la credencial
- `/smartcard` - Usar credencial de tarjeta inteligente

### `POWERSHELL` (Get-StoredCredential)
Cmdlet de PowerShell para acceder y gestionar credenciales almacenadas de manera avanzada.

**Sintaxis:**
```powershell
Get-StoredCredential -Target "nombre_servicio"
Add-StoredCredential -Target "servidor" -UserName "usuario" -Password "contraseÃ±a"
Remove-StoredCredential -Target "servidor"
```

### `REG QUERY`
Comando para consultar el registro de Windows donde se almacenan algunas credenciales y configuraciones de seguridad.

**Sintaxis:**
```batch
reg query [ruta_clave] /v [nombre_valor]
reg query "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Credentials" /s
```

**ParÃ¡metros:**
- `ruta_clave` - Ruta de la clave del registro a consultar
- `/v nombre_valor` - Nombre especÃ­fico del valor a consultar
- `/s` - Buscar recursivamente en subclaves

### `CERTUTIL`
Comando para gestionar certificados digitales y credenciales relacionadas con PKI.

**Sintaxis:**
```batch
certutil [opciones] [archivo]
certutil -store MY
certutil -dump [archivo_certificado]
```

**Opciones comunes:**
- `-store` - Mostrar certificados en un almacÃ©n especÃ­fico
- `-dump` - Mostrar informaciÃ³n detallada de un certificado
- `-export` - Exportar certificado a archivo
- `-import` - Importar certificado desde archivo

### Comandos adicionales utilizados
- `FINDSTR` - Buscar patrones especÃ­ficos en la salida de comandos
- `FOR /F` - Procesar archivos lÃ­nea por lÃ­nea para automatizaciÃ³n
- `IF` - Condiciones en scripts para verificar resultados
- `PAUSE` - Pausar ejecuciÃ³n del script
- `ECHO` - Mostrar mensajes informativos
- `DATE` - Obtener fecha actual para nombres de archivos
- `TIME` - Obtener hora actual para timestamps

## Ejemplos PrÃ¡cticos

### 1. **Listar Credenciales Guardadas**
**PropÃ³sito:** Ver todas las credenciales almacenadas en el sistema.

```batch
cmdkey /list
```

**Casos de uso reales:**
- AuditorÃ­a de credenciales del sistema
- VerificaciÃ³n de cuentas almacenadas
- DiagnÃ³stico de problemas de autenticaciÃ³n

### 2. **Agregar Nueva Credencial**
**PropÃ³sito:** Almacenar una nueva credencial para uso posterior.

```batch
cmdkey /add:servidor.local /user:administrador /pass:MiContraseÃ±a123
```

**Casos de uso reales:**
- ConfiguraciÃ³n de acceso a servidores remotos
- AutomatizaciÃ³n de scripts que requieren autenticaciÃ³n
- GestiÃ³n de credenciales de servicios

### 3. **Eliminar Credencial EspecÃ­fica**
**PropÃ³sito:** Remover una credencial almacenada del sistema.

```batch
cmdkey /delete:servidor.local
```

**Casos de uso reales:**
- Limpieza de credenciales obsoletas
- RotaciÃ³n de credenciales de seguridad
- Mantenimiento de credenciales del sistema

### 4. **Buscar Credenciales por PatrÃ³n**
**PropÃ³sito:** Encontrar credenciales que coincidan con un patrÃ³n especÃ­fico.

```batch
cmdkey /list | findstr "servidor"
```

**Casos de uso reales:**
- BÃºsqueda de credenciales especÃ­ficas
- AuditorÃ­a de acceso a servidores
- VerificaciÃ³n de configuraciÃ³n de red

### 5. **Exportar Credenciales a Archivo**
**PropÃ³sito:** Guardar la lista de credenciales en un archivo para auditorÃ­a.

```batch
cmdkey /list > credenciales_%date:~-4,4%%date:~-10,2%%date:~-7,2%.txt
```

**Casos de uso reales:**
- AuditorÃ­as de seguridad
- DocumentaciÃ³n de credenciales
- Backup de configuraciÃ³n

### 6. **Verificar Credenciales de Red**
**PropÃ³sito:** Comprobar credenciales almacenadas para conexiones de red.

```batch
cmdkey /list | findstr "TERMSRV"
```

**Casos de uso reales:**
- DiagnÃ³stico de problemas de RDP
- VerificaciÃ³n de acceso remoto
- GestiÃ³n de conexiones de escritorio remoto

### 7. **Gestionar Credenciales de Dominio**
**PropÃ³sito:** Administrar credenciales relacionadas con el dominio de Active Directory.

```batch
cmdkey /list | findstr "DOMAIN"
```

**Casos de uso reales:**
- GestiÃ³n de credenciales corporativas
- VerificaciÃ³n de autenticaciÃ³n de dominio
- AuditorÃ­a de acceso a recursos de red

### 8. **Limpiar Credenciales Expiradas**
**PropÃ³sito:** Eliminar credenciales que ya no son vÃ¡lidas o estÃ¡n expiradas.

```batch
for /f "tokens=1,2 delims= " %%a in ('cmdkey /list ^| findstr "EXPIRO"') do cmdkey /delete:%%b
```

**Casos de uso reales:**
- Mantenimiento de seguridad
- Limpieza automÃ¡tica de credenciales
- OptimizaciÃ³n del sistema

### 9. **Verificar Credenciales de Servicios**
**PropÃ³sito:** Comprobar credenciales utilizadas por servicios del sistema.

```batch
cmdkey /list | findstr "SERVICE"
```

**Casos de uso reales:**
- DiagnÃ³stico de servicios que fallan
- VerificaciÃ³n de cuentas de servicio
- AuditorÃ­a de servicios crÃ­ticos

### 10. **Backup de Credenciales**
**PropÃ³sito:** Crear una copia de seguridad de las credenciales del sistema.

```batch
echo === BACKUP DE CREDENCIALES === > backup_credenciales.txt
echo Fecha: %date% %time% >> backup_credenciales.txt
cmdkey /list >> backup_credenciales.txt
```

**Casos de uso reales:**
- PreparaciÃ³n para migraciÃ³n de sistemas
- DocumentaciÃ³n de configuraciÃ³n
- RecuperaciÃ³n ante desastres



## Consejos Importantes

### âš¡ **OptimizaciÃ³n**
- Revisa regularmente las credenciales almacenadas
- Elimina credenciales obsoletas o expiradas
- MantÃ©n un inventario actualizado de credenciales

### ğŸ›¡ï¸ **Seguridad**
- Usa credenciales fuertes y Ãºnicas
- Implementa rotaciÃ³n regular de contraseÃ±as
- Documenta cambios en credenciales crÃ­ticas

### ğŸ”§ **Mejores PrÃ¡cticas**
- Usa cmdkey para gestiÃ³n programÃ¡tica de credenciales
- Implementa auditorÃ­as regulares de credenciales
- MantÃ©n backups de configuraciÃ³n de credenciales

## Casos de Uso Reales

### ğŸ¢ **AdministraciÃ³n de Sistemas**
- GestiÃ³n de credenciales de servidores
- AutomatizaciÃ³n de scripts con autenticaciÃ³n
- RecuperaciÃ³n de credenciales perdidas

### ğŸ« **Entornos Educativos**
- GestiÃ³n de credenciales de laboratorios
- ConfiguraciÃ³n de acceso a recursos educativos
- AuditorÃ­a de credenciales de estudiantes

### ğŸ­ **Entornos Empresariales**
- GestiÃ³n de credenciales corporativas
- Cumplimiento de polÃ­ticas de seguridad
- RecuperaciÃ³n ante incidentes

## ConclusiÃ³n y Siguiente Paso

Has aprendido a gestionar credenciales guardadas de manera profesional y segura. Ahora puedes recuperar, administrar y auditar las contraseÃ±as almacenadas en el sistema Windows de manera eficiente.

En el siguiente capÃ­tulo, exploraremos cÃ³mo **Crear red hospedada**, donde aprenderÃ¡s a configurar y gestionar redes virtuales desde la lÃ­nea de comandos. Â¿Te imaginas creando redes de prueba para desarrollo o configurando entornos de aislamiento para seguridad? Â¡Esa serÃ¡ tu prÃ³xima habilidad!

---

## Enlaces Relacionados

- [CapÃ­tulo 35: Conexiones de red](35.%20Conexiones%20de%20red.md)
- [CapÃ­tulo 37: Crear red hospedada](37.%20Crear%20red%20hospedada.md)
- [CapÃ­tulo 40: Ejecutar como Administrador - RUNAS](40.%20Ejecutar%20como%20Administrador%20-%20RUNAS.md)

## Fuentes y Referencias

- **DocumentaciÃ³n oficial de Microsoft:** [Cmdkey Command](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/cmdkey)
- **Windows Command Line Reference:** [Credential Management](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/windows-commands)
- **AdministraciÃ³n de Windows Server:** [Credential Management](https://docs.microsoft.com/en-us/windows-server/administration/)

---

## Scripts disponibles

En el directorio `scripts/36-obtener-contrasenas-guardadas/` encontrarÃ¡s los siguientes scripts para gestionar credenciales almacenadas de manera segura:

### ğŸ”‘ **GestiÃ³n de credenciales**
- **`gestor-avanzado-credenciales.bat`** - Interfaz completa para ver, agregar, eliminar, buscar y auditar credenciales del sistema
- **`recuperacion-emergencia-credenciales.bat`** - Herramienta de emergencia para recuperar credenciales crÃ­ticas en situaciones de crisis

### ğŸ“‹ **Instrucciones de uso**

1. **Para gestiÃ³n normal de credenciales:**
   ```batch
   cd scripts\36-obtener-contrasenas-guardadas
   gestor-avanzado-credenciales.bat
   ```

2. **Para situaciones de emergencia:**
   ```batch
   cd scripts\36-obtener-contrasenas-guardadas
   recuperacion-emergencia-credenciales.bat
   ```

### âš ï¸ **Notas importantes**
- Ejecuta estos scripts como administrador para acceso completo
- Ten cuidado al eliminar credenciales - verifica que no sean necesarias
- Los backups se guardan en archivos de texto con timestamp
- Documenta todas las operaciones realizadas para auditorÃ­a

### ğŸ”’ **Seguridad**
- El script de emergencia identifica credenciales crÃ­ticas automÃ¡ticamente
- Incluye verificaciones de seguridad antes de eliminar credenciales
- Genera reportes detallados para auditorÃ­a y cumplimiento
- Permite limpieza selectiva de credenciales obsoletas

---

**Autor:** Jerson MartÃ­nez  
**Sitio web:** [jersonmartinez.com](https://jersonmartinez.com)  
**Blog DevOps:** [crashell.com](https://crashell.com) 