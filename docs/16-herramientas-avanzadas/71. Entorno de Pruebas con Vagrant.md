# üñ•Ô∏è Entorno de Pruebas con Vagrant

> *"Un entorno de pruebas bien configurado es la base del aprendizaje exitoso. Vagrant nos permite crear laboratorios virtuales profesionales sin comprometer nuestro sistema principal"* - **Principio fundamental del aprendizaje pr√°ctico**

## üìã Introducci√≥n

¬øTe has preguntado alguna vez c√≥mo los profesionales de IT practican y experimentan con diferentes configuraciones sin arriesgar sus sistemas de producci√≥n? ¬øC√≥mo puedes tener un entorno Windows 10 completamente funcional para practicar todos los comandos y scripts de este curso sin instalar nada en tu m√°quina principal?

En este cap√≠tulo especial, aprender√°s a crear un **entorno de pruebas profesional** usando **Vagrant** y **VirtualBox**. Este entorno te permitir√° ejecutar todos los ejemplos pr√°cticos del curso de manera segura, aislada y completamente funcional.

## üéØ ¬øPor qu√© un Entorno Virtual?

### **Ventajas del Entorno Virtual**
- ‚úÖ **Seguridad total**: Experimenta sin riesgo en tu sistema principal
- ‚úÖ **Aislamiento completo**: Cada pr√°ctica en un entorno limpio
- ‚úÖ **Reproducibilidad**: Mismo entorno en cualquier m√°quina
- ‚úÖ **Flexibilidad**: Configuraciones espec√≠ficas para cada pr√°ctica
- ‚úÖ **Profesional**: Entorno similar al usado en empresas reales

### **Casos de Uso Reales**
- **Desarrollo de scripts**: Prueba scripts antes de producci√≥n
- **Aprendizaje**: Experimenta sin miedo a "romper" el sistema
- **Testing**: Valida configuraciones en entornos controlados
- **Demostraciones**: Muestra funcionalidades en entornos limpios

## üõ†Ô∏è Herramientas que Usaremos

### **Vagrant**
- **¬øQu√© es?**: Herramienta para crear y gestionar entornos de desarrollo virtualizados
- **Ventajas**: Automatizaci√≥n completa, configuraci√≥n como c√≥digo, portabilidad
- **Uso**: Define entornos mediante archivos de configuraci√≥n

### **VirtualBox**
- **¬øQu√© es?**: Software de virtualizaci√≥n multiplataforma
- **Ventajas**: Gratuito, estable, compatible con m√∫ltiples sistemas operativos
- **Uso**: Proporciona la capa de virtualizaci√≥n para las m√°quinas virtuales

### **Windows 10**
- **¬øQu√© es?**: Sistema operativo objetivo para nuestras pr√°cticas
- **Ventajas**: Entorno real de trabajo, compatibilidad total
- **Uso**: Sistema donde ejecutaremos todos los comandos del curso

## üìã Requisitos del Sistema

### **Software Requerido**
- [Vagrant](https://www.vagrantup.com/downloads) (versi√≥n 2.0+)
- [VirtualBox](https://www.virtualbox.org/wiki/Downloads) (versi√≥n 6.0+)
- Windows 10/11 como sistema host

### **Recursos M√≠nimos**
- **RAM**: 8GB disponible (16GB recomendado)
- **Disco**: 50GB espacio libre
- **CPU**: 4 n√∫cleos recomendados

### **Verificaci√≥n de Requisitos**
```bash
# Verificar Vagrant
vagrant --version

# Verificar VirtualBox
VBoxManage --version

# Verificar recursos del sistema
systeminfo | findstr /C:"Total Physical Memory"
```

## üöÄ Instalaci√≥n Paso a Paso

### **Paso 1: Instalar VirtualBox**

1. **Descargar VirtualBox**
   - Ve a [virtualbox.org](https://www.virtualbox.org/wiki/Downloads)
   - Descarga la versi√≥n para Windows
   - Ejecuta el instalador como administrador

2. **Configuraci√≥n de VirtualBox**
   ```bash
   # Verificar instalaci√≥n
   VBoxManage --version
   
   # Crear directorio para VMs (opcional)
   mkdir C:\VirtualMachines
   ```

### **Paso 2: Instalar Vagrant**

1. **Descargar Vagrant**
   - Ve a [vagrantup.com](https://www.vagrantup.com/downloads)
   - Descarga la versi√≥n para Windows
   - Ejecuta el instalador

2. **Verificar instalaci√≥n**
   ```bash
   # Verificar Vagrant
   vagrant --version
   
   # Verificar plugins disponibles
   vagrant plugin list
   ```

### **Paso 3: Descargar el Repositorio**

1. **Clonar el repositorio**
   ```bash
   # Usando Git
   git clone https://github.com/jersonmartinez/Curso_Administracion_Windows_Consola.git
   
   # O descargar ZIP desde GitHub
   # https://github.com/jersonmartinez/Curso_Administracion_Windows_Consola/archive/refs/heads/master.zip
   ```

2. **Navegar al directorio**
   ```bash
   cd Curso_Administracion_Windows_Consola
   cd vagrant
   ```

## üìÅ Tour por el Proyecto Vagrant

### **Estructura del Directorio**
```
vagrant/
‚îú‚îÄ‚îÄ Vagrantfile                 # üéØ Configuraci√≥n principal
‚îú‚îÄ‚îÄ env.vagrant.example         # üìù Variables de entorno (ejemplo)
‚îú‚îÄ‚îÄ .env.vagrant               # ‚öôÔ∏è Variables de entorno (personalizado)
‚îú‚îÄ‚îÄ cleanup.bat                # üßπ Script de limpieza
‚îú‚îÄ‚îÄ test-environment.bat       # üß™ Script de prueba del entorno
‚îú‚îÄ‚îÄ provision/                 # üîß Scripts de provisi√≥n
‚îÇ   ‚îú‚îÄ‚îÄ create-user.ps1        # üë§ Crear usuario y RDP
‚îÇ   ‚îú‚îÄ‚îÄ install-guest-additions.ps1  # üì¶ Instalar Guest Additions
‚îÇ   ‚îú‚îÄ‚îÄ configure-windows.ps1  # ‚öôÔ∏è Configurar Windows
‚îÇ   ‚îî‚îÄ‚îÄ install-dev-tools.ps1  # üõ†Ô∏è Instalar herramientas de desarrollo
‚îú‚îÄ‚îÄ README.md                  # üìñ Documentaci√≥n principal
‚îî‚îÄ‚îÄ RDP.md                     # üîó Gu√≠a de conexi√≥n RDP
```

### **Archivos Principales Explicados**

#### **1. Vagrantfile - El Cerebro del Proyecto**
```ruby
# -*- mode: ruby -*-
# vi: set ft=ruby :

# Windows 10 Lab Environment for Batch Script Testing
# This Vagrantfile creates a Windows 10 VM optimized for console administration

Vagrant.configure("2") do |config|
  # Load environment variables from .env.vagrant file
  env_vars = {}
  env_file = File.join(File.dirname(__FILE__), ".env.vagrant")
  
  if File.exist?(env_file)
    File.readlines(env_file).each do |line|
      next if line.strip.start_with?("#") || line.strip.empty?
      k, v = line.strip.split('=', 2)
      env_vars[k] = v if k && v
    end
  end

  # Box configuration
  config.vm.box = env_vars["VAGRANT_BOX"] || "gusztavvargadr/windows-10"
  config.vm.box_version = env_vars["VAGRANT_BOX_VERSION"] || "2506.0.0"
```

**¬øQu√© hace cada secci√≥n?**
- **Configuraci√≥n de entorno**: Carga variables desde `.env.vagrant`
- **Box configuration**: Define la imagen base de Windows 10
- **Provider configuration**: Configura VirtualBox (RAM, CPU, gr√°ficos)
- **Network configuration**: Configura red y puertos RDP
- **Provisioning**: Define los pasos de configuraci√≥n autom√°tica

#### **2. .env.vagrant - Configuraci√≥n Personalizada**
```bash
# Box configuration
VAGRANT_BOX=gusztavvargadr/windows-10
VAGRANT_BOX_VERSION=2506.0.0

# VM configuration
VAGRANT_VM_NAME=Win10-BatchLab
VAGRANT_VM_RAM=16384
VAGRANT_VM_CPUS=4
VAGRANT_VM_DISK_SIZE=120

# User credentials
VAGRANT_WIN_USER=batchtester
VAGRANT_WIN_PASS=P@ssw0rd123

# Network configuration
VAGRANT_RDP_PORT=3389
VAGRANT_HOST_ONLY_IP=192.168.56.10

# Scripts configuration
VAGRANT_SCRIPTS_PATH=../scripts
VAGRANT_SCRIPTS_DESTINATION=C:/BatchScripts
```

**Variables importantes:**
- **VAGRANT_VM_RAM**: Memoria RAM asignada (16GB por defecto)
- **VAGRANT_VM_CPUS**: N√∫mero de n√∫cleos CPU (4 por defecto)
- **VAGRANT_WIN_USER/VAGRANT_WIN_PASS**: Credenciales de acceso
- **VAGRANT_RDP_PORT**: Puerto para conexi√≥n RDP
- **VAGRANT_SCRIPTS_PATH**: Ruta a los scripts del curso

#### **3. Scripts de Provisi√≥n - Automatizaci√≥n Completa**

##### **create-user.ps1 - Creaci√≥n de Usuario**
```powershell
# Create User and Enable RDP for Windows 10 Lab
param(
    [string]$Username = $env:VAGRANT_WIN_USER,
    [string]$Password = $env:VAGRANT_WIN_PASS
)

Write-Host "Creating user account and configuring RDP..." -ForegroundColor Green

try {
    # Create user account
    $securePassword = ConvertTo-SecureString $Password -AsPlainText -Force
    New-LocalUser -Name $Username -Password $securePassword -FullName "Batch Script Tester"
    
    # Add user to Administrators group
    Add-LocalGroupMember -Group "Administrators" -Member $Username
    
    # Enable Remote Desktop
    Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server" -Name "fDenyTSConnections" -Value 0
```

**¬øQu√© hace?**
- Crea usuario `batchtester` con permisos de administrador
- Habilita Remote Desktop (RDP)
- Configura firewall para RDP
- Establece autenticaci√≥n de nivel de red (NLA)

##### **configure-windows.ps1 - Configuraci√≥n de Windows**
```powershell
# Configure Windows for Development and Script Testing
Write-Host "Configuring Windows for development environment..." -ForegroundColor Green

try {
    # Enable PowerShell execution policy for script development
    Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope LocalMachine -Force
    
    # Configure Windows Explorer for better development experience
    Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" -Name "HideFileExt" -Value 0
    
    # Configure UAC for development (less prompts)
    Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -Name "ConsentPromptBehaviorAdmin" -Value 0
```

**¬øQu√© hace?**
- Configura PowerShell para ejecutar scripts
- Muestra extensiones de archivos en Explorer
- Reduce prompts de UAC para desarrollo
- Habilita soporte para rutas largas
- Configura exclusiones de Windows Defender
- Crea accesos directos en el escritorio

##### **install-dev-tools.ps1 - Herramientas de Desarrollo**
```powershell
# Install Development Tools for Script Testing
Write-Host "Installing development tools..." -ForegroundColor Green

try {
    # Install Chocolatey if not already installed
    if (!(Get-Command choco -ErrorAction SilentlyContinue)) {
        Set-ExecutionPolicy Bypass -Scope Process -Force
        iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))
    }
    
    # Install useful development tools
    choco install notepadplusplus -y -ErrorAction SilentlyContinue
    choco install 7zip -y -ErrorAction SilentlyContinue
    choco install git -y -ErrorAction SilentlyContinue
    choco install vscode -y -ErrorAction SilentlyContinue
    choco install microsoft-windows-terminal -y -ErrorAction SilentlyContinue
    choco install sysinternals -y -ErrorAction SilentlyContinue
```

**¬øQu√© instala?**
- **Notepad++**: Editor de texto avanzado
- **7-Zip**: Compresi√≥n de archivos
- **Git**: Control de versiones
- **Visual Studio Code**: IDE moderno
- **Windows Terminal**: Terminal moderno
- **Sysinternals Suite**: Herramientas avanzadas de Windows

## üöÄ Uso del Entorno

### **Paso 1: Configurar el Entorno**
```bash
# Navegar al directorio vagrant
cd vagrant

# Copiar archivo de configuraci√≥n
copy env.vagrant.example .env.vagrant

# Editar configuraci√≥n (opcional)
notepad .env.vagrant
```

### **Paso 2: Iniciar la M√°quina Virtual**
```bash
# Iniciar VM (descarga autom√°tica de la imagen)
vagrant up

# Ver estado de la VM
vagrant status

# Ver puertos asignados
vagrant port
```

### **Paso 3: Conectarse a la VM**
```bash
# Conectar v√≠a RDP (m√©todo recomendado)
vagrant rdp

# O usar cliente RDP manual
# Host: 127.0.0.1
# Puerto: (mostrado por 'vagrant port')
# Usuario: batchtester
# Contrase√±a: P@ssw0rd123
```

### **Paso 4: Usar el Entorno**
Una vez conectado, encontrar√°s:
- **Scripts del curso**: En `C:\BatchScripts`
- **Herramientas instaladas**: Accesos directos en el escritorio
- **Entorno configurado**: PowerShell habilitado, UAC reducido
- **Directorios organizados**: test, logs, temp, backup

## üîó Conexi√≥n RDP Detallada

### **Informaci√≥n de Conexi√≥n**
| Par√°metro | Valor | Notas |
|-----------|-------|-------|
| **Host** | `127.0.0.1` | Localhost |
| **Puerto** | `3389` | Verificar con `vagrant port` |
| **Usuario** | `batchtester` | Usuario administrador |
| **Contrase√±a** | `P@ssw0rd123` | Contrase√±a segura |
| **Dominio** | (vac√≠o) | No requerido |

### **Configuraci√≥n de Cliente RDP**

#### **Windows (mstsc)**
```bash
# Abrir cliente RDP
mstsc

# O desde l√≠nea de comandos
mstsc /v:127.0.0.1:3389 /u:batchtester
```

**Configuraci√≥n recomendada:**
- **Pantalla**: Resoluci√≥n completa
- **Colores**: 24 bits
- **Experiencia**: Optimizar para conexi√≥n de √°rea local
- **Recursos locales**: Habilitar portapapeles y unidades

#### **macOS (Microsoft Remote Desktop)**
1. Descargar desde App Store
2. Configurar conexi√≥n:
   - **PC name**: `127.0.0.1:3389`
   - **User name**: `batchtester`
   - **Password**: `P@ssw0rd123`

#### **Linux (Remmina)**
```bash
# Ubuntu/Debian
sudo apt install remmina remmina-plugin-rdp

# Abrir Remmina
remmina
```

## üõ†Ô∏è Comandos √ötiles

### **Gesti√≥n de la VM**
```bash
vagrant up              # Iniciar VM
vagrant halt            # Apagar VM
vagrant reload          # Reiniciar VM
vagrant destroy -f      # Eliminar VM completamente
vagrant status          # Estado de la VM
vagrant provision       # Re-ejecutar provisi√≥n
```

### **Conexi√≥n**
```bash
vagrant rdp             # Conectar v√≠a RDP
vagrant port            # Ver puertos asignados
vagrant ssh             # Conectar v√≠a SSH (si disponible)
```

### **Mantenimiento**
```bash
cleanup.bat             # Limpiar archivos temporales
test-environment.bat    # Probar funcionalidad del entorno
```

## üêõ Troubleshooting

### **Problemas Comunes**

#### **1. VM no inicia**
```bash
# Verificar requisitos
vagrant --version
VBoxManage --version

# Limpiar y recrear
vagrant destroy -f
vagrant up
```

#### **2. Error de puerto RDP**
```bash
# Verificar puerto asignado
vagrant port

# Usar el puerto mostrado en lugar de 3389
# Ejemplo: 127.0.0.1:53389
```

#### **3. Problemas de rendimiento**
- Reducir RAM en `.env.vagrant`
- Verificar recursos del host
- Deshabilitar antivirus temporalmente

#### **4. Error de Guest Additions**
- La VM funcionar√° sin Guest Additions
- Reinstalar VirtualBox si es necesario

#### **5. Errores de instalaci√≥n de herramientas**
- **Problema**: Algunos paquetes pueden fallar por problemas de red o checksum
- **Soluci√≥n**: Las herramientas principales se instalan autom√°ticamente
- **Alternativa**: Instalar Sysinternals manualmente desde [docs.microsoft.com/sysinternals](https://docs.microsoft.com/en-us/sysinternals/)
- **Nota**: La VM funcionar√° correctamente incluso si algunas herramientas fallan

#### **6. Error "Cannot remove the last Administrator"**
- **Problema**: Error al configurar restricciones de usuario
- **Causa**: Usuario ya existe o restricciones de pol√≠tica
- **Soluci√≥n**: Es normal, el entorno seguir√° funcionando
- **Verificaci√≥n**: RDP estar√° disponible con las credenciales configuradas

### **Logs y Debugging**
```bash
vagrant up --debug      # Modo debug
vagrant provision       # Re-ejecutar provisi√≥n
```

## üéØ Casos de Uso Pr√°cticos

### **Para Aprendizaje**
- **Pruebas seguras**: Experimenta sin riesgo
- **Entorno limpio**: Cada pr√°ctica en un sistema fresco
- **Configuraci√≥n profesional**: Herramientas reales instaladas

### **Para Desarrollo**
- **Testing de scripts**: Valida antes de producci√≥n
- **Debugging**: Entorno controlado para resolver problemas
- **Experimentaci√≥n**: Prueba configuraciones avanzadas

### **Para Administraci√≥n**
- **Pruebas de pol√≠ticas**: Valida configuraciones de grupo
- **Scripts de administraci√≥n**: Prueba automatizaciones
- **Auditor√≠as**: Practica t√©cnicas de seguridad

## üìä Estructura en la VM

```
C:\BatchScripts\
‚îú‚îÄ‚îÄ test\                      # Scripts de prueba
‚îÇ   ‚îî‚îÄ‚îÄ sample-test.bat        # Script de muestra
‚îú‚îÄ‚îÄ logs\                      # Archivos de log
‚îú‚îÄ‚îÄ temp\                      # Archivos temporales
‚îú‚îÄ‚îÄ backup\                    # Copias de seguridad
‚îî‚îÄ‚îÄ [scripts del curso]        # Scripts del curso organizados
```

## üîí Seguridad del Entorno

### **Configuraciones de Seguridad**
- ‚úÖ **Sin carpetas compartidas** por defecto
- ‚úÖ **Usuario de pruebas** con contrase√±a fuerte
- ‚úÖ **Red host-only** para aislamiento
- ‚úÖ **RDP limitado** a localhost
- ‚úÖ **Provisi√≥n automatizada** y verificable

### **Buenas Pr√°cticas**
- No usar credenciales de producci√≥n
- Mantener el entorno actualizado
- Hacer backup de configuraciones importantes
- Documentar cambios personalizados

## üéì Integraci√≥n con el Curso

### **C√≥mo Usar el Entorno con el Curso**

1. **Para cada cap√≠tulo**:
   - Inicia la VM: `vagrant up`
   - Con√©ctate: `vagrant rdp`
   - Navega a `C:\BatchScripts`
   - Ejecuta los scripts del cap√≠tulo

2. **Para pr√°cticas avanzadas**:
   - Usa las herramientas instaladas (Notepad++, VS Code)
   - Experimenta con configuraciones del sistema
   - Prueba scripts de administraci√≥n

3. **Para desarrollo**:
   - Crea nuevos scripts en `C:\BatchScripts\test`
   - Usa Git para control de versiones
   - Documenta tus experimentos

## üîÑ Actualizaciones y Mantenimiento

### **Actualizar el Entorno**
```bash
# Aplicar nuevas configuraciones
vagrant provision

# Reiniciar y re-provisionar
vagrant reload --provision

# Actualizar box
vagrant box update
```

### **Backup y Restauraci√≥n**
```bash
# Exportar configuraci√≥n
vagrant package --output curso-windows-lab.box

# Importar configuraci√≥n
vagrant box add curso-windows-lab curso-windows-lab.box
```

## üéØ Conclusi√≥n y Siguiente Paso

¬°Excelente! Has configurado un entorno de pruebas profesional que te permitir√° practicar todos los comandos y scripts del curso de manera segura y eficiente. Este entorno es similar al usado por profesionales de IT en empresas reales.

### **Lo que has logrado:**
- ‚úÖ **Entorno virtualizado** completamente funcional
- ‚úÖ **Herramientas profesionales** instaladas y configuradas
- ‚úÖ **Automatizaci√≥n completa** de la configuraci√≥n
- ‚úÖ **Documentaci√≥n detallada** para uso y mantenimiento
- ‚úÖ **Integraci√≥n perfecta** con el curso

### **Pr√≥ximos pasos:**
1. **Practica los comandos** del curso en el entorno virtual
2. **Experimenta con scripts** avanzados sin riesgo
3. **Personaliza el entorno** seg√∫n tus necesidades
4. **Comparte configuraciones** con otros estudiantes

### **Recursos adicionales:**
- [Documentaci√≥n de Vagrant](https://www.vagrantup.com/docs)
- [Documentaci√≥n de VirtualBox](https://www.virtualbox.org/manual/)
- [Repositorio del curso](https://github.com/jersonmartinez/Curso_Administracion_Windows_Consola)

¬°Ahora est√°s listo para dominar la administraci√≥n de Windows desde la consola con un entorno profesional!

---

## üìö Enlaces Relacionados

- [Cap√≠tulo 70: Papelera de reciclaje](70.%20Papelera%20de%20reciclaje.md)
- [README del proyecto Vagrant](../vagrant/README.md)
- [Gu√≠a de conexi√≥n RDP](../vagrant/RDP.md)

## üîó Fuentes y Referencias

- **Vagrant Documentation**: [vagrantup.com/docs](https://www.vagrantup.com/docs)
- **VirtualBox Documentation**: [virtualbox.org/manual](https://www.virtualbox.org/manual/)
- **Windows RDP**: [docs.microsoft.com/rdp](https://docs.microsoft.com/en-us/windows-server/remote/remote-desktop-services/)
- **Chocolatey**: [chocolatey.org](https://chocolatey.org/)

---

## üìÅ Scripts Disponibles

### Scripts de Gesti√≥n
- [`test-environment.bat`](../vagrant/test-environment.bat) - Script de prueba del entorno
- [`cleanup.bat`](../vagrant/cleanup.bat) - Script de limpieza del entorno

### Scripts de Provisi√≥n
- [`create-user.ps1`](../vagrant/provision/create-user.ps1) - Creaci√≥n de usuario y configuraci√≥n RDP
- [`configure-windows.ps1`](../vagrant/provision/configure-windows.ps1) - Configuraci√≥n de Windows para desarrollo
- [`install-dev-tools.ps1`](../vagrant/provision/install-dev-tools.ps1) - Instalaci√≥n de herramientas de desarrollo

### Uso de los Scripts
1. **test-environment.bat**: Ejecutar para verificar que todo funciona correctamente
2. **cleanup.bat**: Usar para limpiar archivos temporales y restaurar estado inicial
3. **Scripts de provisi√≥n**: Se ejecutan autom√°ticamente durante `vagrant up`

---

**Autor**: [Jerson Mart√≠nez](https://jersonmartinez.com)  
**Blog**: [Crashell](https://crashell.com)  
**Repositorio**: [Curso_Administracion_Windows_Consola](https://github.com/jersonmartinez/Curso_Administracion_Windows_Consola) 