# 🌐 CURL

> *"CURL es el puente entre tu sistema y el mundo web. Con él, puedes transferir datos a cualquier lugar del planeta"* - **Principio fundamental de las transferencias web**

## 📋 Introducción

¿Te has preguntado alguna vez cómo descargar archivos desde la línea de comandos? ¿Cómo automatizar transferencias de datos entre sistemas remotos? En este capítulo, exploraremos las técnicas avanzadas para utilizar CURL en Windows.

CURL es una herramienta poderosa para transferir datos usando diversos protocolos (HTTP, HTTPS, FTP, SFTP). Aprenderemos a utilizar CURL para descargas web, transferencias de archivos, y automatización de tareas de red.

## 🎯 Conceptos Clave

### **CURL (Client URL)**
Herramienta de línea de comandos para transferir datos usando múltiples protocolos.

### **Protocolo de Transferencia**
Método de comunicación para enviar y recibir datos (HTTP, HTTPS, FTP, SFTP).

### **Headers HTTP**
Información adicional enviada con las peticiones web para controlar el comportamiento.

### **Autenticación**
Proceso de verificación de identidad para acceder a recursos protegidos.

## 🛠️ Comandos Principales

### **CURL**
```batch
CURL -O https://ejemplo.com/archivo.zip
```
Descarga un archivo desde una URL.

### **CURL con Headers**
```batch
CURL -H "User-Agent: MiScript" https://api.ejemplo.com/datos
```
Realiza peticiones con headers personalizados.

### **CURL con Autenticación**
```batch
CURL -u usuario:contraseña https://servidor.com/recurso
```
Accede a recursos protegidos con autenticación.

### **CURL con FTP**
```batch
CURL -T archivo.txt ftp://servidor.com/
```
Sube archivos a un servidor FTP.

## 💡 Ejemplos Prácticos

### **Ejemplo 1: Descarga básica de archivos**
**Propósito**: Comprender cómo usar CURL para descargar archivos desde la web de manera básica.

**Explicación del comando**: `CURL -O` descarga un archivo y lo guarda con el nombre original. Es la forma más simple de descargar archivos.

```batch
@echo off
echo ========================================
echo    DESCARGA BASICA DE ARCHIVOS
echo ========================================
echo.

echo Descargando archivos...
echo Descarga iniciada: %date% %time%

REM Descargar archivo simple
echo === DESCARGA DE ARCHIVO SIMPLE ===
curl -O https://www.ejemplo.com/archivo.txt

REM Descargar con nombre personalizado
echo.
echo === DESCARGA CON NOMBRE PERSONALIZADO ===
curl -o mi_archivo.txt https://www.ejemplo.com/archivo.txt

REM Descargar múltiples archivos
echo.
echo === DESCARGA MULTIPLE ===
curl -O https://www.ejemplo.com/archivo1.txt -O https://www.ejemplo.com/archivo2.txt

REM Verificar descargas
echo.
echo === VERIFICANDO DESCARGAS ===
dir *.txt

echo Descarga de archivos completada
pause
```

### **Ejemplo 2: Peticiones HTTP avanzadas**
**Propósito**: Aprender a usar CURL para realizar peticiones HTTP con headers personalizados y diferentes métodos.

**Explicación del comando**: CURL permite personalizar peticiones HTTP con headers, métodos y parámetros específicos.

```batch
@echo off
echo ========================================
echo    PETICIONES HTTP AVANZADAS
echo ========================================
echo.

echo Realizando peticiones HTTP avanzadas...
echo Peticiones iniciadas: %date% %time%

REM Petición GET con headers
echo === PETICION GET CON HEADERS ===
curl -H "User-Agent: MiScript/1.0" -H "Accept: application/json" https://api.ejemplo.com/datos

REM Petición POST con datos
echo.
echo === PETICION POST CON DATOS ===
curl -X POST -H "Content-Type: application/json" -d "{\"nombre\":\"test\"}" https://api.ejemplo.com/crear

REM Petición con cookies
echo.
echo === PETICION CON COOKIES ===
curl -b "session=abc123" https://www.ejemplo.com/pagina-protegida

REM Petición con seguimiento de redirecciones
echo.
echo === PETICION CON REDIRECCIONES ===
curl -L https://www.ejemplo.com/redireccion

echo Peticiones HTTP completadas
pause
```

### **Ejemplo 3: Transferencias FTP**
**Propósito**: Utilizar CURL para realizar transferencias de archivos usando protocolo FTP.

**Explicación del comando**: CURL soporta protocolo FTP para subir y descargar archivos desde servidores FTP.

```batch
@echo off
echo ========================================
echo    TRANSFERENCIAS FTP
echo ========================================
echo.

echo Realizando transferencias FTP...
echo Transferencias iniciadas: %date% %time%

REM Descargar archivo desde FTP
echo === DESCARGA DESDE FTP ===
curl -u usuario:contraseña -O ftp://servidor.com/archivo.txt

REM Subir archivo a FTP
echo.
echo === SUBIDA A FTP ===
curl -u usuario:contraseña -T archivo_local.txt ftp://servidor.com/

REM Listar directorio FTP
echo.
echo === LISTAR DIRECTORIO FTP ===
curl -u usuario:contraseña ftp://servidor.com/

REM Transferencia con modo pasivo
echo.
echo === TRANSFERENCIA MODO PASIVO ===
curl -u usuario:contraseña --ftp-pasv -T archivo.txt ftp://servidor.com/

echo Transferencias FTP completadas
pause
```

### **Ejemplo 4: Descargas con verificación**
**Propósito**: Crear un sistema de descarga con verificación de integridad y manejo de errores.

**Explicación del comando**: Este ejemplo demuestra cómo implementar descargas robustas con verificación y manejo de errores.

```batch
@echo off
echo ========================================
echo    DESCARGAS CON VERIFICACION
echo ========================================
echo.

echo Realizando descargas con verificacion...
echo Descargas iniciadas: %date% %time%

REM Configuración
set "url=https://www.ejemplo.com/archivo.zip"
set "archivo=archivo.zip"
set "intentos=3"

REM Descarga con reintentos
echo === DESCARGA CON REINTENTOS ===
for /l %%i in (1,1,%intentos%) do (
    echo Intento %%i de %intentos%
    curl -f -o "%archivo%" "%url%"
    if !errorlevel! equ 0 (
        echo Descarga exitosa
        goto verificar
    ) else (
        echo Error en descarga, reintentando...
        timeout /t 5 /nobreak >nul
    )
)

:verificar
REM Verificar archivo descargado
echo.
echo === VERIFICANDO ARCHIVO ===
if exist "%archivo%" (
    echo Archivo descargado: %archivo%
    dir "%archivo%"
) else (
    echo Error: No se pudo descargar el archivo
)

echo Descargas con verificacion completadas
pause
```

### **Ejemplo 5: Automatización de descargas**
**Propósito**: Crear un sistema automatizado para descargar múltiples archivos de diferentes fuentes.

**Explicación del comando**: Este ejemplo combina CURL con scripts batch para automatizar descargas masivas.

```batch
@echo off
echo ========================================
echo    AUTOMATIZACION DE DESCARGAS
echo ========================================
echo.

echo Automatizando descargas...
echo Automatizacion iniciada: %date% %time%

REM Configuración
set "directorio_descargas=C:\Descargas\Automaticas"
set "log_file=%directorio_descargas%\descargas_%date:~-4,4%%date:~-10,2%%date:~-7,2%.log"

REM Crear directorio de descargas
if not exist "%directorio_descargas%" mkdir "%directorio_descargas%"

REM Crear archivo de log
echo Automatizacion de descargas - %date% %time% > %log_file%

REM Lista de URLs a descargar
echo === DESCARGANDO ARCHIVOS ===
cd /d "%directorio_descargas%"

REM Descargar archivos de la lista
for %%u in (
    "https://www.ejemplo.com/archivo1.zip"
    "https://www.ejemplo.com/archivo2.txt"
    "https://www.ejemplo.com/archivo3.pdf"
) do (
    echo Descargando: %%u
    curl -O "%%u" >> %log_file% 2>&1
    if !errorlevel! equ 0 (
        echo [EXITO] Descarga completada: %%u >> %log_file%
    ) else (
        echo [ERROR] Error en descarga: %%u >> %log_file%
    )
)

echo Automatizacion de descargas completada
echo Log guardado en: %log_file%
pause
```

## 🔧 Scripts Avanzados

### **Script para Gestión Completa de CURL**

```batch
@echo off
setlocal enabledelayedexpansion
title GESTION COMPLETA DE CURL

echo ========================================
echo  GESTION COMPLETA DE CURL
echo ========================================
echo.

:menu_principal
cls
echo ========================================
echo    GESTION COMPLETA DE CURL
echo ========================================
echo.
echo 1. Descarga simple
echo 2. Descarga con verificacion
echo 3. Peticion HTTP
echo 4. Transferencia FTP
echo 5. Descarga multiple
echo 6. Monitorear descargas
echo 7. Salir
echo.
set /p opcion="Seleccione una opcion: "

if "%opcion%"=="1" goto descarga_simple
if "%opcion%"=="2" goto descarga_verificacion
if "%opcion%"=="3" goto peticion_http
if "%opcion%"=="4" goto transferencia_ftp
if "%opcion%"=="5" goto descarga_multiple
if "%opcion%"=="6" goto monitorear_descargas
if "%opcion%"=="7" goto salir
goto menu_principal

:descarga_simple
echo.
echo === DESCARGA SIMPLE ===
echo.
set /p url="URL del archivo: "
set /p archivo="Nombre del archivo: "
curl -o "%archivo%" "%url%"
echo Descarga completada
pause
goto menu_principal

:descarga_verificacion
echo.
echo === DESCARGA CON VERIFICACION ===
echo.
set /p url="URL del archivo: "
set /p archivo="Nombre del archivo: "
curl -f -o "%archivo%" "%url%"
if !errorlevel! equ 0 (
    echo Descarga exitosa
) else (
    echo Error en descarga
)
pause
goto menu_principal

:peticion_http
echo.
echo === PETICION HTTP ===
echo.
set /p url="URL: "
set /p metodo="Metodo (GET/POST): "
if "%metodo%"=="POST" (
    set /p datos="Datos POST: "
    curl -X POST -d "%datos%" "%url%"
) else (
    curl "%url%"
)
pause
goto menu_principal

:transferencia_ftp
echo.
echo === TRANSFERENCIA FTP ===
echo.
set /p servidor="Servidor FTP: "
set /p usuario="Usuario: "
set /p archivo="Archivo: "
curl -u %usuario% -T "%archivo%" "ftp://%servidor%/"
echo Transferencia completada
pause
goto menu_principal

:descarga_multiple
echo.
echo === DESCARGA MULTIPLE ===
echo.
set /p archivo_urls="Archivo con URLs: "
for /f %%u in (%archivo_urls%) do (
    echo Descargando: %%u
    curl -O "%%u"
)
echo Descargas multiples completadas
pause
goto menu_principal

:monitorear_descargas
echo.
echo === MONITOREAR DESCARGAS ===
echo.
dir *.zip *.txt *.pdf
echo Archivos descargados listados
pause
goto menu_principal

:salir
echo Gracias por usar la Gestion Completa de CURL
exit
```

## 💡 Consejos Importantes

### **Optimización**
- Usa la opción `-f` para manejar errores HTTP
- Implementa reintentos para descargas críticas
- Utiliza la opción `-L` para seguir redirecciones

### **Seguridad**
- Verifica URLs antes de descargar
- Usa HTTPS cuando sea posible
- Valida archivos descargados

### **Mejores Prácticas**
- Documenta las URLs y parámetros utilizados
- Implementa logs para monitorear descargas
- Realiza pruebas en entornos controlados

## 🌍 Casos de Uso Reales

### **Administración de Sistemas**
- Descarga automática de actualizaciones
- Backup de archivos remotos
- Monitoreo de servicios web

### **Empresarial**
- Sincronización de datos entre sistemas
- Descarga de reportes automáticos
- Integración con APIs empresariales

### **Desarrollo y Testing**
- Descarga de dependencias de desarrollo
- Testing de APIs web
- Automatización de despliegues

## 🎯 Conclusión y Siguiente Paso

¡Excelente trabajo! Has dominado las técnicas de uso de CURL en Windows. Desde descargas básicas hasta automatización avanzada, ahora tienes las herramientas necesarias para transferir datos de manera eficiente y programática.

En el siguiente capítulo, exploraremos **SHELL**, donde aprenderás a gestionar entornos de shell, configurar variables de entorno, y automatizar tareas del sistema operativo.

¡Prepárate para convertirte en un experto en gestión de shells y automatización del sistema!

---

## 📚 Enlaces Relacionados

- [Capítulo 67: Registros](67.%20Registros.md)
- [Capítulo 69: SHELL](69.%20SHELL.md)

## 🔗 Fuentes y Referencias

- **CURL Documentation**: [CURL Manual](https://curl.se/docs/)
- **CURL Windows**: [CURL for Windows](https://curl.se/windows/)
- **HTTP Methods**: [HTTP Methods](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods)

---

**Autor**: [Jerson Martínez](https://jersonmartinez.com)  
**Blog**: [Crashell](https://crashell.com)  
**Fecha**: 2024  
**Versión**: 1.0 