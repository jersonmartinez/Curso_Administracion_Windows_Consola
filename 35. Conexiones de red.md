# 35. Conexiones de red

> *"La red es el sistema circulatorio de la informática moderna. ¿Sabías que puedes diagnosticar, monitorear y gestionar todas las conexiones de red desde la línea de comandos sin necesidad de herramientas gráficas?"* 🌐

## Introducción

En el mundo interconectado de hoy, la capacidad de diagnosticar y gestionar conexiones de red es fundamental para cualquier administrador de sistemas. Desde identificar conexiones sospechosas hasta optimizar el rendimiento de la red, cada acción que realizas puede tener un impacto directo en la conectividad y seguridad del sistema.

¿Te imaginas un servidor web que no responde y necesitas identificar si es un problema de red o de aplicación? ¿O detectar una conexión maliciosa que está enviando datos a un servidor desconocido? Estas son situaciones reales donde el dominio de los comandos de red puede ser la diferencia entre resolver el problema rápidamente o perder horas de diagnóstico.

En este capítulo, aprenderás a diagnosticar, monitorear y gestionar conexiones de red de manera profesional, desde operaciones básicas hasta escenarios de seguridad avanzados.

## Conceptos Clave

### 🌐 **Conexión de Red**
Un enlace establecido entre dos dispositivos para intercambiar datos a través de una red.

### 📡 **Puerto**
Punto de entrada/salida virtual en un dispositivo de red para diferentes servicios.

### 🔗 **Protocolo**
Conjunto de reglas que definen cómo se comunican los dispositivos en una red.

### 🛡️ **Firewall**
Sistema de seguridad que controla el tráfico de red entrante y saliente.

## Comandos Principales

### `NETSTAT`
Comando para mostrar estadísticas de red y conexiones activas.

**Sintaxis básica:**
```batch
netstat [opciones]
```

**Opciones principales:**
- `-a` - Mostrar todas las conexiones
- `-n` - Mostrar direcciones numéricas
- `-o` - Mostrar PID de procesos
- `-p` - Mostrar conexiones por protocolo
- `-s` - Mostrar estadísticas por protocolo

### `NETSTAT -AN`
Comando para mostrar todas las conexiones activas con información detallada.

**Sintaxis:**
```batch
netstat -an
```

### `NETSTAT -ANO`
Comando para mostrar conexiones con PID de procesos asociados.

**Sintaxis:**
```batch
netstat -ano
```

### `FINDSTR`
Comando para filtrar resultados de netstat por criterios específicos.

**Sintaxis:**
```batch
netstat -ano | findstr "ESTABLISHED"
```

## Ejemplos Prácticos

### 1. **Ver Todas las Conexiones Activas**
**Propósito:** Mostrar todas las conexiones de red activas en el sistema.

```batch
netstat -an
```

**Casos de uso reales:**
- Auditoría de conexiones de red
- Identificación de servicios activos
- Diagnóstico de problemas de conectividad

### 2. **Ver Conexiones con Procesos**
**Propósito:** Mostrar conexiones junto con los procesos que las utilizan.

```batch
netstat -ano
```

**Casos de uso reales:**
- Identificación de aplicaciones que usan la red
- Diagnóstico de procesos maliciosos
- Gestión de recursos de red

### 3. **Filtrar Conexiones Establecidas**
**Propósito:** Ver solo las conexiones que están activamente transmitiendo datos.

```batch
netstat -ano | findstr "ESTABLISHED"
```

**Casos de uso reales:**
- Monitoreo de tráfico activo
- Identificación de conexiones sospechosas
- Análisis de uso de ancho de banda

### 4. **Buscar Conexiones por Puerto**
**Propósito:** Encontrar conexiones que usan un puerto específico.

```batch
netstat -ano | findstr ":80"
```

**Casos de uso reales:**
- Verificar si un servicio web está activo
- Diagnóstico de problemas de puertos
- Auditoría de servicios específicos

### 5. **Buscar Conexiones por IP**
**Propósito:** Encontrar conexiones hacia o desde una dirección IP específica.

```batch
netstat -ano | findstr "192.168.1.100"
```

**Casos de uso reales:**
- Seguimiento de conexiones a servidores específicos
- Identificación de conexiones maliciosas
- Auditoría de tráfico de red

### 6. **Ver Estadísticas de Protocolos**
**Propósito:** Mostrar estadísticas detalladas de uso de protocolos de red.

```batch
netstat -s
```

**Casos de uso reales:**
- Análisis de rendimiento de red
- Diagnóstico de problemas de protocolo
- Optimización de configuración de red

### 7. **Ver Conexiones por Protocolo**
**Propósito:** Mostrar conexiones filtradas por protocolo específico.

```batch
netstat -an | findstr "TCP"
```

**Casos de uso reales:**
- Análisis de tráfico TCP
- Diagnóstico de problemas de conectividad
- Auditoría de servicios TCP

### 8. **Identificar Procesos por PID**
**Propósito:** Encontrar qué proceso está usando una conexión específica.

```batch
netstat -ano | findstr "1234"
tasklist | findstr "1234"
```

**Casos de uso reales:**
- Identificación de aplicaciones que usan la red
- Diagnóstico de procesos maliciosos
- Gestión de recursos de red

### 9. **Ver Conexiones de Escucha**
**Propósito:** Mostrar puertos que están escuchando conexiones entrantes.

```batch
netstat -an | findstr "LISTENING"
```

**Casos de uso reales:**
- Verificación de servicios activos
- Auditoría de puertos abiertos
- Configuración de firewall

### 10. **Monitoreo Continuo de Conexiones**
**Propósito:** Monitorear conexiones de red en tiempo real.

```batch
netstat -ano 5
```

**Casos de uso reales:**
- Monitoreo de tráfico en tiempo real
- Detección de conexiones sospechosas
- Análisis de patrones de uso de red

## Scripts Avanzados

### Script para Gestión Avanzada de Conexiones

```batch
@echo off
:: Gestor avanzado de conexiones de red
title 🌐 Gestor de Conexiones de Red
color 0A

:menu
cls
echo ========================================
echo    🌐 GESTOR AVANZADO DE CONEXIONES
echo ========================================
echo.
echo 1. 👁️ Ver conexiones
echo 2. 🔍 Buscar conexiones
echo 3. 📊 Análisis de red
echo 4. 🛡️ Seguridad de red
echo 5. 📈 Monitoreo en tiempo real
echo 6. 📋 Reporte de red
echo 7. 🚪 Salir
echo.
set /p opcion="Selecciona una opción: "

if "%opcion%"=="1" goto ver_conexiones
if "%opcion%"=="2" goto buscar_conexiones
if "%opcion%"=="3" goto analisis_red
if "%opcion%"=="4" goto seguridad_red
if "%opcion%"=="5" goto monitoreo_tiempo_real
if "%opcion%"=="6" goto reporte_red
if "%opcion%"=="7" goto salir
goto menu

:ver_conexiones
cls
echo ========================================
echo         👁️ VER CONEXIONES
echo ========================================
echo.
echo 1. Todas las conexiones
echo 2. Conexiones establecidas
echo 3. Puertos de escucha
echo 4. Con procesos
echo.
set /p tipo="Selecciona tipo de vista: "

if "%tipo%"=="1" (
    echo 🔍 Mostrando todas las conexiones...
    netstat -an
) else if "%tipo%"=="2" (
    echo 🔍 Mostrando conexiones establecidas...
    netstat -ano | findstr "ESTABLISHED"
) else if "%tipo%"=="3" (
    echo 🔍 Mostrando puertos de escucha...
    netstat -an | findstr "LISTENING"
) else if "%tipo%"=="4" (
    echo 🔍 Mostrando conexiones con procesos...
    netstat -ano
)
pause
goto menu

:buscar_conexiones
cls
echo ========================================
echo         🔍 BUSCAR CONEXIONES
echo ========================================
echo.
echo 1. Por puerto
echo 2. Por IP
echo 3. Por proceso
echo 4. Por protocolo
echo.
set /p metodo="Método de búsqueda: "

if "%metodo%"=="1" (
    set /p puerto="Puerto a buscar: "
    echo 🔍 Buscando conexiones en puerto %puerto%...
    netstat -ano | findstr ":%puerto%"
) else if "%metodo%"=="2" (
    set /p ip="IP a buscar: "
    echo 🔍 Buscando conexiones con IP %ip%...
    netstat -ano | findstr "%ip%"
) else if "%metodo%"=="3" (
    set /p proceso="Nombre del proceso: "
    echo 🔍 Buscando conexiones del proceso %proceso%...
    for /f "tokens=5" %%i in ('netstat -ano ^| findstr "ESTABLISHED"') do (
        tasklist | findstr "%%i" | findstr /i "%proceso%"
    )
) else if "%metodo%"=="4" (
    set /p protocolo="Protocolo (TCP/UDP): "
    echo 🔍 Buscando conexiones %protocolo%...
    netstat -an | findstr /i "%protocolo%"
)
pause
goto menu

:analisis_red
cls
echo ========================================
echo         📊 ANÁLISIS DE RED
echo ========================================
echo.
echo 🔍 Analizando red...
echo.
echo === ESTADÍSTICAS DE PROTOCOLOS ===
netstat -s
echo.
echo === CONEXIONES MÁS ACTIVAS ===
netstat -ano | findstr "ESTABLISHED" | find /c "ESTABLISHED"
echo.
echo === PUERTOS MÁS USADOS ===
netstat -an | findstr "LISTENING" | find /c "LISTENING"
pause
goto menu

:seguridad_red
cls
echo ========================================
echo         🛡️ SEGURIDAD DE RED
echo ========================================
echo.
echo 🔍 Analizando seguridad de red...
echo.
echo === CONEXIONES SOSPECHOSAS ===
echo Buscando conexiones a puertos no estándar...
netstat -ano | findstr "ESTABLISHED" | findstr /r ":[0-9][0-9][0-9][0-9][0-9]"
echo.
echo === CONEXIONES A IPs EXTERNAS ===
echo Buscando conexiones a rangos externos...
netstat -ano | findstr "ESTABLISHED" | findstr /r "[0-9][0-9][0-9]\.[0-9][0-9][0-9]\.[0-9][0-9][0-9]\.[0-9][0-9][0-9]"
echo.
echo === PUERTOS ABIERTOS ===
echo Puertos de escucha activos:
netstat -an | findstr "LISTENING"
pause
goto menu

:monitoreo_tiempo_real
cls
echo ========================================
echo         📈 MONITOREO EN TIEMPO REAL
echo ========================================
echo.
echo 🔄 Monitoreando conexiones (Ctrl+C para salir)...
echo.
:loop_monitoreo
cls
echo ========================================
echo         📈 MONITOREO EN TIEMPO REAL
echo ========================================
echo Fecha: %date% %time%
echo.
echo === CONEXIONES ACTIVAS ===
netstat -ano | findstr "ESTABLISHED" | find /c "ESTABLISHED"
echo.
echo === ÚLTIMAS CONEXIONES ===
netstat -ano | findstr "ESTABLISHED" | findstr /v "127.0.0.1" | head -10
timeout /t 5 /nobreak >nul
goto loop_monitoreo

:reporte_red
cls
echo ========================================
echo         📋 REPORTE DE RED
echo ========================================
echo.
echo 🔄 Generando reporte de red...
echo === REPORTE DE RED === > reporte_red.txt
echo Fecha: %date% %time% >> reporte_red.txt
echo. >> reporte_red.txt
echo === CONEXIONES ACTIVAS === >> reporte_red.txt
netstat -ano >> reporte_red.txt
echo. >> reporte_red.txt
echo === ESTADÍSTICAS === >> reporte_red.txt
netstat -s >> reporte_red.txt
echo. >> reporte_red.txt
echo === PUERTOS DE ESCUCHA === >> reporte_red.txt
netstat -an | findstr "LISTENING" >> reporte_red.txt
echo ✅ Reporte generado en reporte_red.txt
pause
goto menu

:salir
exit
```

### Script para Detección de Conexiones Sospechosas

```batch
@echo off
:: Detección de conexiones sospechosas
title 🛡️ Detección de Conexiones Sospechosas
color 0C

echo ========================================
echo    🛡️ DETECCIÓN DE CONEXIONES SOSPECHOSAS
echo ========================================
echo.

:menu
echo 1. 🔍 Escaneo básico
echo 2. 🔍 Escaneo avanzado
echo 3. 🚨 Alertas en tiempo real
echo 4. 📊 Análisis de patrones
echo 5. 🚪 Salir
echo.
set /p opcion="Selecciona opción: "

if "%opcion%"=="1" goto escaneo_basico
if "%opcion%"=="2" goto escaneo_avanzado
if "%opcion%"=="3" goto alertas_tiempo_real
if "%opcion%"=="4" goto analisis_patrones
if "%opcion%"=="5" goto salir
goto menu

:escaneo_basico
cls
echo ========================================
echo         🔍 ESCANEO BÁSICO
echo ========================================
echo.
echo 🔍 Escaneando conexiones sospechosas...
echo.
echo === CONEXIONES A PUERTOS NO ESTÁNDAR ===
netstat -ano | findstr "ESTABLISHED" | findstr /r ":[0-9][0-9][0-9][0-9][0-9]"
echo.
echo === CONEXIONES A IPs EXTERNAS ===
netstat -ano | findstr "ESTABLISHED" | findstr /v "127.0.0.1\|192.168\|10\."
echo.
echo === PROCESOS CON MÚLTIPLES CONEXIONES ===
for /f "tokens=5" %%i in ('netstat -ano ^| findstr "ESTABLISHED"') do (
    echo Proceso PID %%i tiene múltiples conexiones
)
pause
goto menu

:escaneo_avanzado
cls
echo ========================================
echo         🔍 ESCANEO AVANZADO
echo ========================================
echo.
echo 🔍 Escaneo avanzado de seguridad...
echo.
echo === CONEXIONES CRÍPTICAS ===
netstat -ano | findstr "ESTABLISHED" | findstr /i "crypto\|miner\|torrent"
echo.
echo === CONEXIONES A SERVIDORES SOSPECHOSOS ===
netstat -ano | findstr "ESTABLISHED" | findstr /i "\.ru\|\.cn\|\.kr"
echo.
echo === PUERTOS DE COMANDO Y CONTROL ===
netstat -ano | findstr "ESTABLISHED" | findstr ":4444\|:8080\|:31337"
pause
goto menu

:alertas_tiempo_real
cls
echo ========================================
echo         🚨 ALERTAS EN TIEMPO REAL
echo ========================================
echo.
echo 🔄 Monitoreando alertas (Ctrl+C para salir)...
echo.
:loop_alertas
cls
echo ========================================
echo         🚨 ALERTAS EN TIEMPO REAL
echo ========================================
echo Fecha: %date% %time%
echo.
echo === NUEVAS CONEXIONES ===
netstat -ano | findstr "ESTABLISHED" | findstr /v "127.0.0.1"
echo.
echo === ALERTAS ===
for /f "tokens=2" %%i in ('netstat -ano ^| findstr "ESTABLISHED"') do (
    echo ⚠️ Nueva conexión detectada: %%i
)
timeout /t 10 /nobreak >nul
goto loop_alertas

:analisis_patrones
cls
echo ========================================
echo         📊 ANÁLISIS DE PATRONES
echo ========================================
echo.
echo 🔍 Analizando patrones de conexión...
echo.
echo === CONEXIONES POR HORA ===
echo Patrón de conexiones en las últimas horas:
echo.
echo === CONEXIONES MÁS FRECUENTES ===
netstat -ano | findstr "ESTABLISHED" | find /c "ESTABLISHED"
echo.
echo === PUERTOS MÁS USADOS ===
netstat -an | findstr "LISTENING" | find /c "LISTENING"
pause
goto menu

:salir
exit
```

## Consejos Importantes

### ⚡ **Optimización**
- Usa filtros específicos para encontrar conexiones relevantes
- Monitorea regularmente las conexiones de red
- Identifica patrones de uso anómalos

### 🛡️ **Seguridad**
- Verifica conexiones sospechosas antes de bloquearlas
- Documenta cambios en configuración de red
- Mantén logs de conexiones críticas

### 🔧 **Mejores Prácticas**
- Usa netstat con opciones específicas para cada tarea
- Verifica procesos asociados a conexiones sospechosas
- Implementa monitoreo automático de conexiones críticas

## Casos de Uso Reales

### 🏢 **Administración de Sistemas**
- Diagnóstico de problemas de conectividad
- Monitoreo de servicios de red
- Auditoría de seguridad de red

### 🏫 **Entornos Educativos**
- Control de acceso a internet en laboratorios
- Monitoreo de uso de red de estudiantes
- Gestión de ancho de banda

### 🏭 **Entornos Empresariales**
- Seguridad de red corporativa
- Optimización de ancho de banda
- Cumplimiento de políticas de red

## Conclusión y Siguiente Paso

Has dominado la gestión de conexiones de red desde la línea de comandos. Ahora puedes diagnosticar, monitorear y gestionar la conectividad de red de manera profesional, desde operaciones básicas hasta escenarios de seguridad avanzados.

En el siguiente capítulo, exploraremos cómo **Obtener contraseñas guardadas**, donde aprenderás técnicas para recuperar y gestionar credenciales almacenadas en el sistema. ¿Te imaginas recuperando contraseñas perdidas de aplicaciones críticas o auditando credenciales de seguridad? ¡Esa será tu próxima habilidad!

---

## Enlaces Relacionados

- [Capítulo 34: Gestión de Procesos](34.%20Gestión%20de%20Procesos.md)
- [Capítulo 36: Obtener contraseñas guardadas](36.%20Obtener%20contraseñas%20guardadas.md)
- [Capítulo 40: Ejecutar como Administrador - RUNAS](40.%20Ejecutar%20como%20Administrador%20-%20RUNAS.md)

## Fuentes y Referencias

- **Documentación oficial de Microsoft:** [Netstat Command](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/netstat)
- **Windows Command Line Reference:** [Network Commands](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/windows-commands)
- **Administración de Windows Server:** [Network Management](https://docs.microsoft.com/en-us/windows-server/administration/)

---

**Autor:** Jerson Martínez  
**Sitio web:** [jersonmartinez.com](https://jersonmartinez.com)  
**Blog DevOps:** [crashell.com](https://crashell.com) 