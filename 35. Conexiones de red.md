# 35. Conexiones de red

> *"La red es el sistema circulatorio de la inform√°tica moderna. ¬øSab√≠as que puedes diagnosticar, monitorear y gestionar todas las conexiones de red desde la l√≠nea de comandos sin necesidad de herramientas gr√°ficas?"* üåê

## Introducci√≥n

En el mundo interconectado de hoy, la capacidad de diagnosticar y gestionar conexiones de red es fundamental para cualquier administrador de sistemas. Desde identificar conexiones sospechosas hasta optimizar el rendimiento de la red, cada acci√≥n que realizas puede tener un impacto directo en la conectividad y seguridad del sistema.

¬øTe imaginas un servidor web que no responde y necesitas identificar si es un problema de red o de aplicaci√≥n? ¬øO detectar una conexi√≥n maliciosa que est√° enviando datos a un servidor desconocido? Estas son situaciones reales donde el dominio de los comandos de red puede ser la diferencia entre resolver el problema r√°pidamente o perder horas de diagn√≥stico.

En este cap√≠tulo, aprender√°s a diagnosticar, monitorear y gestionar conexiones de red de manera profesional, desde operaciones b√°sicas hasta escenarios de seguridad avanzados.

## Conceptos Clave

### üåê **Conexi√≥n de Red**
Un enlace establecido entre dos dispositivos para intercambiar datos a trav√©s de una red.

### üì° **Puerto**
Punto de entrada/salida virtual en un dispositivo de red para diferentes servicios.

### üîó **Protocolo**
Conjunto de reglas que definen c√≥mo se comunican los dispositivos en una red.

### üõ°Ô∏è **Firewall**
Sistema de seguridad que controla el tr√°fico de red entrante y saliente.

## Comandos Principales

### `NETSTAT`
Comando para mostrar estad√≠sticas de red y conexiones activas.

**Sintaxis b√°sica:**
```batch
netstat [opciones]
```

**Opciones principales:**
- `-a` - Mostrar todas las conexiones
- `-n` - Mostrar direcciones num√©ricas
- `-o` - Mostrar PID de procesos
- `-p` - Mostrar conexiones por protocolo
- `-s` - Mostrar estad√≠sticas por protocolo

### `NETSTAT -AN`
Comando para mostrar todas las conexiones activas con informaci√≥n detallada.

**Sintaxis:**
```batch
netstat -an
```

### `NETSTAT -ANO`
Comando para mostrar conexiones con PID de procesos asociados.

**Sintaxis:**
```batch
netstat -ano
```

### `FINDSTR`
Comando para filtrar resultados de netstat por criterios espec√≠ficos.

**Sintaxis:**
```batch
netstat -ano | findstr "ESTABLISHED"
```

## Ejemplos Pr√°cticos

### 1. **Ver Todas las Conexiones Activas**
**Prop√≥sito:** Mostrar todas las conexiones de red activas en el sistema.

```batch
netstat -an
```

**Casos de uso reales:**
- Auditor√≠a de conexiones de red
- Identificaci√≥n de servicios activos
- Diagn√≥stico de problemas de conectividad

### 2. **Ver Conexiones con Procesos**
**Prop√≥sito:** Mostrar conexiones junto con los procesos que las utilizan.

```batch
netstat -ano
```

**Casos de uso reales:**
- Identificaci√≥n de aplicaciones que usan la red
- Diagn√≥stico de procesos maliciosos
- Gesti√≥n de recursos de red

### 3. **Filtrar Conexiones Establecidas**
**Prop√≥sito:** Ver solo las conexiones que est√°n activamente transmitiendo datos.

```batch
netstat -ano | findstr "ESTABLISHED"
```

**Casos de uso reales:**
- Monitoreo de tr√°fico activo
- Identificaci√≥n de conexiones sospechosas
- An√°lisis de uso de ancho de banda

### 4. **Buscar Conexiones por Puerto**
**Prop√≥sito:** Encontrar conexiones que usan un puerto espec√≠fico.

```batch
netstat -ano | findstr ":80"
```

**Casos de uso reales:**
- Verificar si un servicio web est√° activo
- Diagn√≥stico de problemas de puertos
- Auditor√≠a de servicios espec√≠ficos

### 5. **Buscar Conexiones por IP**
**Prop√≥sito:** Encontrar conexiones hacia o desde una direcci√≥n IP espec√≠fica.

```batch
netstat -ano | findstr "192.168.1.100"
```

**Casos de uso reales:**
- Seguimiento de conexiones a servidores espec√≠ficos
- Identificaci√≥n de conexiones maliciosas
- Auditor√≠a de tr√°fico de red

### 6. **Ver Estad√≠sticas de Protocolos**
**Prop√≥sito:** Mostrar estad√≠sticas detalladas de uso de protocolos de red.

```batch
netstat -s
```

**Casos de uso reales:**
- An√°lisis de rendimiento de red
- Diagn√≥stico de problemas de protocolo
- Optimizaci√≥n de configuraci√≥n de red

### 7. **Ver Conexiones por Protocolo**
**Prop√≥sito:** Mostrar conexiones filtradas por protocolo espec√≠fico.

```batch
netstat -an | findstr "TCP"
```

**Casos de uso reales:**
- An√°lisis de tr√°fico TCP
- Diagn√≥stico de problemas de conectividad
- Auditor√≠a de servicios TCP

### 8. **Identificar Procesos por PID**
**Prop√≥sito:** Encontrar qu√© proceso est√° usando una conexi√≥n espec√≠fica.

```batch
netstat -ano | findstr "1234"
tasklist | findstr "1234"
```

**Casos de uso reales:**
- Identificaci√≥n de aplicaciones que usan la red
- Diagn√≥stico de procesos maliciosos
- Gesti√≥n de recursos de red

### 9. **Ver Conexiones de Escucha**
**Prop√≥sito:** Mostrar puertos que est√°n escuchando conexiones entrantes.

```batch
netstat -an | findstr "LISTENING"
```

**Casos de uso reales:**
- Verificaci√≥n de servicios activos
- Auditor√≠a de puertos abiertos
- Configuraci√≥n de firewall

### 10. **Monitoreo Continuo de Conexiones**
**Prop√≥sito:** Monitorear conexiones de red en tiempo real.

```batch
netstat -ano 5
```

**Casos de uso reales:**
- Monitoreo de tr√°fico en tiempo real
- Detecci√≥n de conexiones sospechosas
- An√°lisis de patrones de uso de red

## Scripts Avanzados

### Script para Gesti√≥n Avanzada de Conexiones

```batch
@echo off
:: Gestor avanzado de conexiones de red
title üåê Gestor de Conexiones de Red
color 0A

:menu
cls
echo ========================================
echo    üåê GESTOR AVANZADO DE CONEXIONES
echo ========================================
echo.
echo 1. üëÅÔ∏è Ver conexiones
echo 2. üîç Buscar conexiones
echo 3. üìä An√°lisis de red
echo 4. üõ°Ô∏è Seguridad de red
echo 5. üìà Monitoreo en tiempo real
echo 6. üìã Reporte de red
echo 7. üö™ Salir
echo.
set /p opcion="Selecciona una opci√≥n: "

if "%opcion%"=="1" goto ver_conexiones
if "%opcion%"=="2" goto buscar_conexiones
if "%opcion%"=="3" goto analisis_red
if "%opcion%"=="4" goto seguridad_red
if "%opcion%"=="5" goto monitoreo_tiempo_real
if "%opcion%"=="6" goto reporte_red
if "%opcion%"=="7" goto salir
goto menu

:ver_conexiones
cls
echo ========================================
echo         üëÅÔ∏è VER CONEXIONES
echo ========================================
echo.
echo 1. Todas las conexiones
echo 2. Conexiones establecidas
echo 3. Puertos de escucha
echo 4. Con procesos
echo.
set /p tipo="Selecciona tipo de vista: "

if "%tipo%"=="1" (
    echo üîç Mostrando todas las conexiones...
    netstat -an
) else if "%tipo%"=="2" (
    echo üîç Mostrando conexiones establecidas...
    netstat -ano | findstr "ESTABLISHED"
) else if "%tipo%"=="3" (
    echo üîç Mostrando puertos de escucha...
    netstat -an | findstr "LISTENING"
) else if "%tipo%"=="4" (
    echo üîç Mostrando conexiones con procesos...
    netstat -ano
)
pause
goto menu

:buscar_conexiones
cls
echo ========================================
echo         üîç BUSCAR CONEXIONES
echo ========================================
echo.
echo 1. Por puerto
echo 2. Por IP
echo 3. Por proceso
echo 4. Por protocolo
echo.
set /p metodo="M√©todo de b√∫squeda: "

if "%metodo%"=="1" (
    set /p puerto="Puerto a buscar: "
    echo üîç Buscando conexiones en puerto %puerto%...
    netstat -ano | findstr ":%puerto%"
) else if "%metodo%"=="2" (
    set /p ip="IP a buscar: "
    echo üîç Buscando conexiones con IP %ip%...
    netstat -ano | findstr "%ip%"
) else if "%metodo%"=="3" (
    set /p proceso="Nombre del proceso: "
    echo üîç Buscando conexiones del proceso %proceso%...
    for /f "tokens=5" %%i in ('netstat -ano ^| findstr "ESTABLISHED"') do (
        tasklist | findstr "%%i" | findstr /i "%proceso%"
    )
) else if "%metodo%"=="4" (
    set /p protocolo="Protocolo (TCP/UDP): "
    echo üîç Buscando conexiones %protocolo%...
    netstat -an | findstr /i "%protocolo%"
)
pause
goto menu

:analisis_red
cls
echo ========================================
echo         üìä AN√ÅLISIS DE RED
echo ========================================
echo.
echo üîç Analizando red...
echo.
echo === ESTAD√çSTICAS DE PROTOCOLOS ===
netstat -s
echo.
echo === CONEXIONES M√ÅS ACTIVAS ===
netstat -ano | findstr "ESTABLISHED" | find /c "ESTABLISHED"
echo.
echo === PUERTOS M√ÅS USADOS ===
netstat -an | findstr "LISTENING" | find /c "LISTENING"
pause
goto menu

:seguridad_red
cls
echo ========================================
echo         üõ°Ô∏è SEGURIDAD DE RED
echo ========================================
echo.
echo üîç Analizando seguridad de red...
echo.
echo === CONEXIONES SOSPECHOSAS ===
echo Buscando conexiones a puertos no est√°ndar...
netstat -ano | findstr "ESTABLISHED" | findstr /r ":[0-9][0-9][0-9][0-9][0-9]"
echo.
echo === CONEXIONES A IPs EXTERNAS ===
echo Buscando conexiones a rangos externos...
netstat -ano | findstr "ESTABLISHED" | findstr /r "[0-9][0-9][0-9]\.[0-9][0-9][0-9]\.[0-9][0-9][0-9]\.[0-9][0-9][0-9]"
echo.
echo === PUERTOS ABIERTOS ===
echo Puertos de escucha activos:
netstat -an | findstr "LISTENING"
pause
goto menu

:monitoreo_tiempo_real
cls
echo ========================================
echo         üìà MONITOREO EN TIEMPO REAL
echo ========================================
echo.
echo üîÑ Monitoreando conexiones (Ctrl+C para salir)...
echo.
:loop_monitoreo
cls
echo ========================================
echo         üìà MONITOREO EN TIEMPO REAL
echo ========================================
echo Fecha: %date% %time%
echo.
echo === CONEXIONES ACTIVAS ===
netstat -ano | findstr "ESTABLISHED" | find /c "ESTABLISHED"
echo.
echo === √öLTIMAS CONEXIONES ===
netstat -ano | findstr "ESTABLISHED" | findstr /v "127.0.0.1" | head -10
timeout /t 5 /nobreak >nul
goto loop_monitoreo

:reporte_red
cls
echo ========================================
echo         üìã REPORTE DE RED
echo ========================================
echo.
echo üîÑ Generando reporte de red...
echo === REPORTE DE RED === > reporte_red.txt
echo Fecha: %date% %time% >> reporte_red.txt
echo. >> reporte_red.txt
echo === CONEXIONES ACTIVAS === >> reporte_red.txt
netstat -ano >> reporte_red.txt
echo. >> reporte_red.txt
echo === ESTAD√çSTICAS === >> reporte_red.txt
netstat -s >> reporte_red.txt
echo. >> reporte_red.txt
echo === PUERTOS DE ESCUCHA === >> reporte_red.txt
netstat -an | findstr "LISTENING" >> reporte_red.txt
echo ‚úÖ Reporte generado en reporte_red.txt
pause
goto menu

:salir
exit
```

### Script para Detecci√≥n de Conexiones Sospechosas

```batch
@echo off
:: Detecci√≥n de conexiones sospechosas
title üõ°Ô∏è Detecci√≥n de Conexiones Sospechosas
color 0C

echo ========================================
echo    üõ°Ô∏è DETECCI√ìN DE CONEXIONES SOSPECHOSAS
echo ========================================
echo.

:menu
echo 1. üîç Escaneo b√°sico
echo 2. üîç Escaneo avanzado
echo 3. üö® Alertas en tiempo real
echo 4. üìä An√°lisis de patrones
echo 5. üö™ Salir
echo.
set /p opcion="Selecciona opci√≥n: "

if "%opcion%"=="1" goto escaneo_basico
if "%opcion%"=="2" goto escaneo_avanzado
if "%opcion%"=="3" goto alertas_tiempo_real
if "%opcion%"=="4" goto analisis_patrones
if "%opcion%"=="5" goto salir
goto menu

:escaneo_basico
cls
echo ========================================
echo         üîç ESCANEO B√ÅSICO
echo ========================================
echo.
echo üîç Escaneando conexiones sospechosas...
echo.
echo === CONEXIONES A PUERTOS NO EST√ÅNDAR ===
netstat -ano | findstr "ESTABLISHED" | findstr /r ":[0-9][0-9][0-9][0-9][0-9]"
echo.
echo === CONEXIONES A IPs EXTERNAS ===
netstat -ano | findstr "ESTABLISHED" | findstr /v "127.0.0.1\|192.168\|10\."
echo.
echo === PROCESOS CON M√öLTIPLES CONEXIONES ===
for /f "tokens=5" %%i in ('netstat -ano ^| findstr "ESTABLISHED"') do (
    echo Proceso PID %%i tiene m√∫ltiples conexiones
)
pause
goto menu

:escaneo_avanzado
cls
echo ========================================
echo         üîç ESCANEO AVANZADO
echo ========================================
echo.
echo üîç Escaneo avanzado de seguridad...
echo.
echo === CONEXIONES CR√çPTICAS ===
netstat -ano | findstr "ESTABLISHED" | findstr /i "crypto\|miner\|torrent"
echo.
echo === CONEXIONES A SERVIDORES SOSPECHOSOS ===
netstat -ano | findstr "ESTABLISHED" | findstr /i "\.ru\|\.cn\|\.kr"
echo.
echo === PUERTOS DE COMANDO Y CONTROL ===
netstat -ano | findstr "ESTABLISHED" | findstr ":4444\|:8080\|:31337"
pause
goto menu

:alertas_tiempo_real
cls
echo ========================================
echo         üö® ALERTAS EN TIEMPO REAL
echo ========================================
echo.
echo üîÑ Monitoreando alertas (Ctrl+C para salir)...
echo.
:loop_alertas
cls
echo ========================================
echo         üö® ALERTAS EN TIEMPO REAL
echo ========================================
echo Fecha: %date% %time%
echo.
echo === NUEVAS CONEXIONES ===
netstat -ano | findstr "ESTABLISHED" | findstr /v "127.0.0.1"
echo.
echo === ALERTAS ===
for /f "tokens=2" %%i in ('netstat -ano ^| findstr "ESTABLISHED"') do (
    echo ‚ö†Ô∏è Nueva conexi√≥n detectada: %%i
)
timeout /t 10 /nobreak >nul
goto loop_alertas

:analisis_patrones
cls
echo ========================================
echo         üìä AN√ÅLISIS DE PATRONES
echo ========================================
echo.
echo üîç Analizando patrones de conexi√≥n...
echo.
echo === CONEXIONES POR HORA ===
echo Patr√≥n de conexiones en las √∫ltimas horas:
echo.
echo === CONEXIONES M√ÅS FRECUENTES ===
netstat -ano | findstr "ESTABLISHED" | find /c "ESTABLISHED"
echo.
echo === PUERTOS M√ÅS USADOS ===
netstat -an | findstr "LISTENING" | find /c "LISTENING"
pause
goto menu

:salir
exit
```

## Consejos Importantes

### ‚ö° **Optimizaci√≥n**
- Usa filtros espec√≠ficos para encontrar conexiones relevantes
- Monitorea regularmente las conexiones de red
- Identifica patrones de uso an√≥malos

### üõ°Ô∏è **Seguridad**
- Verifica conexiones sospechosas antes de bloquearlas
- Documenta cambios en configuraci√≥n de red
- Mant√©n logs de conexiones cr√≠ticas

### üîß **Mejores Pr√°cticas**
- Usa netstat con opciones espec√≠ficas para cada tarea
- Verifica procesos asociados a conexiones sospechosas
- Implementa monitoreo autom√°tico de conexiones cr√≠ticas

## Casos de Uso Reales

### üè¢ **Administraci√≥n de Sistemas**
- Diagn√≥stico de problemas de conectividad
- Monitoreo de servicios de red
- Auditor√≠a de seguridad de red

### üè´ **Entornos Educativos**
- Control de acceso a internet en laboratorios
- Monitoreo de uso de red de estudiantes
- Gesti√≥n de ancho de banda

### üè≠ **Entornos Empresariales**
- Seguridad de red corporativa
- Optimizaci√≥n de ancho de banda
- Cumplimiento de pol√≠ticas de red

## Conclusi√≥n y Siguiente Paso

Has dominado la gesti√≥n de conexiones de red desde la l√≠nea de comandos. Ahora puedes diagnosticar, monitorear y gestionar la conectividad de red de manera profesional, desde operaciones b√°sicas hasta escenarios de seguridad avanzados.

En el siguiente cap√≠tulo, exploraremos c√≥mo **Obtener contrase√±as guardadas**, donde aprender√°s t√©cnicas para recuperar y gestionar credenciales almacenadas en el sistema. ¬øTe imaginas recuperando contrase√±as perdidas de aplicaciones cr√≠ticas o auditando credenciales de seguridad? ¬°Esa ser√° tu pr√≥xima habilidad!

---

## Enlaces Relacionados

- [Cap√≠tulo 34: Gesti√≥n de Procesos](34.%20Gesti√≥n%20de%20Procesos.md)
- [Cap√≠tulo 36: Obtener contrase√±as guardadas](36.%20Obtener%20contrase√±as%20guardadas.md)
- [Cap√≠tulo 40: Ejecutar como Administrador - RUNAS](40.%20Ejecutar%20como%20Administrador%20-%20RUNAS.md)

## Fuentes y Referencias

- **Documentaci√≥n oficial de Microsoft:** [Netstat Command](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/netstat)
- **Windows Command Line Reference:** [Network Commands](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/windows-commands)
- **Administraci√≥n de Windows Server:** [Network Management](https://docs.microsoft.com/en-us/windows-server/administration/)

---

**Autor:** Jerson Mart√≠nez  
**Sitio web:** [jersonmartinez.com](https://jersonmartinez.com)  
**Blog DevOps:** [crashell.com](https://crashell.com) 