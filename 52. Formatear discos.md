# 52. Formatear discos

## 💾 ¿Alguna vez te has preguntado qué sucede realmente cuando formateas un disco?

> *"Formatear un disco es como construir una nueva casa: necesitas los cimientos correctos para que todo funcione perfectamente"* - Anónimo

En el mundo de la administración de sistemas, el formateo de discos es una tarea fundamental que puede determinar el rendimiento, la seguridad y la compatibilidad de todo el sistema. ¿Sabías que el tipo de formateo que elijas puede afectar el rendimiento de tu disco hasta en un 30%?

En este capítulo, aprenderás técnicas avanzadas de formateo que te convertirán en un experto en la preparación y optimización de unidades de almacenamiento, desde discos de sistema hasta unidades de respaldo.

---

## 📚 Conceptos Fundamentales

### **Formateo de Disco**
Proceso de preparación de una unidad de almacenamiento para su uso, creando un sistema de archivos y estructura de directorios.

### **Sistema de Archivos**
Estructura lógica que organiza y gestiona los datos en el disco (NTFS, FAT32, exFAT, ReFS).

### **Formateo Rápido vs Completo**
Diferencia entre formateo que solo borra la tabla de archivos y formateo que verifica sectores defectuosos.

### **Tamaño de Clúster**
Unidad mínima de asignación de espacio en disco que afecta el rendimiento y la eficiencia.

---

## 🛠️ Comandos Principales

### **FORMAT**
Comando nativo de Windows para formatear unidades de almacenamiento con diferentes opciones.

### **DISKPART**
Herramienta avanzada para gestión completa de discos, particiones y formateo.

### **POWERSHELL**
Scripts avanzados para formateo automatizado y gestión de sistemas de archivos.

### **FSUTIL**
Herramienta para configuración avanzada del sistema de archivos.

---

## 💡 Ejemplos Prácticos

### Ejemplos directos de comandos

A continuación se muestran ejemplos sencillos y descriptivos para demostrar el uso de los comandos principales en la consola. Estos pueden ejecutarse directamente para mostrar el funcionamiento básico antes de utilizar los scripts completos:

#### Formateo rápido de una unidad NTFS
```cmd
format D: /FS:NTFS /Q /V:DATOS /Y
```
*Formatea la unidad D: con sistema de archivos NTFS, de forma rápida y asignando la etiqueta "DATOS".*

#### Formateo completo con verificación de sectores
```cmd
format E: /FS:NTFS /V:RESPALDO /Y
```
*Formatea la unidad E: con NTFS y verifica sectores defectuosos, asignando la etiqueta "RESPALDO".*

#### Formateo de USB con FAT32
```cmd
format F: /FS:FAT32 /Q /V:USB_DATOS /Y
```
*Formatea la unidad F: (USB) con FAT32 para máxima compatibilidad.*

#### Formateo con tamaño de clúster personalizado
```cmd
format G: /FS:NTFS /A:65536 /Q /V:ARCHIVOS_GRANDES /Y
```
*Formatea la unidad G: con NTFS y clúster de 64KB, optimizado para archivos grandes.*

#### Formateo avanzado con DISKPART
```cmd
diskpart /s script.txt
```
*Ejecuta un script de DISKPART para formateo avanzado y particionado.*

#### Habilitar compresión en una unidad
```cmd
compact /c /s H:\ /i /q
```
*Activa la compresión en todos los archivos de la unidad H:.*

#### Verificación de integridad después del formateo
```cmd
chkdsk J: /F /R
```
*Verifica y repara errores en la unidad J: tras el formateo.*

---

### Tabla de referencia de scripts prácticos

Los siguientes ejemplos prácticos han sido extraídos y organizados como scripts independientes en el directorio [`scripts/52-formatear-discos`](scripts/52-formatear-discos). Puedes ejecutarlos directamente en tu entorno Windows o en la máquina virtual Vagrant.

| Ejemplo | Script | Descripción | Propósito | Emoji |
|---------|--------|-------------|-----------|-------|
| Formateo básico de unidad | `formateo-basico-unidad.bat` | Formatea una unidad con NTFS de forma rápida | Formateo rápido NTFS | 💾 |
| Formateo completo con verificación | `formateo-completo-verificacion.bat` | Formatea y verifica sectores defectuosos | Verificación de sectores | 🔍 |
| Formateo USB con FAT32 | `formateo-usb-fat32.bat` | Formatea USB con FAT32 para compatibilidad | Compatibilidad máxima | 📱 |
| Formateo con clúster personalizado | `formateo-cluster-personalizado.bat` | Formatea con tamaño de clúster específico | Optimización de rendimiento | ⚙️ |
| Formateo de múltiples unidades | `formateo-mult-unidades.bat` | Formatea varias unidades de forma secuencial | Formateo sistemático | 🔄 |
| Formateo de múltiples unidades (FOR) | `formateo-mult-unidades-for.bat` | Formatea varias unidades usando bucle FOR | Formateo en bucle | 🔄 |
| Formateo avanzado con DISKPART | `formateo-avanzado-diskpart.bat` | Usa DISKPART para formateo y particionado | Control total | 🔧 |
| Formateo DISKPART interactivo | `formateo-diskpart-interactivo.bat` | Formateo avanzado con interacción | Interactivo | 🔧 |
| Formateo con clúster interactivo | `formateo-cluster-interactivo.bat` | Permite elegir tamaño de clúster | Selección de clúster | ⚙️ |
| Formateo USB interactivo | `formateo-usb-interactivo.bat` | Permite elegir tipo de formateo USB | Selección de tipo | 📱 |
| Formateo para sistema operativo | `formateo-sistema-operativo.bat` | Prepara disco para instalar SO | Preparación SO | 🖥️ |
| Formateo SO interactivo | `formateo-sistema-operativo-interactivo.bat` | Formateo y optimización interactiva para SO | Interactivo | 🖥️ |
| Formateo con compresión | `formateo-compresion.bat` | Formatea y habilita compresión | Ahorrar espacio | 📦 |
| Formateo compresión interactivo | `formateo-compresion-interactivo.bat` | Permite activar compresión de forma interactiva | Interactivo | 📦 |
| Formateo para red | `formateo-red.bat` | Prepara disco para almacenamiento en red | Optimización red | 🌐 |
| Formateo red interactivo | `formateo-red-interactivo.bat` | Formateo y optimización interactiva para red | Interactivo | 🌐 |
| Formateo con verificación de integridad | `formateo-verificacion-integridad.bat` | Formatea y verifica integridad post-formateo | Verificación post-formateo | 🔍 |
| Formateo verificación interactivo | `formateo-verificacion-integridad-interactivo.bat` | Permite verificar integridad de forma interactiva | Interactivo | 🔍 |
| Formateo automático inteligente | `formateo-automatico-inteligente.bat` | Selecciona tipo de formateo adaptativo | Adaptativo | 🤖 |

#### Ejecución de scripts

1. Abre una terminal en Windows o en la VM Vagrant.
2. Navega al directorio `scripts/52-formatear-discos`.
3. Ejecuta el script deseado, por ejemplo:
   ```
   formateo-basico-unidad.bat
   ```
4. Sigue las instrucciones en pantalla.

> **Nota:** Algunos scripts requieren privilegios de administrador. Revisa el contenido antes de ejecutar y realiza pruebas en entornos controlados.

---

## 🚀 Scripts Avanzados

### **Script para Gestión Completa de Formateo de Discos**

```batch
@echo off
setlocal enabledelayedexpansion
title 💾 GESTOR COMPLETO DE FORMATEO DE DISCOS

:menu_principal
cls
echo.
echo ╔══════════════════════════════════════════════════════════════╗
echo ║            💾 GESTOR DE FORMATEO DE DISCOS 💾               ║
echo ║                    Sistema de Preparación Avanzada           ║
echo ╚══════════════════════════════════════════════════════════════╝
echo.
echo [1] 💾 Formateo básico de unidad
echo [2] 🔍 Formateo completo con verificación
echo [3] 📱 Formateo para dispositivos USB
echo [4] ⚙️ Formateo con clúster personalizado
echo [5] 🔄 Formateo de múltiples unidades
echo [6] 🔧 Formateo avanzado con DISKPART
echo [7] 🖥️ Formateo para sistema operativo
echo [8] 📦 Formateo con compresión
echo [9] 🌐 Formateo para almacenamiento de red
echo [0] ❌ Salir
echo.
set /p opcion="Selecciona una opción: "

if "%opcion%"=="1" goto formateo_basico
if "%opcion%"=="2" goto formateo_completo
if "%opcion%"=="3" goto formateo_usb
if "%opcion%"=="4" goto formateo_cluster
if "%opcion%"=="5" goto formateo_multiple
if "%opcion%"=="6" goto formateo_diskpart
if "%opcion%"=="7" goto formateo_sistema
if "%opcion%"=="8" goto formateo_compresion
if "%opcion%"=="9" goto formateo_red
if "%opcion%"=="0" goto salir
goto menu_principal

:formateo_basico
cls
echo.
echo 💾 FORMATEO BÁSICO DE UNIDAD
echo ════════════════════════════════════════════════════════════════
echo.
set /p unidad="Letra de unidad (ej: D): "
set /p etiqueta="Etiqueta del volumen (ej: DATOS): "

echo.
echo ⚠️  Formateando unidad %unidad%: con NTFS...
format %unidad%: /FS:NTFS /Q /V:%etiqueta% /Y

echo ✅ Formateo básico completado
pause
goto menu_principal

:formateo_completo
cls
echo.
echo 🔍 FORMATEO COMPLETO CON VERIFICACIÓN
echo ════════════════════════════════════════════════════════════════
echo.
echo ⚠️  Esta operación puede tomar varias horas
echo.
set /p confirmar="¿Continuar? (S/N): "
if /i not "%confirmar%"=="S" goto menu_principal

set /p unidad="Letra de unidad (ej: E): "
set /p etiqueta="Etiqueta del volumen (ej: DATOS_COMPLETOS): "

echo.
echo 🔍 Iniciando formateo completo...
format %unidad%: /FS:NTFS /V:%etiqueta% /Y

echo ✅ Formateo completo finalizado
pause
goto menu_principal

:formateo_usb
cls
echo.
echo 📱 FORMATEO PARA DISPOSITIVOS USB
echo ════════════════════════════════════════════════════════════════
echo.
echo [1] FAT32 (Máxima compatibilidad)
echo [2] exFAT (Archivos grandes)
echo [3] NTFS (Windows)
echo.
set /p tipo_usb="Selecciona tipo de formateo: "

set /p unidad="Letra de unidad USB (ej: F): "
set /p etiqueta="Etiqueta del volumen (ej: USB_DATOS): "

if "%tipo_usb%"=="1" (
    echo 📱 Formateando con FAT32...
    format %unidad%: /FS:FAT32 /Q /V:%etiqueta% /Y
) else if "%tipo_usb%"=="2" (
    echo 📱 Formateando con exFAT...
    format %unidad%: /FS:exFAT /Q /V:%etiqueta% /Y
) else if "%tipo_usb%"=="3" (
    echo 📱 Formateando con NTFS...
    format %unidad%: /FS:NTFS /Q /V:%etiqueta% /Y
)

echo ✅ Formateo USB completado
pause
goto menu_principal

:formateo_cluster
cls
echo.
echo ⚙️ FORMATEO CON CLÚSTER PERSONALIZADO
echo ════════════════════════════════════════════════════════════════
echo.
echo Tamaños de clúster disponibles:
echo [1] 512 bytes (Archivos pequeños)
echo [2] 4KB (Estándar)
echo [3] 16KB (Archivos medianos)
echo [4] 32KB (Archivos grandes)
echo [5] 64KB (Archivos muy grandes)
echo.
set /p tamano_cluster="Selecciona tamaño de clúster: "

set /p unidad="Letra de unidad (ej: G): "
set /p etiqueta="Etiqueta del volumen (ej: OPTIMIZADO): "

if "%tamano_cluster%"=="1" set "cluster=512"
if "%tamano_cluster%"=="2" set "cluster=4096"
if "%tamano_cluster%"=="3" set "cluster=16384"
if "%tamano_cluster%"=="4" set "cluster=32768"
if "%tamano_cluster%"=="5" set "cluster=65536"

echo.
echo ⚙️ Formateando con clúster de %cluster% bytes...
format %unidad%: /FS:NTFS /A:%cluster% /Q /V:%etiqueta% /Y

echo ✅ Formateo con clúster personalizado completado
pause
goto menu_principal

:formateo_multiple
cls
echo.
echo 🔄 FORMATEO DE MÚLTIPLES UNIDADES
echo ════════════════════════════════════════════════════════════════
echo.
echo ⚠️  Esta operación formateará múltiples unidades
echo.
set /p confirmar="¿Continuar? (S/N): "
if /i not "%confirmar%"=="S" goto menu_principal

echo.
echo 🔄 Formateando múltiples unidades...

for %%d in (D E F G H I J K L M N O P Q R S T U V W X Y Z) do (
    if exist %%d:\ (
        echo 📁 Formateando unidad %%d:...
        format %%d: /FS:NTFS /Q /V:UNIDAD_%%d /Y
        echo.
    )
)

echo ✅ Formateo de múltiples unidades completado
pause
goto menu_principal

:formateo_diskpart
cls
echo.
echo 🔧 FORMATEO AVANZADO CON DISKPART
echo ════════════════════════════════════════════════════════════════
echo.
echo ⚠️  Esta operación requiere conocimientos avanzados
echo.
set /p confirmar="¿Continuar? (S/N): "
if /i not "%confirmar%"=="S" goto menu_principal

set /p disco="Número de disco (ej: 1): "
set /p unidad="Letra de unidad (ej: D): "
set /p etiqueta="Etiqueta del volumen (ej: DISKPART): "

echo.
echo 🔧 Creando script de DISKPART...
echo select disk %disco% > "%TEMP%\diskpart_script.txt"
echo clean >> "%TEMP%\diskpart_script.txt"
echo create partition primary >> "%TEMP%\diskpart_script.txt"
echo format fs=ntfs quick label="%etiqueta%" >> "%TEMP%\diskpart_script.txt"
echo assign letter=%unidad% >> "%TEMP%\diskpart_script.txt"
echo exit >> "%TEMP%\diskpart_script.txt"

echo ⚠️  Ejecutando formateo con DISKPART...
diskpart /s "%TEMP%\diskpart_script.txt"

echo 🗑️ Limpiando archivo temporal...
del "%TEMP%\diskpart_script.txt"

echo ✅ Formateo con DISKPART completado
pause
goto menu_principal

:formateo_sistema
cls
echo.
echo 🖥️ FORMATEO PARA SISTEMA OPERATIVO
echo ════════════════════════════════════════════════════════════════
echo.
echo ⚠️  Esta operación preparará un disco para sistema operativo
echo.
set /p confirmar="¿Continuar? (S/N): "
if /i not "%confirmar%"=="S" goto menu_principal

set /p unidad="Letra de unidad del sistema (ej: C): "
set /p etiqueta="Etiqueta del sistema (ej: SISTEMA): "

echo.
echo 🖥️ Preparando disco para sistema operativo...
format %unidad%: /FS:NTFS /V:%etiqueta% /Y

echo.
echo 🔧 Configurando optimizaciones del sistema...
fsutil behavior set disablelastaccess 1
fsutil behavior set disable8dot3 1

echo ✅ Disco preparado para sistema operativo
pause
goto menu_principal

:formateo_compresion
cls
echo.
echo 📦 FORMATEO CON COMPRESIÓN
echo ════════════════════════════════════════════════════════════════
echo.
set /p unidad="Letra de unidad (ej: H): "
set /p etiqueta="Etiqueta del volumen (ej: COMPRIMIDO): "

echo.
echo 📦 Formateando con compresión...
format %unidad%: /FS:NTFS /Q /V:%etiqueta% /Y

echo.
echo 🔧 Habilitando compresión del sistema de archivos...
compact /c /s %unidad%:\ /i /q

echo ✅ Formateo con compresión completado
pause
goto menu_principal

:formateo_red
cls
echo.
echo 🌐 FORMATEO PARA ALMACENAMIENTO DE RED
echo ════════════════════════════════════════════════════════════════
echo.
set /p unidad="Letra de unidad (ej: I): "
set /p etiqueta="Etiqueta del volumen (ej: RED): "

echo.
echo 🌐 Preparando disco para almacenamiento de red...
format %unidad%: /FS:NTFS /A:32768 /Q /V:%etiqueta% /Y

echo.
echo 🔧 Configurando optimizaciones de red...
fsutil behavior set disablelastaccess 1
fsutil behavior set mftzone 2

echo ✅ Disco preparado para almacenamiento de red
pause
goto menu_principal

:salir
echo.
echo 👋 ¡Gracias por usar el Gestor de Formateo de Discos!
echo.
exit /b 0
```

### **Script para Sistema de Formateo Automático Inteligente**

```batch
@echo off
setlocal enabledelayedexpansion
title 🤖 SISTEMA DE FORMATEO AUTOMÁTICO INTELIGENTE

:configuracion_inicial
cls
echo.
echo ╔══════════════════════════════════════════════════════════════╗
echo ║        🤖 SISTEMA DE FORMATEO AUTOMÁTICO INTELIGENTE 🤖     ║
echo ║                    Formateo Adaptativo por Tipo de Uso       ║
echo ╚══════════════════════════════════════════════════════════════╝
echo.
echo Tipos de formateo disponibles:
echo [1] Sistema Operativo (Optimizado para Windows)
echo [2] Datos Generales (Uso diario)
echo [3] Almacenamiento de Red (Servidor de archivos)
echo [4] Respaldo (Archivos grandes)
echo [5] Multimedia (Videos, música, fotos)
echo [6] Desarrollo (Proyectos de programación)
echo.
set /p tipo_formateo="Selecciona tipo de formateo: "
set /p unidad="Letra de unidad: "
set /p etiqueta="Etiqueta del volumen: "

echo.
echo ⚙️ Configuración del formateo:
echo    Tipo: %tipo_formateo%
echo    Unidad: %unidad%:
echo    Etiqueta: %etiqueta%
echo.
pause

:formateo_adaptativo
cls
echo.
echo 🤖 FORMATEO ADAPTATIVO EN PROGRESO
echo ════════════════════════════════════════════════════════════════
echo.

if "%tipo_formateo%"=="1" goto formateo_sistema
if "%tipo_formateo%"=="2" goto formateo_datos
if "%tipo_formateo%"=="3" goto formateo_red
if "%tipo_formateo%"=="4" goto formateo_respaldo
if "%tipo_formateo%"=="5" goto formateo_multimedia
if "%tipo_formateo%"=="6" goto formateo_desarrollo

:formateo_sistema
echo 🖥️ Configurando para Sistema Operativo...
format %unidad%: /FS:NTFS /V:%etiqueta% /Y
echo 🔧 Aplicando optimizaciones de sistema...
fsutil behavior set disablelastaccess 1
fsutil behavior set disable8dot3 1
goto finalizar

:formateo_datos
echo 📁 Configurando para Datos Generales...
format %unidad%: /FS:NTFS /A:4096 /Q /V:%etiqueta% /Y
echo 🔧 Aplicando optimizaciones estándar...
goto finalizar

:formateo_red
echo 🌐 Configurando para Almacenamiento de Red...
format %unidad%: /FS:NTFS /A:32768 /Q /V:%etiqueta% /Y
echo 🔧 Aplicando optimizaciones de red...
fsutil behavior set disablelastaccess 1
fsutil behavior set mftzone 2
goto finalizar

:formateo_respaldo
echo 💾 Configurando para Respaldo...
format %unidad%: /FS:NTFS /A:65536 /Q /V:%etiqueta% /Y
echo 🔧 Aplicando optimizaciones para archivos grandes...
goto finalizar

:formateo_multimedia
echo 🎬 Configurando para Multimedia...
format %unidad%: /FS:NTFS /A:32768 /Q /V:%etiqueta% /Y
echo 🔧 Aplicando optimizaciones multimedia...
goto finalizar

:formateo_desarrollo
echo 💻 Configurando para Desarrollo...
format %unidad%: /FS:NTFS /A:4096 /Q /V:%etiqueta% /Y
echo 🔧 Aplicando optimizaciones para desarrollo...
goto finalizar

:finalizar
echo.
echo ✅ Formateo adaptativo completado
echo 📊 Verificando integridad...
chkdsk %unidad%: /F
echo.
echo 🎯 Unidad %unidad%: preparada para uso
pause
exit /b 0
```

---

## 💡 Consejos Importantes

### **Selección de Sistema de Archivos**
- **NTFS**: Para Windows, archivos grandes y seguridad avanzada
- **FAT32**: Para máxima compatibilidad entre sistemas
- **exFAT**: Para archivos grandes en dispositivos portátiles
- **ReFS**: Para servidores y alta disponibilidad

### **Tamaño de Clúster**
- **512 bytes - 4KB**: Para archivos pequeños y uso general
- **16KB - 32KB**: Para archivos medianos y multimedia
- **64KB - 128KB**: Para archivos muy grandes y respaldos

### **Seguridad**
- **Respaldo**: Siempre haz respaldo antes de formatear
- **Verificación**: Confirma la unidad correcta antes de formatear
- **Permisos**: Asegúrate de tener permisos de administrador

---

## 🌍 Casos de Uso Reales

### **Administración de Sistemas**
- **Preparación de Servidores**: Formateo optimizado para diferentes tipos de servidores
- **Mantenimiento de Estaciones**: Formateo programado de equipos corporativos
- **Migración de Datos**: Formateo para transferencia de datos entre sistemas

### **Entornos Educativos**
- **Laboratorios de Informática**: Formateo automático de equipos educativos
- **Proyectos Estudiantiles**: Preparación de unidades para proyectos
- **Mantenimiento de Red**: Formateo de unidades de red educativa

### **Empresas**
- **Estaciones de Trabajo**: Formateo automatizado en equipos corporativos
- **Servidores de Archivos**: Preparación de unidades para almacenamiento empresarial
- **Sistemas de Respaldo**: Formateo optimizado para sistemas de backup

---

## 🎯 Conclusión y Siguiente Paso

¡Excelente trabajo! Has dominado las técnicas avanzadas de formateo de discos, transformándote en un experto en la preparación y optimización de unidades de almacenamiento. La capacidad de configurar discos para diferentes usos y optimizar su rendimiento desde el inicio es una habilidad fundamental que te distinguirá como administrador de sistemas.

En el próximo capítulo, **"53. Crear particiones de disco"**, aprenderás técnicas avanzadas de particionamiento que complementarán perfectamente tus conocimientos de formateo. Descubrirás cómo dividir discos de manera eficiente, crear múltiples sistemas operativos y optimizar el uso del espacio de almacenamiento.

**¿Estás listo para convertirte en un experto en particionamiento de discos?** 🚀

---

## 📚 Enlaces Relacionados

- [Capítulo 30: Información del sistema](30.%20Información%20del%20sistema.md)
- [Capítulo 51: Comprobar disco y mostrar información de estado](51.%20Comprobar%20disco%20y%20mostrar%20información%20de%20estado.md)
- [Capítulo 53: Crear particiones de disco](53.%20Crear%20particiones%20de%20disco.md)

---

## 📖 Fuentes y Referencias

- **Microsoft Docs**: [Format Command](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/format)
- **Windows Command Line**: [Diskpart Commands](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/diskpart)
- **PowerShell Documentation**: [Storage Management](https://docs.microsoft.com/en-us/powershell/module/storage/)
- **Windows Sysinternals**: [Disk Management Tools](https://docs.microsoft.com/en-us/sysinternals/)

---

**Autor**: Jerson Martínez  
**Sitio Web**: [jersonmartinez.com](https://jersonmartinez.com)  
**Blog DevOps**: [crashell.com](https://crashell.com)  
**Fecha**: 2024 echo.
