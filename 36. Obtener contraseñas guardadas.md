# 36. Obtener contraseÃ±as guardadas

> *"Las contraseÃ±as son las llaves digitales de nuestro mundo. Â¿SabÃ­as que Windows almacena muchas contraseÃ±as de forma segura y puedes recuperarlas desde la lÃ­nea de comandos cuando sea necesario?"* ğŸ”‘

## IntroducciÃ³n

En el mundo digital actual, las contraseÃ±as son fundamentales para acceder a servicios, aplicaciones y recursos del sistema. Windows almacena estas credenciales de manera segura en diferentes ubicaciones, y como administrador de sistemas, necesitas saber cÃ³mo recuperarlas cuando sea necesario.

Â¿Te imaginas un servidor crÃ­tico donde el administrador anterior no dejÃ³ documentaciÃ³n de las contraseÃ±as? Â¿O una aplicaciÃ³n empresarial que requiere credenciales especÃ­ficas que se perdieron? Estas son situaciones reales donde la capacidad de recuperar contraseÃ±as guardadas puede ser crucial para mantener la operatividad del sistema.

En este capÃ­tulo, aprenderÃ¡s tÃ©cnicas profesionales para recuperar y gestionar contraseÃ±as almacenadas en Windows, desde credenciales del sistema hasta contraseÃ±as de aplicaciones.

## Conceptos Clave

### ğŸ”‘ **Credenciales Guardadas**
InformaciÃ³n de autenticaciÃ³n almacenada de forma segura en el sistema Windows.

### ğŸ›¡ï¸ **Administrador de Credenciales**
Sistema integrado de Windows para gestionar contraseÃ±as y credenciales.

### ğŸ” **Cifrado de ContraseÃ±as**
Proceso de protecciÃ³n de contraseÃ±as mediante algoritmos de encriptaciÃ³n.

### ğŸ“‹ **PolÃ­tica de Seguridad**
Conjunto de reglas que definen cÃ³mo se manejan las credenciales en el sistema.

## Comandos Principales

### `CMDKEY`
Comando para gestionar credenciales almacenadas en Windows.

**Sintaxis bÃ¡sica:**
```batch
cmdkey [opciones]
```

**Opciones principales:**
- `/list` - Listar credenciales almacenadas
- `/add` - Agregar nueva credencial
- `/delete` - Eliminar credencial especÃ­fica
- `/generic` - Especificar credencial genÃ©rica

### `POWERSHELL` (Get-StoredCredential)
Comando de PowerShell para acceder a credenciales almacenadas.

**Sintaxis:**
```powershell
Get-StoredCredential -Target "nombre_servicio"
```

### `REG QUERY`
Comando para consultar el registro de Windows donde se almacenan algunas credenciales.

**Sintaxis:**
```batch
reg query [ruta_clave] /v [nombre_valor]
```

### `CERTUTIL`
Comando para gestionar certificados y credenciales relacionadas.

**Sintaxis:**
```batch
certutil [opciones] [archivo]
```

## Ejemplos PrÃ¡cticos

### 1. **Listar Credenciales Guardadas**
**PropÃ³sito:** Ver todas las credenciales almacenadas en el sistema.

```batch
cmdkey /list
```

**Casos de uso reales:**
- AuditorÃ­a de credenciales del sistema
- VerificaciÃ³n de cuentas almacenadas
- DiagnÃ³stico de problemas de autenticaciÃ³n

### 2. **Agregar Nueva Credencial**
**PropÃ³sito:** Almacenar una nueva credencial para uso posterior.

```batch
cmdkey /add:servidor.local /user:administrador /pass:MiContraseÃ±a123
```

**Casos de uso reales:**
- ConfiguraciÃ³n de acceso a servidores remotos
- AutomatizaciÃ³n de scripts que requieren autenticaciÃ³n
- GestiÃ³n de credenciales de servicios

### 3. **Eliminar Credencial EspecÃ­fica**
**PropÃ³sito:** Remover una credencial almacenada del sistema.

```batch
cmdkey /delete:servidor.local
```

**Casos de uso reales:**
- Limpieza de credenciales obsoletas
- RotaciÃ³n de credenciales de seguridad
- Mantenimiento de credenciales del sistema

### 4. **Buscar Credenciales por PatrÃ³n**
**PropÃ³sito:** Encontrar credenciales que coincidan con un patrÃ³n especÃ­fico.

```batch
cmdkey /list | findstr "servidor"
```

**Casos de uso reales:**
- BÃºsqueda de credenciales especÃ­ficas
- AuditorÃ­a de acceso a servidores
- VerificaciÃ³n de configuraciÃ³n de red

### 5. **Exportar Credenciales a Archivo**
**PropÃ³sito:** Guardar la lista de credenciales en un archivo para auditorÃ­a.

```batch
cmdkey /list > credenciales_%date:~-4,4%%date:~-10,2%%date:~-7,2%.txt
```

**Casos de uso reales:**
- AuditorÃ­as de seguridad
- DocumentaciÃ³n de credenciales
- Backup de configuraciÃ³n

### 6. **Verificar Credenciales de Red**
**PropÃ³sito:** Comprobar credenciales almacenadas para conexiones de red.

```batch
cmdkey /list | findstr "TERMSRV"
```

**Casos de uso reales:**
- DiagnÃ³stico de problemas de RDP
- VerificaciÃ³n de acceso remoto
- GestiÃ³n de conexiones de escritorio remoto

### 7. **Gestionar Credenciales de Dominio**
**PropÃ³sito:** Administrar credenciales relacionadas con el dominio de Active Directory.

```batch
cmdkey /list | findstr "DOMAIN"
```

**Casos de uso reales:**
- GestiÃ³n de credenciales corporativas
- VerificaciÃ³n de autenticaciÃ³n de dominio
- AuditorÃ­a de acceso a recursos de red

### 8. **Limpiar Credenciales Expiradas**
**PropÃ³sito:** Eliminar credenciales que ya no son vÃ¡lidas o estÃ¡n expiradas.

```batch
for /f "tokens=1,2 delims= " %%a in ('cmdkey /list ^| findstr "EXPIRO"') do cmdkey /delete:%%b
```

**Casos de uso reales:**
- Mantenimiento de seguridad
- Limpieza automÃ¡tica de credenciales
- OptimizaciÃ³n del sistema

### 9. **Verificar Credenciales de Servicios**
**PropÃ³sito:** Comprobar credenciales utilizadas por servicios del sistema.

```batch
cmdkey /list | findstr "SERVICE"
```

**Casos de uso reales:**
- DiagnÃ³stico de servicios que fallan
- VerificaciÃ³n de cuentas de servicio
- AuditorÃ­a de servicios crÃ­ticos

### 10. **Backup de Credenciales**
**PropÃ³sito:** Crear una copia de seguridad de las credenciales del sistema.

```batch
echo === BACKUP DE CREDENCIALES === > backup_credenciales.txt
echo Fecha: %date% %time% >> backup_credenciales.txt
cmdkey /list >> backup_credenciales.txt
```

**Casos de uso reales:**
- PreparaciÃ³n para migraciÃ³n de sistemas
- DocumentaciÃ³n de configuraciÃ³n
- RecuperaciÃ³n ante desastres

## Scripts Avanzados

### Script para GestiÃ³n Avanzada de Credenciales

```batch
@echo off
:: Gestor avanzado de credenciales guardadas
title ğŸ”‘ Gestor de Credenciales
color 0A

:menu
cls
echo ========================================
echo    ğŸ”‘ GESTOR AVANZADO DE CREDENCIALES
echo ========================================
echo.
echo 1. ğŸ‘ï¸ Ver credenciales
echo 2. â• Agregar credencial
echo 3. âŒ Eliminar credencial
echo 4. ğŸ” Buscar credencial
echo 5. ğŸ“Š AuditorÃ­a de credenciales
echo 6. ğŸ’¾ Backup de credenciales
echo 7. ğŸ§¹ Limpiar credenciales
echo 8. ğŸšª Salir
echo.
set /p opcion="Selecciona una opciÃ³n: "

if "%opcion%"=="1" goto ver_credenciales
if "%opcion%"=="2" goto agregar_credencial
if "%opcion%"=="3" goto eliminar_credencial
if "%opcion%"=="4" goto buscar_credencial
if "%opcion%"=="5" goto auditoria_credenciales
if "%opcion%"=="6" goto backup_credenciales
if "%opcion%"=="7" goto limpiar_credenciales
if "%opcion%"=="8" goto salir
goto menu

:ver_credenciales
cls
echo ========================================
echo         ğŸ‘ï¸ VER CREDENCIALES
echo ========================================
echo.
echo ğŸ” Listando credenciales almacenadas...
cmdkey /list
echo.
pause
goto menu

:agregar_credencial
cls
echo ========================================
echo         â• AGREGAR CREDENCIAL
echo ========================================
echo.
set /p target="Nombre del objetivo (ej: servidor.local): "
set /p username="Nombre de usuario: "
set /p password="ContraseÃ±a: "
if defined target if defined username if defined password (
    echo ğŸ”„ Agregando credencial...
    cmdkey /add:%target% /user:%username% /pass:%password%
    echo âœ… Credencial agregada
) else (
    echo âŒ Datos incompletos
)
pause
goto menu

:eliminar_credencial
cls
echo ========================================
echo         âŒ ELIMINAR CREDENCIAL
echo ========================================
echo.
echo ğŸ” Credenciales disponibles:
cmdkey /list
echo.
set /p target="Nombre del objetivo a eliminar: "
if defined target (
    echo âš ï¸ Â¿Eliminar credencial %target%?
    set /p confirm="(S/N): "
    if /i "%confirm%"=="S" (
        cmdkey /delete:%target%
        echo âœ… Credencial eliminada
    ) else (
        echo âŒ OperaciÃ³n cancelada
    )
) else (
    echo âŒ Objetivo no especificado
)
pause
goto menu

:buscar_credencial
cls
echo ========================================
echo         ğŸ” BUSCAR CREDENCIAL
echo ========================================
echo.
set /p patron="PatrÃ³n de bÃºsqueda: "
if defined patron (
    echo ğŸ” Buscando credenciales que coincidan con: %patron%
    cmdkey /list | findstr /i "%patron%"
) else (
    echo âŒ PatrÃ³n no especificado
)
pause
goto menu

:auditoria_credenciales
cls
echo ========================================
echo         ğŸ“Š AUDITORÃA DE CREDENCIALES
echo ========================================
echo.
echo ğŸ” Realizando auditorÃ­a de credenciales...
echo.
echo === CREDENCIALES DE RED ===
cmdkey /list | findstr /i "TERMSRV\|DOMAIN"
echo.
echo === CREDENCIALES DE SERVICIOS ===
cmdkey /list | findstr /i "SERVICE\|SYSTEM"
echo.
echo === CREDENCIALES GENÃ‰RICAS ===
cmdkey /list | findstr /i "GENERIC"
echo.
echo === TOTAL DE CREDENCIALES ===
cmdkey /list | find /c "Objetivo"
pause
goto menu

:backup_credenciales
cls
echo ========================================
echo         ğŸ’¾ BACKUP DE CREDENCIALES
echo ========================================
echo.
echo ğŸ”„ Creando backup de credenciales...
set archivo=backup_credenciales_%date:~-4,4%%date:~-10,2%%date:~-7,2%_%time:~0,2%%time:~3,2%.txt
echo === BACKUP DE CREDENCIALES === > %archivo%
echo Fecha: %date% %time% >> %archivo%
echo. >> %archivo%
cmdkey /list >> %archivo%
echo âœ… Backup creado en %archivo%
pause
goto menu

:limpiar_credenciales
cls
echo ========================================
echo         ğŸ§¹ LIMPIAR CREDENCIALES
echo ========================================
echo.
echo âš ï¸ ADVERTENCIA: Esta operaciÃ³n eliminarÃ¡ credenciales obsoletas
echo.
echo 1. Limpiar credenciales de red obsoletas
echo 2. Limpiar credenciales de servicios
echo 3. Limpiar todas las credenciales
echo.
set /p tipo="Selecciona tipo de limpieza: "

if "%tipo%"=="1" (
    echo ğŸ”„ Limpiando credenciales de red obsoletas...
    for /f "tokens=1,2 delims= " %%a in ('cmdkey /list ^| findstr "TERMSRV"') do (
        echo Eliminando: %%b
        cmdkey /delete:%%b
    )
) else if "%tipo%"=="2" (
    echo ğŸ”„ Limpiando credenciales de servicios...
    for /f "tokens=1,2 delims= " %%a in ('cmdkey /list ^| findstr "SERVICE"') do (
        echo Eliminando: %%b
        cmdkey /delete:%%b
    )
) else if "%tipo%"=="3" (
    echo âš ï¸ Â¿Eliminar TODAS las credenciales?
    set /p confirm="(S/N): "
    if /i "%confirm%"=="S" (
        echo ğŸ”„ Limpiando todas las credenciales...
        for /f "tokens=1,2 delims= " %%a in ('cmdkey /list') do (
            cmdkey /delete:%%b
        )
    )
)
echo âœ… Limpieza completada
pause
goto menu

:salir
exit
```

### Script para RecuperaciÃ³n de Emergencia de Credenciales

```batch
@echo off
:: RecuperaciÃ³n de emergencia de credenciales
title ğŸš¨ RecuperaciÃ³n de Credenciales
color 0C

echo ========================================
echo    ğŸš¨ RECUPERACIÃ“N DE CREDENCIALES
echo ========================================
echo.

:menu
echo 1. ğŸ” Escaneo de emergencia
echo 2. ğŸ”‘ Recuperar credenciales crÃ­ticas
echo 3. ğŸ“‹ Generar reporte de emergencia
echo 4. ğŸšª Salir
echo.
set /p opcion="Selecciona opciÃ³n: "

if "%opcion%"=="1" goto escaneo_emergencia
if "%opcion%"=="2" goto recuperar_criticas
if "%opcion%"=="3" goto reporte_emergencia
if "%opcion%"=="4" goto salir
goto menu

:escaneo_emergencia
cls
echo ========================================
echo         ğŸ” ESCANEO DE EMERGENCIA
echo ========================================
echo.
echo ğŸ” Escaneando credenciales crÃ­ticas...
echo.
echo === CREDENCIALES DE ADMINISTRACIÃ“N ===
cmdkey /list | findstr /i "admin\|administrator"
echo.
echo === CREDENCIALES DE DOMINIO ===
cmdkey /list | findstr /i "domain\|corp"
echo.
echo === CREDENCIALES DE SERVIDORES ===
cmdkey /list | findstr /i "server\|srv"
echo.
echo === CREDENCIALES DE SERVICIOS ===
cmdkey /list | findstr /i "service\|system"
pause
goto menu

:recuperar_criticas
cls
echo ========================================
echo         ğŸ”‘ RECUPERAR CRÃTICAS
echo ========================================
echo.
echo ğŸ”„ Recuperando credenciales crÃ­ticas...
echo.
echo === CREDENCIALES DE ADMINISTRACIÃ“N ===
for /f "tokens=1,2 delims= " %%a in ('cmdkey /list ^| findstr "admin"') do (
    echo Credencial encontrada: %%b
    echo Usuario: %%a
)
echo.
echo === CREDENCIALES DE DOMINIO ===
for /f "tokens=1,2 delims= " %%a in ('cmdkey /list ^| findstr "domain"') do (
    echo Credencial encontrada: %%b
    echo Usuario: %%a
)
pause
goto menu

:reporte_emergencia
cls
echo ========================================
echo         ğŸ“‹ REPORTE DE EMERGENCIA
echo ========================================
echo.
echo ğŸ”„ Generando reporte de emergencia...
set archivo=emergencia_credenciales_%date:~-4,4%%date:~-10,2%%date:~-7,2%_%time:~0,2%%time:~3,2%.txt
echo === REPORTE DE EMERGENCIA === > %archivo%
echo Fecha: %date% %time% >> %archivo%
echo. >> %archivo%
echo === CREDENCIALES CRÃTICAS === >> %archivo%
cmdkey /list >> %archivo%
echo. >> %archivo%
echo === ANÃLISIS DE SEGURIDAD === >> %archivo%
echo Credenciales de administraciÃ³n: >> %archivo%
cmdkey /list | findstr /i "admin" >> %archivo%
echo âœ… Reporte generado en %archivo%
pause
goto menu

:salir
exit
```

## Consejos Importantes

### âš¡ **OptimizaciÃ³n**
- Revisa regularmente las credenciales almacenadas
- Elimina credenciales obsoletas o expiradas
- MantÃ©n un inventario actualizado de credenciales

### ğŸ›¡ï¸ **Seguridad**
- Usa credenciales fuertes y Ãºnicas
- Implementa rotaciÃ³n regular de contraseÃ±as
- Documenta cambios en credenciales crÃ­ticas

### ğŸ”§ **Mejores PrÃ¡cticas**
- Usa cmdkey para gestiÃ³n programÃ¡tica de credenciales
- Implementa auditorÃ­as regulares de credenciales
- MantÃ©n backups de configuraciÃ³n de credenciales

## Casos de Uso Reales

### ğŸ¢ **AdministraciÃ³n de Sistemas**
- GestiÃ³n de credenciales de servidores
- AutomatizaciÃ³n de scripts con autenticaciÃ³n
- RecuperaciÃ³n de credenciales perdidas

### ğŸ« **Entornos Educativos**
- GestiÃ³n de credenciales de laboratorios
- ConfiguraciÃ³n de acceso a recursos educativos
- AuditorÃ­a de credenciales de estudiantes

### ğŸ­ **Entornos Empresariales**
- GestiÃ³n de credenciales corporativas
- Cumplimiento de polÃ­ticas de seguridad
- RecuperaciÃ³n ante incidentes

## ConclusiÃ³n y Siguiente Paso

Has aprendido a gestionar credenciales guardadas de manera profesional y segura. Ahora puedes recuperar, administrar y auditar las contraseÃ±as almacenadas en el sistema Windows de manera eficiente.

En el siguiente capÃ­tulo, exploraremos cÃ³mo **Crear red hospedada**, donde aprenderÃ¡s a configurar y gestionar redes virtuales desde la lÃ­nea de comandos. Â¿Te imaginas creando redes de prueba para desarrollo o configurando entornos de aislamiento para seguridad? Â¡Esa serÃ¡ tu prÃ³xima habilidad!

---

## Enlaces Relacionados

- [CapÃ­tulo 35: Conexiones de red](35.%20Conexiones%20de%20red.md)
- [CapÃ­tulo 37: Crear red hospedada](37.%20Crear%20red%20hospedada.md)
- [CapÃ­tulo 40: Ejecutar como Administrador - RUNAS](40.%20Ejecutar%20como%20Administrador%20-%20RUNAS.md)

## Fuentes y Referencias

- **DocumentaciÃ³n oficial de Microsoft:** [Cmdkey Command](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/cmdkey)
- **Windows Command Line Reference:** [Credential Management](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/windows-commands)
- **AdministraciÃ³n de Windows Server:** [Credential Management](https://docs.microsoft.com/en-us/windows-server/administration/)

---

**Autor:** Jerson MartÃ­nez  
**Sitio web:** [jersonmartinez.com](https://jersonmartinez.com)  
**Blog DevOps:** [crashell.com](https://crashell.com) 