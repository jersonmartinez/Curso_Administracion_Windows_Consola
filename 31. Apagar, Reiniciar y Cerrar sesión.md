# 31. Apagar, Reiniciar y Cerrar sesi√≥n

> *"El control total del sistema incluye saber cu√°ndo y c√≥mo detenerlo. ¬øAlguna vez te has preguntado qu√© sucede realmente cuando apagas tu computadora desde la l√≠nea de comandos?"* üîå

## Introducci√≥n

En el mundo de la administraci√≥n de sistemas, el control sobre el ciclo de vida de una m√°quina es fundamental. No se trata solo de encender y usar, sino de saber c√≥mo **apagar, reiniciar o cerrar sesi√≥n** de manera controlada y eficiente. 

¬øTe imaginas administrar un servidor web que necesita mantenimiento programado? ¬øO gestionar un laboratorio de computadoras que requiere reinicio masivo? Estas operaciones, aparentemente simples, son la base de cualquier estrategia de administraci√≥n de sistemas profesional.

En este cap√≠tulo, exploraremos los comandos que te permitir√°n tener control total sobre el estado de tu sistema Windows, desde operaciones b√°sicas hasta escenarios empresariales complejos.

## Conceptos Clave

### üîå **Apagado del Sistema**
El proceso de cerrar completamente el sistema operativo y apagar la energ√≠a de la computadora de manera controlada.

### üîÑ **Reinicio**
El proceso de apagar y volver a encender el sistema operativo sin apagar f√≠sicamente la computadora.

### üë§ **Cierre de Sesi√≥n**
El proceso de cerrar la sesi√≥n del usuario actual sin afectar otros usuarios o el sistema operativo.

### ‚è∞ **Apagado Programado**
La capacidad de programar operaciones de apagado o reinicio para ejecutarse en un momento espec√≠fico.

## Comandos y herramientas principales

### `SHUTDOWN`
Comando principal para apagar, reiniciar o cerrar sesi√≥n del sistema de manera controlada.

**Sintaxis b√°sica:**
```batch
shutdown [opciones] [tiempo] [mensaje]
```

**Par√°metros principales:**
- `/s` - Apagar el sistema completamente
- `/r` - Reiniciar el sistema operativo
- `/l` - Cerrar sesi√≥n del usuario actual
- `/h` - Poner el sistema en modo hibernaci√≥n
- `/a` - Cancelar un apagado o reinicio programado
- `/t <segundos>` - Especificar tiempo de espera en segundos (0 para inmediato)
- `/c "comentario"` - Agregar comentario o mensaje para el usuario
- `/f` - Forzar el cierre de aplicaciones sin confirmaci√≥n
- `/d p:x:y` - Especificar raz√≥n del apagado para auditor√≠a (p=programado, u=usuario, x=c√≥digo mayor, y=c√≥digo menor)
- `/m \\computadora` - Especificar computadora remota
- `/i` - Mostrar interfaz gr√°fica de di√°logo

### `LOGOFF`
Comando espec√≠fico para cerrar sesi√≥n del usuario actual sin afectar otros usuarios o el sistema.

**Sintaxis:**
```batch
logoff [opciones]
```

**Par√°metros:**
- `/s` - Cerrar sesi√≥n en computadora remota
- `/v` - Mostrar informaci√≥n detallada

### `EXIT`
Comando para salir de la sesi√≥n actual de CMD o cerrar ventanas de comando.

**Sintaxis:**
```batch
exit [/b] [c√≥digo]
```

**Par√°metros:**
- `/b` - Salir del script actual pero mantener CMD abierto
- `c√≥digo` - C√≥digo de salida para indicar √©xito o error

### Comandos adicionales utilizados
- `QUERY USER` - Mostrar usuarios conectados al sistema
- `NET STATISTICS` - Mostrar estad√≠sticas del servidor
- `TASKLIST` - Listar procesos en ejecuci√≥n
- `FINDSTR` - Buscar cadenas en la salida de comandos
- `FOR /F` - Procesar archivos l√≠nea por l√≠nea
- `IF` - Condiciones en scripts
- `PAUSE` - Pausar ejecuci√≥n del script

## Ejemplos Pr√°cticos

### 1. **Apagado Inmediato del Sistema**
**Prop√≥sito:** Apagar la computadora inmediatamente sin confirmaci√≥n.

```batch
shutdown /s /t 0
```

**Casos de uso reales:**
- Mantenimiento de emergencia en servidores
- Apagado remoto de estaciones de trabajo
- Finalizaci√≥n de procesos de backup

### 2. **Reinicio con Tiempo de Espera**
**Prop√≥sito:** Reiniciar el sistema despu√©s de 30 segundos, dando tiempo para guardar trabajo.

```batch
shutdown /r /t 30 /c "El sistema se reiniciar√° en 30 segundos. Guarde su trabajo."
```

**Casos de uso reales:**
- Aplicaci√≥n de actualizaciones de Windows
- Cambios de configuraci√≥n que requieren reinicio
- Resoluci√≥n de problemas de rendimiento

### 3. **Cierre de Sesi√≥n Inmediato**
**Prop√≥sito:** Cerrar la sesi√≥n del usuario actual sin afectar otros usuarios.

```batch
shutdown /l
```

**Casos de uso reales:**
- Cambio de usuario en estaciones compartidas
- Finalizaci√≥n de sesiones temporales
- Limpieza de sesiones de usuario

### 4. **Apagado Programado**
**Prop√≥sito:** Programar un apagado para ejecutarse en 2 horas.

```batch
shutdown /s /t 7200 /c "Apagado programado para mantenimiento nocturno"
```

**Casos de uso reales:**
- Mantenimiento programado de servidores
- Ahorro de energ√≠a en horarios no laborales
- Procesos de backup nocturnos

### 5. **Cancelar Apagado Programado**
**Prop√≥sito:** Cancelar un apagado o reinicio programado previamente.

```batch
shutdown /a
```

**Casos de uso reales:**
- Cambio de planes de mantenimiento
- Extensi√≥n de tiempo de trabajo
- Cancelaci√≥n de actualizaciones autom√°ticas

### 6. **Reinicio Forzado**
**Prop√≥sito:** Reiniciar el sistema forzando el cierre de aplicaciones.

```batch
shutdown /r /f /t 0
```

**Casos de uso reales:**
- Sistema colgado que no responde
- Aplicaciones que no se cierran correctamente
- Emergencias que requieren reinicio inmediato

### 7. **Apagado con Raz√≥n Espec√≠fica**
**Prop√≥sito:** Apagar el sistema especificando una raz√≥n para auditor√≠a.

```batch
shutdown /s /t 0 /d p:0:0 /c "Mantenimiento programado - C√≥digo: MAINT001"
```

**Casos de uso reales:**
- Cumplimiento de pol√≠ticas de auditor√≠a
- Seguimiento de mantenimientos
- Documentaci√≥n de cambios de sistema

### 8. **Cierre de Sesi√≥n Remoto**
**Prop√≥sito:** Cerrar sesi√≥n en una computadora remota.

```batch
shutdown /l /m \\NOMBRE-PC
```

**Casos de uso reales:**
- Administraci√≥n de estaciones de trabajo remotas
- Limpieza de sesiones en laboratorios
- Gesti√≥n de usuarios en redes corporativas

### 9. **Hibernaci√≥n del Sistema**
**Prop√≥sito:** Poner el sistema en modo hibernaci√≥n.

```batch
shutdown /h
```

**Casos de uso reales:**
- Ahorro de energ√≠a en laptops
- Preservaci√≥n del estado del sistema
- Transiciones r√°pidas entre sesiones

### 10. **Apagado con Mensaje Personalizado**
**Prop√≥sito:** Apagar el sistema con un mensaje informativo para el usuario.

```batch
shutdown /s /t 60 /c "El sistema se apagar√° en 1 minuto. Guarde todos sus archivos."
```

**Casos de uso reales:**
- Notificaciones de mantenimiento
- Alertas de seguridad
- Comunicaci√≥n con usuarios finales



## Consejos Importantes

### ‚ö° **Optimizaci√≥n**
- Usa `/t 0` para operaciones inmediatas
- Utiliza `/f` solo cuando sea absolutamente necesario
- Programa apagados para horarios de bajo uso

### üõ°Ô∏è **Seguridad**
- Verifica usuarios conectados antes de apagar
- Usa mensajes informativos para notificar cambios
- Documenta razones de apagado para auditor√≠a

### üîß **Mejores Pr√°cticas**
- Siempre notifica a usuarios antes de apagar
- Usa c√≥digos de raz√≥n para seguimiento
- Mant√©n logs de operaciones de apagado

## Casos de Uso Reales

### üè¢ **Administraci√≥n de Sistemas**
- Mantenimiento programado de servidores
- Aplicaci√≥n de parches de seguridad
- Gesti√≥n de energ√≠a en centros de datos

### üè´ **Entornos Educativos**
- Apagado autom√°tico de laboratorios
- Reinicio masivo de estaciones de trabajo
- Limpieza de sesiones de estudiantes

### üè≠ **Entornos Empresariales**
- Gesti√≥n de horarios de trabajo
- Mantenimiento preventivo
- Cumplimiento de pol√≠ticas de seguridad

## Conclusi√≥n y Siguiente Paso

Has aprendido a tener control total sobre el ciclo de vida de tu sistema Windows. Desde operaciones b√°sicas hasta gesti√≥n masiva en redes, estos comandos son fundamentales para cualquier administrador de sistemas.

En el siguiente cap√≠tulo, exploraremos la **Gesti√≥n de usuarios**, donde aprender√°s a crear, modificar y administrar cuentas de usuario desde la l√≠nea de comandos. ¬øTe imaginas gestionando cientos de usuarios en una empresa sin herramientas gr√°ficas? ¬°Esa ser√° tu nueva realidad!

---

## Enlaces Relacionados

- [Cap√≠tulo 32: Gesti√≥n de usuarios](32.%20Gesti√≥n%20de%20usuarios.md)
- [Cap√≠tulo 34: Gesti√≥n de Procesos](34.%20Gesti√≥n%20de%20Procesos.md)
- [Cap√≠tulo 40: Ejecutar como Administrador - RUNAS](40.%20Ejecutar%20como%20Administrador%20-%20RUNAS.md)

## Fuentes y Referencias

- **Documentaci√≥n oficial de Microsoft:** [Shutdown Command](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/shutdown)
- **Windows Command Line Reference:** [System Commands](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/windows-commands)
- **Administraci√≥n de Windows Server:** [System Management](https://docs.microsoft.com/en-us/windows-server/administration/)

---

## Scripts disponibles

En el directorio `scripts/31-apagar-reiniciar-cerrar-sesion/` encontrar√°s los siguientes scripts para automatizar las operaciones de apagado, reinicio y cierre de sesi√≥n:

### üîå **Gesti√≥n local del sistema**
- **`gestor-avanzado-apagado.bat`** - Interfaz completa para gestionar apagado, reinicio, hibernaci√≥n y estado del sistema
- **`apagado-masivo-red.bat`** - Herramienta para apagar, reiniciar o cerrar sesiones en m√∫ltiples computadoras de red

### üìã **Instrucciones de uso**

1. **Para usar el gestor avanzado:**
   ```batch
   cd scripts\31-apagar-reiniciar-cerrar-sesion
   gestor-avanzado-apagado.bat
   ```

2. **Para apagado masivo en red:**
   - Crea un archivo de texto con los nombres de las computadoras (uno por l√≠nea)
   - Ejecuta: `apagado-masivo-red.bat`
   - Selecciona la opci√≥n deseada y proporciona el archivo con la lista de PCs

### ‚ö†Ô∏è **Notas importantes**
- Ejecuta estos scripts como administrador para operaciones remotas
- Verifica que las computadoras objetivo est√©n accesibles en la red
- Usa mensajes informativos para notificar a los usuarios antes de apagar

---

**Autor:** Jerson Mart√≠nez  
**Sitio web:** [jersonmartinez.com](https://jersonmartinez.com)  
**Blog DevOps:** [crashell.com](https://crashell.com) 