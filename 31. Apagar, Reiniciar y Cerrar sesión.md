# 31. Apagar, Reiniciar y Cerrar sesión

> *"El control total del sistema incluye saber cuándo y cómo detenerlo. ¿Alguna vez te has preguntado qué sucede realmente cuando apagas tu computadora desde la línea de comandos?"* 🔌

## Introducción

En el mundo de la administración de sistemas, el control sobre el ciclo de vida de una máquina es fundamental. No se trata solo de encender y usar, sino de saber cómo **apagar, reiniciar o cerrar sesión** de manera controlada y eficiente. 

¿Te imaginas administrar un servidor web que necesita mantenimiento programado? ¿O gestionar un laboratorio de computadoras que requiere reinicio masivo? Estas operaciones, aparentemente simples, son la base de cualquier estrategia de administración de sistemas profesional.

En este capítulo, exploraremos los comandos que te permitirán tener control total sobre el estado de tu sistema Windows, desde operaciones básicas hasta escenarios empresariales complejos.

## Conceptos Clave

### 🔌 **Apagado del Sistema**
El proceso de cerrar completamente el sistema operativo y apagar la energía de la computadora de manera controlada.

### 🔄 **Reinicio**
El proceso de apagar y volver a encender el sistema operativo sin apagar físicamente la computadora.

### 👤 **Cierre de Sesión**
El proceso de cerrar la sesión del usuario actual sin afectar otros usuarios o el sistema operativo.

### ⏰ **Apagado Programado**
La capacidad de programar operaciones de apagado o reinicio para ejecutarse en un momento específico.

## Comandos Principales

### `SHUTDOWN`
Comando principal para apagar, reiniciar o cerrar sesión del sistema.

**Sintaxis básica:**
```batch
shutdown [opciones] [tiempo] [mensaje]
```

**Opciones principales:**
- `/s` - Apagar el sistema
- `/r` - Reiniciar el sistema  
- `/l` - Cerrar sesión
- `/h` - Hibernar el sistema
- `/a` - Cancelar apagado programado
- `/t` - Especificar tiempo en segundos
- `/c` - Comentario para el apagado
- `/f` - Forzar cierre de aplicaciones
- `/d` - Especificar razón del apagado

### `LOGOFF`
Comando específico para cerrar sesión del usuario actual.

**Sintaxis:**
```batch
logoff [opciones]
```

### `EXIT`
Comando para salir de la sesión actual de CMD o cerrar ventanas.

**Sintaxis:**
```batch
exit [/b] [código]
```

## Ejemplos Prácticos

### 1. **Apagado Inmediato del Sistema**
**Propósito:** Apagar la computadora inmediatamente sin confirmación.

```batch
shutdown /s /t 0
```

**Casos de uso reales:**
- Mantenimiento de emergencia en servidores
- Apagado remoto de estaciones de trabajo
- Finalización de procesos de backup

### 2. **Reinicio con Tiempo de Espera**
**Propósito:** Reiniciar el sistema después de 30 segundos, dando tiempo para guardar trabajo.

```batch
shutdown /r /t 30 /c "El sistema se reiniciará en 30 segundos. Guarde su trabajo."
```

**Casos de uso reales:**
- Aplicación de actualizaciones de Windows
- Cambios de configuración que requieren reinicio
- Resolución de problemas de rendimiento

### 3. **Cierre de Sesión Inmediato**
**Propósito:** Cerrar la sesión del usuario actual sin afectar otros usuarios.

```batch
shutdown /l
```

**Casos de uso reales:**
- Cambio de usuario en estaciones compartidas
- Finalización de sesiones temporales
- Limpieza de sesiones de usuario

### 4. **Apagado Programado**
**Propósito:** Programar un apagado para ejecutarse en 2 horas.

```batch
shutdown /s /t 7200 /c "Apagado programado para mantenimiento nocturno"
```

**Casos de uso reales:**
- Mantenimiento programado de servidores
- Ahorro de energía en horarios no laborales
- Procesos de backup nocturnos

### 5. **Cancelar Apagado Programado**
**Propósito:** Cancelar un apagado o reinicio programado previamente.

```batch
shutdown /a
```

**Casos de uso reales:**
- Cambio de planes de mantenimiento
- Extensión de tiempo de trabajo
- Cancelación de actualizaciones automáticas

### 6. **Reinicio Forzado**
**Propósito:** Reiniciar el sistema forzando el cierre de aplicaciones.

```batch
shutdown /r /f /t 0
```

**Casos de uso reales:**
- Sistema colgado que no responde
- Aplicaciones que no se cierran correctamente
- Emergencias que requieren reinicio inmediato

### 7. **Apagado con Razón Específica**
**Propósito:** Apagar el sistema especificando una razón para auditoría.

```batch
shutdown /s /t 0 /d p:0:0 /c "Mantenimiento programado - Código: MAINT001"
```

**Casos de uso reales:**
- Cumplimiento de políticas de auditoría
- Seguimiento de mantenimientos
- Documentación de cambios de sistema

### 8. **Cierre de Sesión Remoto**
**Propósito:** Cerrar sesión en una computadora remota.

```batch
shutdown /l /m \\NOMBRE-PC
```

**Casos de uso reales:**
- Administración de estaciones de trabajo remotas
- Limpieza de sesiones en laboratorios
- Gestión de usuarios en redes corporativas

### 9. **Hibernación del Sistema**
**Propósito:** Poner el sistema en modo hibernación.

```batch
shutdown /h
```

**Casos de uso reales:**
- Ahorro de energía en laptops
- Preservación del estado del sistema
- Transiciones rápidas entre sesiones

### 10. **Apagado con Mensaje Personalizado**
**Propósito:** Apagar el sistema con un mensaje informativo para el usuario.

```batch
shutdown /s /t 60 /c "El sistema se apagará en 1 minuto. Guarde todos sus archivos."
```

**Casos de uso reales:**
- Notificaciones de mantenimiento
- Alertas de seguridad
- Comunicación con usuarios finales

## Scripts Avanzados

### Script para Gestión Avanzada de Apagado

```batch
@echo off
:: Gestor avanzado de apagado del sistema
title 🔌 Gestor de Apagado del Sistema
color 0A

:menu
cls
echo ========================================
echo    🔌 GESTOR AVANZADO DE APAGADO
echo ========================================
echo.
echo 1. 🔌 Apagar sistema
echo 2. 🔄 Reiniciar sistema
echo 3. 👤 Cerrar sesión
echo 4. ⏰ Programar apagado
echo 5. ❌ Cancelar apagado
echo 6. 🌙 Hibernar sistema
echo 7. 📊 Estado del sistema
echo 8. 🚪 Salir
echo.
set /p opcion="Selecciona una opción: "

if "%opcion%"=="1" goto apagar_sistema
if "%opcion%"=="2" goto reiniciar_sistema
if "%opcion%"=="3" goto cerrar_sesion
if "%opcion%"=="4" goto programar_apagado
if "%opcion%"=="5" goto cancelar_apagado
if "%opcion%"=="6" goto hibernar_sistema
if "%opcion%"=="7" goto estado_sistema
if "%opcion%"=="8" goto salir
goto menu

:apagar_sistema
cls
echo ========================================
echo         🔌 APAGAR SISTEMA
echo ========================================
echo.
echo 1. Apagado inmediato
echo 2. Apagado con tiempo de espera
echo 3. Apagado forzado
echo.
set /p tipo="Selecciona tipo de apagado: "
if "%tipo%"=="1" (
    echo 🔌 Apagando sistema inmediatamente...
    shutdown /s /t 0
) else if "%tipo%"=="2" (
    set /p tiempo="Tiempo en segundos: "
    shutdown /s /t %tiempo%
) else if "%tipo%"=="3" (
    echo 🔌 Apagado forzado...
    shutdown /s /f /t 0
)
pause
goto menu

:reiniciar_sistema
cls
echo ========================================
echo         🔄 REINICIAR SISTEMA
echo ========================================
echo.
echo 1. Reinicio inmediato
echo 2. Reinicio con tiempo de espera
echo 3. Reinicio forzado
echo.
set /p tipo="Selecciona tipo de reinicio: "
if "%tipo%"=="1" (
    echo 🔄 Reiniciando sistema...
    shutdown /r /t 0
) else if "%tipo%"=="2" (
    set /p tiempo="Tiempo en segundos: "
    shutdown /r /t %tiempo%
) else if "%tipo%"=="3" (
    echo 🔄 Reinicio forzado...
    shutdown /r /f /t 0
)
pause
goto menu

:cerrar_sesion
cls
echo ========================================
echo         👤 CERRAR SESIÓN
echo ========================================
echo.
echo 🔄 Cerrando sesión actual...
shutdown /l
pause
goto menu

:programar_apagado
cls
echo ========================================
echo         ⏰ PROGRAMAR APAGADO
echo ========================================
echo.
set /p tiempo="Tiempo en segundos: "
set /p mensaje="Mensaje (opcional): "
if defined mensaje (
    shutdown /s /t %tiempo% /c "%mensaje%"
) else (
    shutdown /s /t %tiempo%
)
echo ✅ Apagado programado
pause
goto menu

:cancelar_apagado
cls
echo ========================================
echo         ❌ CANCELAR APAGADO
echo ========================================
echo.
echo 🔄 Cancelando apagado programado...
shutdown /a
echo ✅ Apagado cancelado
pause
goto menu

:hibernar_sistema
cls
echo ========================================
echo         🌙 HIBERNAR SISTEMA
echo ========================================
echo.
echo 🌙 Poniendo sistema en hibernación...
shutdown /h
pause
goto menu

:estado_sistema
cls
echo ========================================
echo         📊 ESTADO DEL SISTEMA
echo ========================================
echo.
echo 🔍 Verificando estado del sistema...
echo === TIEMPO ACTIVO ===
net statistics server | findstr "Statistics since"
echo === USUARIOS CONECTADOS ===
query user
echo === PROCESOS CRÍTICOS ===
tasklist | findstr /i "explorer winlogon services"
pause
goto menu

:salir
exit
```

### Script para Apagado Masivo de Red

```batch
@echo off
:: Apagado masivo de computadoras en red
title 🌐 Apagado Masivo de Red
color 0A

echo ========================================
echo    🌐 APAGADO MASIVO DE RED
echo ========================================
echo.

:menu
echo 1. 📋 Listar computadoras
echo 2. 🔌 Apagar computadoras
echo 3. 🔄 Reiniciar computadoras
echo 4. 👤 Cerrar sesiones remotas
echo 5. 🚪 Salir
echo.
set /p opcion="Selecciona opción: "

if "%opcion%"=="1" goto listar_pcs
if "%opcion%"=="2" goto apagar_pcs
if "%opcion%"=="3" goto reiniciar_pcs
if "%opcion%"=="4" goto cerrar_sesiones
if "%opcion%"=="5" goto salir
goto menu

:listar_pcs
cls
echo ========================================
echo         📋 LISTAR COMPUTADORAS
echo ========================================
echo.
set /p archivo="Archivo con lista de PCs: "
if exist "%archivo%" (
    echo 📋 Computadoras en la lista:
    type "%archivo%"
) else (
    echo ❌ Archivo no encontrado
)
pause
goto menu

:apagar_pcs
cls
echo ========================================
echo         🔌 APAGAR COMPUTADORAS
echo ========================================
echo.
set /p archivo="Archivo con lista de PCs: "
set /p tiempo="Tiempo de espera (segundos): "
if exist "%archivo%" (
    echo 🔌 Apagando computadoras...
    for /f %%i in (%archivo%) do (
        echo Apagando: %%i
        shutdown /s /t %tiempo% /m \\%%i
    )
    echo ✅ Proceso de apagado iniciado
) else (
    echo ❌ Archivo no encontrado
)
pause
goto menu

:reiniciar_pcs
cls
echo ========================================
echo         🔄 REINICIAR COMPUTADORAS
echo ========================================
echo.
set /p archivo="Archivo con lista de PCs: "
set /p tiempo="Tiempo de espera (segundos): "
if exist "%archivo%" (
    echo 🔄 Reiniciando computadoras...
    for /f %%i in (%archivo%) do (
        echo Reiniciando: %%i
        shutdown /r /t %tiempo% /m \\%%i
    )
    echo ✅ Proceso de reinicio iniciado
) else (
    echo ❌ Archivo no encontrado
)
pause
goto menu

:cerrar_sesiones
cls
echo ========================================
echo         👤 CERRAR SESIONES REMOTAS
echo ========================================
echo.
set /p archivo="Archivo con lista de PCs: "
if exist "%archivo%" (
    echo 👤 Cerrando sesiones remotas...
    for /f %%i in (%archivo%) do (
        echo Cerrando sesión en: %%i
        shutdown /l /m \\%%i
    )
    echo ✅ Sesiones cerradas
) else (
    echo ❌ Archivo no encontrado
)
pause
goto menu

:salir
exit
```

## Consejos Importantes

### ⚡ **Optimización**
- Usa `/t 0` para operaciones inmediatas
- Utiliza `/f` solo cuando sea absolutamente necesario
- Programa apagados para horarios de bajo uso

### 🛡️ **Seguridad**
- Verifica usuarios conectados antes de apagar
- Usa mensajes informativos para notificar cambios
- Documenta razones de apagado para auditoría

### 🔧 **Mejores Prácticas**
- Siempre notifica a usuarios antes de apagar
- Usa códigos de razón para seguimiento
- Mantén logs de operaciones de apagado

## Casos de Uso Reales

### 🏢 **Administración de Sistemas**
- Mantenimiento programado de servidores
- Aplicación de parches de seguridad
- Gestión de energía en centros de datos

### 🏫 **Entornos Educativos**
- Apagado automático de laboratorios
- Reinicio masivo de estaciones de trabajo
- Limpieza de sesiones de estudiantes

### 🏭 **Entornos Empresariales**
- Gestión de horarios de trabajo
- Mantenimiento preventivo
- Cumplimiento de políticas de seguridad

## Conclusión y Siguiente Paso

Has aprendido a tener control total sobre el ciclo de vida de tu sistema Windows. Desde operaciones básicas hasta gestión masiva en redes, estos comandos son fundamentales para cualquier administrador de sistemas.

En el siguiente capítulo, exploraremos la **Gestión de usuarios**, donde aprenderás a crear, modificar y administrar cuentas de usuario desde la línea de comandos. ¿Te imaginas gestionando cientos de usuarios en una empresa sin herramientas gráficas? ¡Esa será tu nueva realidad!

---

## Enlaces Relacionados

- [Capítulo 32: Gestión de usuarios](32.%20Gestión%20de%20usuarios.md)
- [Capítulo 34: Gestión de Procesos](34.%20Gestión%20de%20Procesos.md)
- [Capítulo 40: Ejecutar como Administrador - RUNAS](40.%20Ejecutar%20como%20Administrador%20-%20RUNAS.md)

## Fuentes y Referencias

- **Documentación oficial de Microsoft:** [Shutdown Command](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/shutdown)
- **Windows Command Line Reference:** [System Commands](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/windows-commands)
- **Administración de Windows Server:** [System Management](https://docs.microsoft.com/en-us/windows-server/administration/)

---

**Autor:** Jerson Martínez  
**Sitio web:** [jersonmartinez.com](https://jersonmartinez.com)  
**Blog DevOps:** [crashell.com](https://crashell.com) 