# 31. Apagar, Reiniciar y Cerrar sesiÃ³n

> *"El control total del sistema incluye saber cuÃ¡ndo y cÃ³mo detenerlo. Â¿Alguna vez te has preguntado quÃ© sucede realmente cuando apagas tu computadora desde la lÃ­nea de comandos?"* ğŸ”Œ

## IntroducciÃ³n

En el mundo de la administraciÃ³n de sistemas, el control sobre el ciclo de vida de una mÃ¡quina es fundamental. No se trata solo de encender y usar, sino de saber cÃ³mo **apagar, reiniciar o cerrar sesiÃ³n** de manera controlada y eficiente. 

Â¿Te imaginas administrar un servidor web que necesita mantenimiento programado? Â¿O gestionar un laboratorio de computadoras que requiere reinicio masivo? Estas operaciones, aparentemente simples, son la base de cualquier estrategia de administraciÃ³n de sistemas profesional.

En este capÃ­tulo, exploraremos los comandos que te permitirÃ¡n tener control total sobre el estado de tu sistema Windows, desde operaciones bÃ¡sicas hasta escenarios empresariales complejos.

## Conceptos Clave

### ğŸ”Œ **Apagado del Sistema**
El proceso de cerrar completamente el sistema operativo y apagar la energÃ­a de la computadora de manera controlada.

### ğŸ”„ **Reinicio**
El proceso de apagar y volver a encender el sistema operativo sin apagar fÃ­sicamente la computadora.

### ğŸ‘¤ **Cierre de SesiÃ³n**
El proceso de cerrar la sesiÃ³n del usuario actual sin afectar otros usuarios o el sistema operativo.

### â° **Apagado Programado**
La capacidad de programar operaciones de apagado o reinicio para ejecutarse en un momento especÃ­fico.

## Comandos Principales

### `SHUTDOWN`
Comando principal para apagar, reiniciar o cerrar sesiÃ³n del sistema.

**Sintaxis bÃ¡sica:**
```batch
shutdown [opciones] [tiempo] [mensaje]
```

**Opciones principales:**
- `/s` - Apagar el sistema
- `/r` - Reiniciar el sistema  
- `/l` - Cerrar sesiÃ³n
- `/h` - Hibernar el sistema
- `/a` - Cancelar apagado programado
- `/t` - Especificar tiempo en segundos
- `/c` - Comentario para el apagado
- `/f` - Forzar cierre de aplicaciones
- `/d` - Especificar razÃ³n del apagado

### `LOGOFF`
Comando especÃ­fico para cerrar sesiÃ³n del usuario actual.

**Sintaxis:**
```batch
logoff [opciones]
```

### `EXIT`
Comando para salir de la sesiÃ³n actual de CMD o cerrar ventanas.

**Sintaxis:**
```batch
exit [/b] [cÃ³digo]
```

## Ejemplos PrÃ¡cticos

### 1. **Apagado Inmediato del Sistema**
**PropÃ³sito:** Apagar la computadora inmediatamente sin confirmaciÃ³n.

```batch
shutdown /s /t 0
```

**Casos de uso reales:**
- Mantenimiento de emergencia en servidores
- Apagado remoto de estaciones de trabajo
- FinalizaciÃ³n de procesos de backup

### 2. **Reinicio con Tiempo de Espera**
**PropÃ³sito:** Reiniciar el sistema despuÃ©s de 30 segundos, dando tiempo para guardar trabajo.

```batch
shutdown /r /t 30 /c "El sistema se reiniciarÃ¡ en 30 segundos. Guarde su trabajo."
```

**Casos de uso reales:**
- AplicaciÃ³n de actualizaciones de Windows
- Cambios de configuraciÃ³n que requieren reinicio
- ResoluciÃ³n de problemas de rendimiento

### 3. **Cierre de SesiÃ³n Inmediato**
**PropÃ³sito:** Cerrar la sesiÃ³n del usuario actual sin afectar otros usuarios.

```batch
shutdown /l
```

**Casos de uso reales:**
- Cambio de usuario en estaciones compartidas
- FinalizaciÃ³n de sesiones temporales
- Limpieza de sesiones de usuario

### 4. **Apagado Programado**
**PropÃ³sito:** Programar un apagado para ejecutarse en 2 horas.

```batch
shutdown /s /t 7200 /c "Apagado programado para mantenimiento nocturno"
```

**Casos de uso reales:**
- Mantenimiento programado de servidores
- Ahorro de energÃ­a en horarios no laborales
- Procesos de backup nocturnos

### 5. **Cancelar Apagado Programado**
**PropÃ³sito:** Cancelar un apagado o reinicio programado previamente.

```batch
shutdown /a
```

**Casos de uso reales:**
- Cambio de planes de mantenimiento
- ExtensiÃ³n de tiempo de trabajo
- CancelaciÃ³n de actualizaciones automÃ¡ticas

### 6. **Reinicio Forzado**
**PropÃ³sito:** Reiniciar el sistema forzando el cierre de aplicaciones.

```batch
shutdown /r /f /t 0
```

**Casos de uso reales:**
- Sistema colgado que no responde
- Aplicaciones que no se cierran correctamente
- Emergencias que requieren reinicio inmediato

### 7. **Apagado con RazÃ³n EspecÃ­fica**
**PropÃ³sito:** Apagar el sistema especificando una razÃ³n para auditorÃ­a.

```batch
shutdown /s /t 0 /d p:0:0 /c "Mantenimiento programado - CÃ³digo: MAINT001"
```

**Casos de uso reales:**
- Cumplimiento de polÃ­ticas de auditorÃ­a
- Seguimiento de mantenimientos
- DocumentaciÃ³n de cambios de sistema

### 8. **Cierre de SesiÃ³n Remoto**
**PropÃ³sito:** Cerrar sesiÃ³n en una computadora remota.

```batch
shutdown /l /m \\NOMBRE-PC
```

**Casos de uso reales:**
- AdministraciÃ³n de estaciones de trabajo remotas
- Limpieza de sesiones en laboratorios
- GestiÃ³n de usuarios en redes corporativas

### 9. **HibernaciÃ³n del Sistema**
**PropÃ³sito:** Poner el sistema en modo hibernaciÃ³n.

```batch
shutdown /h
```

**Casos de uso reales:**
- Ahorro de energÃ­a en laptops
- PreservaciÃ³n del estado del sistema
- Transiciones rÃ¡pidas entre sesiones

### 10. **Apagado con Mensaje Personalizado**
**PropÃ³sito:** Apagar el sistema con un mensaje informativo para el usuario.

```batch
shutdown /s /t 60 /c "El sistema se apagarÃ¡ en 1 minuto. Guarde todos sus archivos."
```

**Casos de uso reales:**
- Notificaciones de mantenimiento
- Alertas de seguridad
- ComunicaciÃ³n con usuarios finales

## Scripts Avanzados

### Script para GestiÃ³n Avanzada de Apagado

```batch
@echo off
:: Gestor avanzado de apagado del sistema
title ğŸ”Œ Gestor de Apagado del Sistema
color 0A

:menu
cls
echo ========================================
echo    ğŸ”Œ GESTOR AVANZADO DE APAGADO
echo ========================================
echo.
echo 1. ğŸ”Œ Apagar sistema
echo 2. ğŸ”„ Reiniciar sistema
echo 3. ğŸ‘¤ Cerrar sesiÃ³n
echo 4. â° Programar apagado
echo 5. âŒ Cancelar apagado
echo 6. ğŸŒ™ Hibernar sistema
echo 7. ğŸ“Š Estado del sistema
echo 8. ğŸšª Salir
echo.
set /p opcion="Selecciona una opciÃ³n: "

if "%opcion%"=="1" goto apagar_sistema
if "%opcion%"=="2" goto reiniciar_sistema
if "%opcion%"=="3" goto cerrar_sesion
if "%opcion%"=="4" goto programar_apagado
if "%opcion%"=="5" goto cancelar_apagado
if "%opcion%"=="6" goto hibernar_sistema
if "%opcion%"=="7" goto estado_sistema
if "%opcion%"=="8" goto salir
goto menu

:apagar_sistema
cls
echo ========================================
echo         ğŸ”Œ APAGAR SISTEMA
echo ========================================
echo.
echo 1. Apagado inmediato
echo 2. Apagado con tiempo de espera
echo 3. Apagado forzado
echo.
set /p tipo="Selecciona tipo de apagado: "
if "%tipo%"=="1" (
    echo ğŸ”Œ Apagando sistema inmediatamente...
    shutdown /s /t 0
) else if "%tipo%"=="2" (
    set /p tiempo="Tiempo en segundos: "
    shutdown /s /t %tiempo%
) else if "%tipo%"=="3" (
    echo ğŸ”Œ Apagado forzado...
    shutdown /s /f /t 0
)
pause
goto menu

:reiniciar_sistema
cls
echo ========================================
echo         ğŸ”„ REINICIAR SISTEMA
echo ========================================
echo.
echo 1. Reinicio inmediato
echo 2. Reinicio con tiempo de espera
echo 3. Reinicio forzado
echo.
set /p tipo="Selecciona tipo de reinicio: "
if "%tipo%"=="1" (
    echo ğŸ”„ Reiniciando sistema...
    shutdown /r /t 0
) else if "%tipo%"=="2" (
    set /p tiempo="Tiempo en segundos: "
    shutdown /r /t %tiempo%
) else if "%tipo%"=="3" (
    echo ğŸ”„ Reinicio forzado...
    shutdown /r /f /t 0
)
pause
goto menu

:cerrar_sesion
cls
echo ========================================
echo         ğŸ‘¤ CERRAR SESIÃ“N
echo ========================================
echo.
echo ğŸ”„ Cerrando sesiÃ³n actual...
shutdown /l
pause
goto menu

:programar_apagado
cls
echo ========================================
echo         â° PROGRAMAR APAGADO
echo ========================================
echo.
set /p tiempo="Tiempo en segundos: "
set /p mensaje="Mensaje (opcional): "
if defined mensaje (
    shutdown /s /t %tiempo% /c "%mensaje%"
) else (
    shutdown /s /t %tiempo%
)
echo âœ… Apagado programado
pause
goto menu

:cancelar_apagado
cls
echo ========================================
echo         âŒ CANCELAR APAGADO
echo ========================================
echo.
echo ğŸ”„ Cancelando apagado programado...
shutdown /a
echo âœ… Apagado cancelado
pause
goto menu

:hibernar_sistema
cls
echo ========================================
echo         ğŸŒ™ HIBERNAR SISTEMA
echo ========================================
echo.
echo ğŸŒ™ Poniendo sistema en hibernaciÃ³n...
shutdown /h
pause
goto menu

:estado_sistema
cls
echo ========================================
echo         ğŸ“Š ESTADO DEL SISTEMA
echo ========================================
echo.
echo ğŸ” Verificando estado del sistema...
echo === TIEMPO ACTIVO ===
net statistics server | findstr "Statistics since"
echo === USUARIOS CONECTADOS ===
query user
echo === PROCESOS CRÃTICOS ===
tasklist | findstr /i "explorer winlogon services"
pause
goto menu

:salir
exit
```

### Script para Apagado Masivo de Red

```batch
@echo off
:: Apagado masivo de computadoras en red
title ğŸŒ Apagado Masivo de Red
color 0A

echo ========================================
echo    ğŸŒ APAGADO MASIVO DE RED
echo ========================================
echo.

:menu
echo 1. ğŸ“‹ Listar computadoras
echo 2. ğŸ”Œ Apagar computadoras
echo 3. ğŸ”„ Reiniciar computadoras
echo 4. ğŸ‘¤ Cerrar sesiones remotas
echo 5. ğŸšª Salir
echo.
set /p opcion="Selecciona opciÃ³n: "

if "%opcion%"=="1" goto listar_pcs
if "%opcion%"=="2" goto apagar_pcs
if "%opcion%"=="3" goto reiniciar_pcs
if "%opcion%"=="4" goto cerrar_sesiones
if "%opcion%"=="5" goto salir
goto menu

:listar_pcs
cls
echo ========================================
echo         ğŸ“‹ LISTAR COMPUTADORAS
echo ========================================
echo.
set /p archivo="Archivo con lista de PCs: "
if exist "%archivo%" (
    echo ğŸ“‹ Computadoras en la lista:
    type "%archivo%"
) else (
    echo âŒ Archivo no encontrado
)
pause
goto menu

:apagar_pcs
cls
echo ========================================
echo         ğŸ”Œ APAGAR COMPUTADORAS
echo ========================================
echo.
set /p archivo="Archivo con lista de PCs: "
set /p tiempo="Tiempo de espera (segundos): "
if exist "%archivo%" (
    echo ğŸ”Œ Apagando computadoras...
    for /f %%i in (%archivo%) do (
        echo Apagando: %%i
        shutdown /s /t %tiempo% /m \\%%i
    )
    echo âœ… Proceso de apagado iniciado
) else (
    echo âŒ Archivo no encontrado
)
pause
goto menu

:reiniciar_pcs
cls
echo ========================================
echo         ğŸ”„ REINICIAR COMPUTADORAS
echo ========================================
echo.
set /p archivo="Archivo con lista de PCs: "
set /p tiempo="Tiempo de espera (segundos): "
if exist "%archivo%" (
    echo ğŸ”„ Reiniciando computadoras...
    for /f %%i in (%archivo%) do (
        echo Reiniciando: %%i
        shutdown /r /t %tiempo% /m \\%%i
    )
    echo âœ… Proceso de reinicio iniciado
) else (
    echo âŒ Archivo no encontrado
)
pause
goto menu

:cerrar_sesiones
cls
echo ========================================
echo         ğŸ‘¤ CERRAR SESIONES REMOTAS
echo ========================================
echo.
set /p archivo="Archivo con lista de PCs: "
if exist "%archivo%" (
    echo ğŸ‘¤ Cerrando sesiones remotas...
    for /f %%i in (%archivo%) do (
        echo Cerrando sesiÃ³n en: %%i
        shutdown /l /m \\%%i
    )
    echo âœ… Sesiones cerradas
) else (
    echo âŒ Archivo no encontrado
)
pause
goto menu

:salir
exit
```

## Consejos Importantes

### âš¡ **OptimizaciÃ³n**
- Usa `/t 0` para operaciones inmediatas
- Utiliza `/f` solo cuando sea absolutamente necesario
- Programa apagados para horarios de bajo uso

### ğŸ›¡ï¸ **Seguridad**
- Verifica usuarios conectados antes de apagar
- Usa mensajes informativos para notificar cambios
- Documenta razones de apagado para auditorÃ­a

### ğŸ”§ **Mejores PrÃ¡cticas**
- Siempre notifica a usuarios antes de apagar
- Usa cÃ³digos de razÃ³n para seguimiento
- MantÃ©n logs de operaciones de apagado

## Casos de Uso Reales

### ğŸ¢ **AdministraciÃ³n de Sistemas**
- Mantenimiento programado de servidores
- AplicaciÃ³n de parches de seguridad
- GestiÃ³n de energÃ­a en centros de datos

### ğŸ« **Entornos Educativos**
- Apagado automÃ¡tico de laboratorios
- Reinicio masivo de estaciones de trabajo
- Limpieza de sesiones de estudiantes

### ğŸ­ **Entornos Empresariales**
- GestiÃ³n de horarios de trabajo
- Mantenimiento preventivo
- Cumplimiento de polÃ­ticas de seguridad

## ConclusiÃ³n y Siguiente Paso

Has aprendido a tener control total sobre el ciclo de vida de tu sistema Windows. Desde operaciones bÃ¡sicas hasta gestiÃ³n masiva en redes, estos comandos son fundamentales para cualquier administrador de sistemas.

En el siguiente capÃ­tulo, exploraremos la **GestiÃ³n de usuarios**, donde aprenderÃ¡s a crear, modificar y administrar cuentas de usuario desde la lÃ­nea de comandos. Â¿Te imaginas gestionando cientos de usuarios en una empresa sin herramientas grÃ¡ficas? Â¡Esa serÃ¡ tu nueva realidad!

---

## Enlaces Relacionados

- [CapÃ­tulo 32: GestiÃ³n de usuarios](32.%20GestiÃ³n%20de%20usuarios.md)
- [CapÃ­tulo 34: GestiÃ³n de Procesos](34.%20GestiÃ³n%20de%20Procesos.md)
- [CapÃ­tulo 40: Ejecutar como Administrador - RUNAS](40.%20Ejecutar%20como%20Administrador%20-%20RUNAS.md)

## Fuentes y Referencias

- **DocumentaciÃ³n oficial de Microsoft:** [Shutdown Command](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/shutdown)
- **Windows Command Line Reference:** [System Commands](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/windows-commands)
- **AdministraciÃ³n de Windows Server:** [System Management](https://docs.microsoft.com/en-us/windows-server/administration/)

---

**Autor:** Jerson MartÃ­nez  
**Sitio web:** [jersonmartinez.com](https://jersonmartinez.com)  
**Blog DevOps:** [crashell.com](https://crashell.com) 